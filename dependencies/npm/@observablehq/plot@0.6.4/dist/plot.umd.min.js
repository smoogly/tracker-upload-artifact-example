// @observablehq/plot v0.6.4 Copyright 2020-2023 Observable, Inc.
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("d3@7.8.2/dist/d3.min.js")):"function"==typeof define&&define.amd?define(["exports","d3@7.8.2/dist/d3.min.js"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).Plot=t.Plot||{},t.d3)}(this,(function(t,e){"use strict";function n(t,e){if(t instanceof Date||(t=new Date(+t)),isNaN(t))return"function"==typeof e?e(t):e;const n=t.getUTCHours(),o=t.getUTCMinutes(),i=t.getUTCSeconds(),a=t.getUTCMilliseconds();return`${l=t.getUTCFullYear(),l<0?`-${r(-l,6)}`:l>9999?`+${r(l,6)}`:r(l,4)}-${r(t.getUTCMonth()+1,2)}-${r(t.getUTCDate(),2)}${n||o||i||a?`T${r(n,2)}:${r(o,2)}${i||a?`:${r(i,2)}${a?`.${r(a,3)}`:""}`:""}Z`:""}`;var l}function r(t,e){return`${t}`.padStart(e,"0")}const o=/^(?:[-+]\d{2})?\d{4}(?:-\d{2}(?:-\d{2})?)?(?:T\d{2}:\d{2}(?::\d{2}(?:\.\d{3})?)?(?:Z|[-+]\d{2}:?\d{2})?)?$/;function i(t,e){return o.test(t+="")?new Date(t):"function"==typeof e?e(t):e}const a=new Map([["second",e.timeSecond],["minute",e.timeMinute],["hour",e.timeHour],["day",e.timeDay],["week",e.timeWeek],["month",e.timeMonth],["year",e.timeYear],["monday",e.timeMonday],["tuesday",e.timeTuesday],["wednesday",e.timeWednesday],["thursday",e.timeThursday],["friday",e.timeFriday],["saturday",e.timeSaturday],["sunday",e.timeSunday]]),l=new Map([["second",e.utcSecond],["minute",e.utcMinute],["hour",e.utcHour],["day",e.utcDay],["week",e.utcWeek],["month",e.utcMonth],["year",e.utcYear],["monday",e.utcMonday],["tuesday",e.utcTuesday],["wednesday",e.utcWednesday],["thursday",e.utcThursday],["friday",e.utcFriday],["saturday",e.utcSaturday],["sunday",e.utcSunday]]);function s(t){const e=a.get(`${t}`.toLowerCase());if(!e)throw new Error(`unknown interval: ${t}`);return e}function c(t){const e=l.get(`${t}`.toLowerCase());if(!e)throw new Error(`unknown interval: ${t}`);return e}const u=Object.getPrototypeOf(Uint8Array),f=Object.prototype.toString;function h(t,e,n){const r=typeof e;return"string"===r?E(t,d(e),n):"function"===r?E(t,e,n):"number"===r||e instanceof Date||"boolean"===r?E(t,$(e),n):e&&"function"==typeof e.transform?O(e.transform(t),n):O(e,n)}const d=t=>e=>e[t],p=(t,e)=>e,m={transform:t=>t},g=()=>1,y=()=>!0,v=t=>null==t?t:`${t}`,x=t=>null==t?t:+t,w=t=>t?t[0]:void 0,b=t=>t?t[1]:void 0,k=t=>t?t[2]:void 0,$=t=>()=>t;function M(t){const n=+`${t}`.slice(1)/100;return(t,r)=>e.quantile(t,n,r)}function L(t,e){return void 0===t&&(t=e),null===t?[void 0,"none"]:it(t)?[void 0,t]:[t,void 0]}function A(t,e){return void 0===t&&(t=e),null===t||"number"==typeof t?[void 0,t]:[t,void 0]}function R(t,e,n){if(null!=t)return z(t,e,n)}function z(t,e,n){const r=`${t}`.toLowerCase();if(!n.includes(r))throw new Error(`invalid ${e}: ${t}`);return r}function O(t,e){return null==t?t:void 0===e?t instanceof Array||t instanceof u?t:Array.from(t):t instanceof e?t:e.from(t)}function E(t,e,n=Array){return t instanceof n?t.map(e):n.from(t,e)}function S(t,e=Array){return t instanceof e?t.slice():e.from(t)}function C(t){return t instanceof u}function B(t){return t?.toString===f}function T(t){return B(t)&&(void 0!==t.type||void 0!==t.domain)}function N(t){return B(t)&&"function"!=typeof t.transform}function P(t){return N(t)&&void 0===t.value&&void 0===t.channel}function W(t,e,n,r=m){return void 0===e&&void 0===n?(e=0,n=void 0===t?r:t):void 0===e?e=void 0===t?0:t:void 0===n&&(n=void 0===t?0:t),[e,n]}function j(t,e){return void 0===t&&void 0===e?[w,b]:[t,e]}function D({z:t,fill:e,stroke:n}={}){return void 0===t&&([t]=L(e)),void 0===t&&([t]=L(n)),t}function q(t){const e=t.length,n=new Uint32Array(e);for(let t=0;t<e;++t)n[t]=t;return n}function F(t,e){return E(e,(e=>t[e]))}function Y(t){return null!==t&&"object"==typeof t?t.valueOf():t}function I(t,e){if(void 0!==e[t])return e[t];switch(t){case"x1":case"x2":t="x";break;case"y1":case"y2":t="y"}return e[t]}function _(t){let e;return[{transform:()=>e,label:X(t)},t=>e=t]}function G(t){return null==t?[t]:_(t)}function X(t,e){return"string"==typeof t?t:t&&void 0!==t.label?t.label:e}function U(t,e){return{transform(n){const r=t.transform(n),o=e.transform(n);return tt(r)||tt(o)?E(r,((t,e)=>new Date((+r[e]+ +o[e])/2))):E(r,((t,e)=>(+r[e]+ +o[e])/2),Float64Array)},label:t.label}}function H(t,n){if(null!=t){if("number"==typeof t){const n=t;return{floor:t=>n*Math.floor(t/n),offset:t=>t+n,range:(t,r)=>e.range(Math.ceil(t/n),r/n).map((t=>n*t))}}if("string"==typeof t)return("time"===n?s:c)(t);if("function"!=typeof t.floor)throw new Error("invalid interval; missing floor method");if("function"!=typeof t.offset)throw new Error("invalid interval; missing offset method");return t}}function V(t){return void 0===t||N(t)?t:{value:t}}function Z(t){if(!Q(t))return!1;for(const e of t)if(null!=e)return"object"==typeof e&&"0"in e&&"1"in e}function Q(t){return t&&"function"==typeof t[Symbol.iterator]}function J(t){for(const e of t)if(null!=e)return"object"!=typeof e||e instanceof Date}function K(t){for(const e of t){if(null==e)continue;const t=typeof e;return"string"===t||"boolean"===t}}function tt(t){for(const e of t)if(null!=e)return e instanceof Date}function et(t){for(const e of t)if(null!=e)return"string"==typeof e&&isNaN(e)&&i(e)}function nt(t){for(const e of t)if(null!=e){if("string"!=typeof e)return!1;if(e.trim())return!isNaN(e)}}function rt(t){for(const e of t)if(null!=e)return"number"==typeof e}function ot(t,e){let n;for(const r of t)if(null!=r){if(!e(r))return!1;n=!0}return n}function it(t){return"string"==typeof t&&("none"===(t=t.toLowerCase().trim())||"currentcolor"===t||t.startsWith("url(")&&t.endsWith(")")||t.startsWith("var(")&&t.endsWith(")")||null!==e.color(t))}function at(t){return null==t||lt(t)}function lt(t){return/^\s*none\s*$/i.test(t)}function st(t="middle"){return z(t,"frameAnchor",["middle","top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"])}function ct(t){if(null==t)return;const n=t[0],r=t[t.length-1];return e.descending(n,r)}function ut(t){return Q(t)?function(t){console.warn("named iterables are deprecated; please use an object instead");const e=new Set;return Object.fromEntries(Array.from(t,(t=>{const{name:n}=t;if(null==n)throw new Error("missing name");const r=`${n}`;if("__proto__"===r)throw new Error(`illegal name: ${r}`);if(e.has(r))throw new Error(`duplicate name: ${r}`);return e.add(r),[n,t]})))}(t):t}const ft=Symbol("position"),ht=Symbol("color"),dt=Symbol("radius"),pt=Symbol("length"),mt=Symbol("opacity"),gt=Symbol("symbol"),yt=new Map([["x",ft],["y",ft],["fx",ft],["fy",ft],["r",dt],["color",ht],["opacity",mt],["symbol",gt],["length",pt]]),vt=Math.sqrt(3),xt=2/vt,wt={draw(t,e){const n=Math.sqrt(e/Math.PI),r=n*xt,o=r/2;t.moveTo(0,r),t.lineTo(n,o),t.lineTo(n,-o),t.lineTo(0,-r),t.lineTo(-n,-o),t.lineTo(-n,o),t.closePath()}},bt=new Map([["asterisk",e.symbolAsterisk],["circle",e.symbolCircle],["cross",e.symbolCross],["diamond",e.symbolDiamond],["diamond2",e.symbolDiamond2],["hexagon",wt],["plus",e.symbolPlus],["square",e.symbolSquare],["square2",e.symbolSquare2],["star",e.symbolStar],["times",e.symbolTimes],["triangle",e.symbolTriangle],["triangle2",e.symbolTriangle2],["wye",e.symbolWye]]);function kt(t){return t&&"function"==typeof t.draw}function $t(t){return!!kt(t)||"string"==typeof t&&bt.has(t.toLowerCase())}function Mt(t){if(null==t||kt(t))return t;const e=bt.get(`${t}`.toLowerCase());if(e)return e;throw new Error(`invalid symbol: ${t}`)}function Lt(t){return null!=t&&!Number.isNaN(t)}function At(t,n){return+Lt(n)-+Lt(t)||e.ascending(t,n)}function Rt(t,n){return+Lt(n)-+Lt(t)||e.descending(t,n)}function zt(t){return null!=t&&""!=`${t}`}function Ot(t){return isFinite(t)?t:NaN}function Et(t){return t>0&&isFinite(t)?t:NaN}function St(t){return t<0&&isFinite(t)?t:NaN}function Ct(t={},e){let{filter:n,sort:r,reverse:o,transform:i,initializer:a,...l}=t;if(void 0===i&&(null!=n&&(i=Wt(n)),null==r||P(r)||(i=Tt(i,qt(r))),o&&(i=Tt(i,jt))),null!=e&&null!=a)throw new Error("transforms cannot be applied after initializers");return{...l,...(null===r||P(r))&&{sort:r},transform:Tt(i,e)}}function Bt(t={},e){let{filter:n,sort:r,reverse:o,initializer:i,...a}=t;return void 0===i&&(null!=n&&(i=Wt(n)),null==r||P(r)||(i=Nt(i,qt(r))),o&&(i=Nt(i,jt))),{...a,...(null===r||P(r))&&{sort:r},initializer:Nt(i,e)}}function Tt(t,e){return null==t?null===e?void 0:e:null==e?null===t?void 0:t:function(n,r){return({data:n,facets:r}=t.call(this,n,r)),e.call(this,O(n),r)}}function Nt(t,e){return null==t?null===e?void 0:e:null==e?null===t?void 0:t:function(n,r,o,...i){let a,l,s,c,u,f;return({data:l=n,facets:s=r,channels:a}=t.call(this,n,r,o,...i)),({data:u=l,facets:f=s,channels:c}=e.call(this,l,s,{...o,...a},...i)),{data:u,facets:f,channels:{...a,...c}}}}function Pt(t,e){return(null!=t.initializer?Bt:Ct)(t,e)}function Wt(t){return(e,n)=>{const r=h(e,t);return{data:e,facets:n.map((t=>t.filter((t=>r[t]))))}}}function jt(t,e){return{data:t,facets:e.map((t=>t.slice().reverse()))}}function Dt(t,e){return{...(N(t)&&void 0!==t.channel?Bt:Pt)(e,qt(t)),sort:null}}function qt(t){return("function"==typeof t&&1!==t.length?Ft:Yt)(t)}function Ft(t){return(e,n)=>{const r=(n,r)=>t(e[n],e[r]);return{data:e,facets:n.map((t=>t.slice().sort(r)))}}}function Yt(t){let e,n;if(({channel:e,value:t,order:n=At}={...V(t)}),"function"!=typeof n)switch(`${n}`.toLowerCase()){case"ascending":n=At;break;case"descending":n=Rt;break;default:throw new Error(`invalid order: ${n}`)}return(r,o,i)=>{let a;if(void 0===e)a=h(r,t);else{if(void 0===i)throw new Error("channel sort requires an initializer");if(a=i[e],!a)return{};a=a.value}const l=(t,e)=>n(a[t],a[e]);return{data:r,facets:o.map((t=>t.slice().sort(l)))}}}function It(t,e){return Ut(null,null,t,e)}function _t(t={y:"count"},e={}){const{x:n=m}=e;if(null==n)throw new Error("missing channel: x");return Ut(n,null,t,e)}function Gt(t={x:"count"},e={}){const{y:n=m}=e;if(null==n)throw new Error("missing channel: y");return Ut(null,n,t,e)}function Xt(t={fill:"count"},e={}){let{x:n,y:r}=e;if([n,r]=j(n,r),null==n)throw new Error("missing channel: x");if(null==r)throw new Error("missing channel: y");return Ut(n,r,t,e)}function Ut(t,e,{data:n=oe,filter:r,sort:o,reverse:i,...a}={},l={}){a=Vt(a,l),n=Kt(n,m),o=null==o?void 0:Zt("sort",o,l),r=null==r?void 0:Qt("filter",r,l);const[s,c]=G(t),[u,f]=G(e),{z:d,fill:p,stroke:g,x1:y,x2:v,y1:x,y2:w,...b}=l,[k,$]=G(d),[M]=L(p),[A]=L(g),[R,z]=G(M),[O,E]=G(A);return{..."z"in l&&{z:k||d},..."fill"in l&&{fill:R||p},..."stroke"in l&&{stroke:O||g},...Ct(b,((l,s)=>{const u=h(l,t),p=h(l,e),m=h(l,d),g=h(l,M),y=h(l,A),v=te(a,{z:m,fill:g,stroke:y}),x=[],w=[],b=u&&c([]),k=p&&f([]),L=m&&$([]),R=g&&z([]),O=y&&E([]);let S=0;for(const t of a)t.initialize(l);o&&o.initialize(l),r&&r.initialize(l);for(const t of s){const e=[];for(const e of a)e.scope("facet",t);o&&o.scope("facet",t),r&&r.scope("facet",t);for(const[i,s]of Jt(t,v))for(const[t,c]of Jt(s,p))for(const[s,f]of Jt(c,u))if(!r||r.reduce(f)){e.push(S++),w.push(n.reduce(f,l)),u&&b.push(s),p&&k.push(t),m&&L.push(v===m?i:m[f[0]]),g&&R.push(v===g?i:g[f[0]]),y&&O.push(v===y?i:y[f[0]]);for(const t of a)t.reduce(f);o&&o.reduce(f)}x.push(e)}return ee(x,o,i),{data:w,facets:x}})),...!Ht(a,"x")&&(s?{x:s}:{x1:y,x2:v}),...!Ht(a,"y")&&(u?{y:u}:{y1:x,y2:w}),...Object.fromEntries(a.map((({name:t,output:e})=>[t,e])))}}function Ht(t,...e){for(const{name:n}of t)if(e.includes(n))return!0;return!1}function Vt(t,e){const n=Object.entries(t);return null!=e.title&&void 0===t.title&&n.push(["title",ae]),null!=e.href&&void 0===t.href&&n.push(["href",ie]),n.filter((([,t])=>void 0!==t)).map((([t,n])=>null===n?{name:t,initialize(){},scope(){},reduce(){}}:Zt(t,n,e)))}function Zt(t,e,n){const r=Qt(t,e,n),[o,i]=_(r.label);let a;return{name:t,output:o,initialize(t){r.initialize(t),a=i([])},scope(t,e){r.scope(t,e)},reduce(t,e){a.push(r.reduce(t,e))}}}function Qt(t,e,n){const r=I(t,n),o=Kt(e,r);let i,a;return{label:X(o===se?null:r,o.label),initialize(t){i=void 0===r?t:h(t,r),"data"===o.scope&&(a=o.reduce(q(t),i))},scope(t,e){o.scope===t&&(a=o.reduce(e,i))},reduce:(t,e)=>null==o.scope?o.reduce(t,i,e):o.reduce(t,i,a,e)}}function Jt(t,n){return n?e.sort(e.group(t,(t=>n[t])),w):[[,t]]}function Kt(t,n){if("function"==typeof t?.reduce&&B(t))return t;if("function"==typeof t)return r=t,{reduce:(t,e,n)=>r(F(e,t),n)};var r;if(/^p\d{2}$/i.test(t))return ne(M(t));switch(`${t}`.toLowerCase()){case"first":return ie;case"last":return le;case"count":return se;case"distinct":return ce;case"sum":return null==n?se:ue;case"proportion":return fe(n,"data");case"proportion-facet":return fe(n,"facet");case"deviation":return ne(e.deviation);case"min":return ne(e.min);case"min-index":return ne(e.minIndex);case"max":return ne(e.max);case"max-index":return ne(e.maxIndex);case"mean":return re(e.mean);case"median":return re(e.median);case"variance":return ne(e.variance);case"mode":return ne(e.mode);case"x":return de;case"x1":return me;case"x2":return ge;case"y":return pe;case"y1":return ye;case"y2":return ve}throw new Error(`invalid reduce: ${t}`)}function te(t,e){for(const n in e){const r=e[n];if(void 0!==r&&!t.some((t=>t.name===n)))return r}}function ee(t,e,n){if(e){const n=e.output.transform(),r=(t,e)=>At(n[t],n[e]);t.forEach((t=>t.sort(r)))}n&&t.forEach((t=>t.reverse()))}function ne(t){return{reduce:(e,n)=>t(e,(t=>n[t]))}}function re(t){return{reduce(e,n){const r=t(e,(t=>n[t]));return tt(n)?new Date(r):r}}}const oe={reduce:(t,e)=>F(e,t)},ie={reduce:(t,e)=>e[t[0]]},ae={reduce(t,n){const r=e.sort(e.rollup(t,(t=>t.length),(t=>n[t])),b),o=r.slice(-5).reverse();if(o.length<r.length){const t=r.slice(0,-4);o[4]=[`… ${t.length.toLocaleString("en-US")} more`,e.sum(t,b)]}return o.map((([t,e])=>`${t} (${e.toLocaleString("en-US")})`)).join("\n")}},le={reduce:(t,e)=>e[t[t.length-1]]},se={label:"Frequency",reduce:t=>t.length},ce={label:"Distinct",reduce:(t,n)=>{const r=new e.InternSet;for(const e of t)r.add(n[e]);return r.size}},ue=ne(e.sum);function fe(t,n){return null==t?{scope:n,label:"Frequency",reduce:(t,e,n=1)=>t.length/n}:{scope:n,reduce:(t,n,r=1)=>e.sum(t,(t=>n[t]))/r}}function he(t,e){const n=(+t+ +e)/2;return t instanceof Date?new Date(n):n}const de={reduce:(t,e,{x1:n,x2:r})=>he(n,r)},pe={reduce:(t,e,{y1:n,y2:r})=>he(n,r)},me={reduce:(t,e,{x1:n})=>n},ge={reduce:(t,e,{x2:n})=>n},ye={reduce:(t,e,{y1:n})=>n},ve={reduce:(t,e,{y2:n})=>n};function xe(t,{scale:e,type:n,value:r,filter:o,hint:i},a){return ke(a,{scale:e,type:n,value:h(t,r),label:X(r),filter:o,hint:i})}function we(t,e){return Object.fromEntries(Object.entries(t).map((([t,n])=>[t,xe(e,n,t)])))}function be(t,e){return Object.fromEntries(Object.entries(t).map((([t,{scale:n,value:r}])=>{const o=null==n?null:e[n];return[t,null==o?r:E(r,o)]})))}function ke(t,e){const{scale:n,value:r}=e;if(!0===n||"auto"===n)switch(t){case"fill":case"stroke":case"color":e.scale=ot(r,it)?null:"color";break;case"fillOpacity":case"strokeOpacity":e.scale="opacity";break;case"symbol":ot(r,$t)?(e.scale=null,e.value=E(r,Mt)):e.scale="symbol";break;default:e.scale=yt.has(t)?t:null}else if(null!=n&&!yt.has(n))throw new Error(`unknown scale: ${n}`);return e}function $e(t,e){for(const n in t){const r=t[n];if(r.scale===e)return r}}function Me(t,e,n){const r=Le(t,e);return E(Le(t,n),((t,e)=>Math.abs(t-r[e])),Float64Array)}function Le(t,e,n){let r=t[e];if(r||void 0===n||(r=t[n]),r)return r.value;throw new Error(`missing channel: ${e}`)}function Ae([t,n],[r,o]){return e.ascending(n,o)||e.ascending(t,r)}function Re([t,n],[r,o]){return e.descending(n,o)||e.ascending(t,r)}const ze=new Map([["accent",e.schemeAccent],["category10",e.schemeCategory10],["dark2",e.schemeDark2],["paired",e.schemePaired],["pastel1",e.schemePastel1],["pastel2",e.schemePastel2],["set1",e.schemeSet1],["set2",e.schemeSet2],["set3",e.schemeSet3],["tableau10",e.schemeTableau10],["brbg",Ee(e.schemeBrBG,e.interpolateBrBG)],["prgn",Ee(e.schemePRGn,e.interpolatePRGn)],["piyg",Ee(e.schemePiYG,e.interpolatePiYG)],["puor",Ee(e.schemePuOr,e.interpolatePuOr)],["rdbu",Ee(e.schemeRdBu,e.interpolateRdBu)],["rdgy",Ee(e.schemeRdGy,e.interpolateRdGy)],["rdylbu",Ee(e.schemeRdYlBu,e.interpolateRdYlBu)],["rdylgn",Ee(e.schemeRdYlGn,e.interpolateRdYlGn)],["spectral",Ee(e.schemeSpectral,e.interpolateSpectral)],["burd",Se(e.schemeRdBu,e.interpolateRdBu)],["buylrd",Se(e.schemeRdYlBu,e.interpolateRdYlBu)],["blues",Oe(e.schemeBlues,e.interpolateBlues)],["greens",Oe(e.schemeGreens,e.interpolateGreens)],["greys",Oe(e.schemeGreys,e.interpolateGreys)],["oranges",Oe(e.schemeOranges,e.interpolateOranges)],["purples",Oe(e.schemePurples,e.interpolatePurples)],["reds",Oe(e.schemeReds,e.interpolateReds)],["turbo",Ce(e.interpolateTurbo)],["viridis",Ce(e.interpolateViridis)],["magma",Ce(e.interpolateMagma)],["inferno",Ce(e.interpolateInferno)],["plasma",Ce(e.interpolatePlasma)],["cividis",Ce(e.interpolateCividis)],["cubehelix",Ce(e.interpolateCubehelixDefault)],["warm",Ce(e.interpolateWarm)],["cool",Ce(e.interpolateCool)],["bugn",Oe(e.schemeBuGn,e.interpolateBuGn)],["bupu",Oe(e.schemeBuPu,e.interpolateBuPu)],["gnbu",Oe(e.schemeGnBu,e.interpolateGnBu)],["orrd",Oe(e.schemeOrRd,e.interpolateOrRd)],["pubu",Oe(e.schemePuBu,e.interpolatePuBu)],["pubugn",Oe(e.schemePuBuGn,e.interpolatePuBuGn)],["purd",Oe(e.schemePuRd,e.interpolatePuRd)],["rdpu",Oe(e.schemeRdPu,e.interpolateRdPu)],["ylgn",Oe(e.schemeYlGn,e.interpolateYlGn)],["ylgnbu",Oe(e.schemeYlGnBu,e.interpolateYlGnBu)],["ylorbr",Oe(e.schemeYlOrBr,e.interpolateYlOrBr)],["ylorrd",Oe(e.schemeYlOrRd,e.interpolateYlOrRd)],["rainbow",Be(e.interpolateRainbow)],["sinebow",Be(e.interpolateSinebow)]]);function Oe(t,n){return({length:r})=>1===r?[t[3][1]]:2===r?[t[3][1],t[3][2]]:(r=Math.max(3,Math.floor(r)))>9?e.quantize(n,r):t[r]}function Ee(t,n){return({length:r})=>2===r?[t[3][0],t[3][2]]:(r=Math.max(3,Math.floor(r)))>11?e.quantize(n,r):t[r]}function Se(t,n){return({length:r})=>2===r?[t[3][2],t[3][0]]:(r=Math.max(3,Math.floor(r)))>11?e.quantize((t=>n(1-t)),r):t[r].slice().reverse()}function Ce(t){return({length:n})=>e.quantize(t,Math.max(2,Math.floor(n)))}function Be(t){return({length:n})=>e.quantize(t,Math.floor(n)+1).slice(0,-1)}function Te(t){const e=`${t}`.toLowerCase();if(!ze.has(e))throw new Error(`unknown ordinal scheme: ${e}`);return ze.get(e)}function Ne(t,e){const n=Te(t),r="function"==typeof n?n({length:e}):n;return r.length!==e?r.slice(0,e):r}const Pe=new Map([["brbg",e.interpolateBrBG],["prgn",e.interpolatePRGn],["piyg",e.interpolatePiYG],["puor",e.interpolatePuOr],["rdbu",e.interpolateRdBu],["rdgy",e.interpolateRdGy],["rdylbu",e.interpolateRdYlBu],["rdylgn",e.interpolateRdYlGn],["spectral",e.interpolateSpectral],["burd",t=>e.interpolateRdBu(1-t)],["buylrd",t=>e.interpolateRdYlBu(1-t)],["blues",e.interpolateBlues],["greens",e.interpolateGreens],["greys",e.interpolateGreys],["purples",e.interpolatePurples],["reds",e.interpolateReds],["oranges",e.interpolateOranges],["turbo",e.interpolateTurbo],["viridis",e.interpolateViridis],["magma",e.interpolateMagma],["inferno",e.interpolateInferno],["plasma",e.interpolatePlasma],["cividis",e.interpolateCividis],["cubehelix",e.interpolateCubehelixDefault],["warm",e.interpolateWarm],["cool",e.interpolateCool],["bugn",e.interpolateBuGn],["bupu",e.interpolateBuPu],["gnbu",e.interpolateGnBu],["orrd",e.interpolateOrRd],["pubugn",e.interpolatePuBuGn],["pubu",e.interpolatePuBu],["purd",e.interpolatePuRd],["rdpu",e.interpolateRdPu],["ylgnbu",e.interpolateYlGnBu],["ylgn",e.interpolateYlGn],["ylorbr",e.interpolateYlOrBr],["ylorrd",e.interpolateYlOrRd],["rainbow",e.interpolateRainbow],["sinebow",e.interpolateSinebow]]);function We(t){const e=`${t}`.toLowerCase();if(!Pe.has(e))throw new Error(`unknown quantitative scheme: ${e}`);return Pe.get(e)}const je=new Set(["brbg","prgn","piyg","puor","rdbu","rdgy","rdylbu","rdylgn","spectral","burd","buylrd"]);function De(t){return null!=t&&je.has(`${t}`.toLowerCase())}const qe=t=>e=>t(1-e),Fe=[0,1],Ye=new Map([["number",e.interpolateNumber],["rgb",e.interpolateRgb],["hsl",e.interpolateHsl],["hcl",e.interpolateHcl],["lab",e.interpolateLab]]);function Ie(t){const e=`${t}`.toLowerCase();if(!Ye.has(e))throw new Error(`unknown interpolator: ${e}`);return Ye.get(e)}function _e(t,n,r,{type:o,nice:i,clamp:a,zero:l,domain:s=He(t,r),unknown:c,round:u,scheme:f,interval:h,range:d=(yt.get(t)===dt?Ze(r,s):yt.get(t)===pt?Qe(r,s):yt.get(t)===mt?Fe:void 0),interpolate:p=(yt.get(t)===ht?null==f&&void 0!==d?e.interpolateRgb:We(void 0!==f?f:"cyclical"===o?"rainbow":"turbo"):u?e.interpolateRound:e.interpolateNumber),reverse:m}){if(h=H(h,o),"cyclical"!==o&&"sequential"!==o||(o="linear"),m=!!m,"function"!=typeof p&&(p=Ie(p)),1===p.length?(m&&(p=qe(p),m=!1),void 0===d&&2===(d=Float64Array.from(s,((t,e)=>e/(s.length-1)))).length&&(d=Fe),n.interpolate((d===Fe?$:tn)(p))):n.interpolate(p),l){const[t,n]=e.extent(s);(t>0||n<0)&&(ct(s=S(s))!==Math.sign(t)?s[s.length-1]=0:s[0]=0)}return m&&(s=e.reverse(s)),n.domain(s).unknown(c),i&&(n.nice(!0===i?void 0:i),s=n.domain()),void 0!==d&&n.range(d),a&&n.clamp(a),{type:o,domain:s,range:d,scale:n,interpolate:p,interval:h}}function Ge(t,n,{exponent:r=1,...o}){return _e(t,e.scalePow().exponent(r),n,{...o,type:"pow"})}function Xe(t,n,{domain:r=[0],unknown:o,scheme:i="rdylbu",interpolate:a,range:l=(void 0!==a?e.quantize(a,r.length+1):yt.get(t)===ht?Ne(i,r.length+1):void 0),reverse:s}){const c=ct(r=O(r));if(!function(t,n){for(let r=1,o=t.length,i=t[0];r<o;++r){const o=e.descending(i,i=t[r]);if(0!==o&&o!==n)return!1}return!0}(r,c))throw new Error(`the ${t} scale has a non-monotonic domain`);return s&&(l=e.reverse(l)),{type:"threshold",scale:e.scaleThreshold(c<0?e.reverse(r):r,void 0===l?[]:l).unknown(o),domain:r,range:l}}function Ue(t,n=Ot){return t.length?[e.min(t,(({value:t})=>void 0===t?t:e.min(t,n))),e.max(t,(({value:t})=>void 0===t?t:e.max(t,n)))]:[0,1]}function He(t,e){const n=yt.get(t);return(n===dt||n===mt||n===pt?Ve:Ue)(e)}function Ve(t){return[0,t.length?e.max(t,(({value:t})=>void 0===t?t:e.max(t,Ot))):1]}function Ze(t,n){const r=t.find((({radius:t})=>void 0!==t));if(void 0!==r)return[0,r.radius];const o=e.quantile(t,.5,(({value:t})=>void 0===t?NaN:e.quantile(t,.25,Et))),i=n.map((t=>3*Math.sqrt(t/o))),a=30/e.max(i);return a<1?i.map((t=>t*a)):i}function Qe(t,n){const r=e.median(t,(({value:t})=>void 0===t?NaN:e.median(t,Math.abs))),o=n.map((t=>12*t/r)),i=60/e.max(o);return i<1?o.map((t=>t*i)):o}function Je(t){for(const{value:e}of t)if(void 0!==e)for(let n of e){if(n>0)return Ue(t,Et);if(n<0)return Ue(t,St)}return[1,10]}function Ke(t){const e=[];for(const{value:n}of t)if(void 0!==n)for(const t of n)e.push(t);return e}function tn(t){return(e,n)=>r=>t(e+r*(n-e))}function en(t,n,r,o,{type:i,nice:a,clamp:l,domain:s=Ue(o),unknown:c,pivot:u=0,scheme:f,range:h,symmetric:d=!0,interpolate:p=(yt.get(t)===ht?null==f&&void 0!==h?e.interpolateRgb:We(void 0!==f?f:"rdbu"):e.interpolateNumber),reverse:m}){u=+u;let[g,y]=s;if(e.descending(g,y)<0&&([g,y]=[y,g],m=!m),g=Math.min(g,u),y=Math.max(y,u),"function"!=typeof p&&(p=Ie(p)),void 0!==h&&(p=1===p.length?tn(p)(...h):e.piecewise(p,h)),m&&(p=qe(p)),d){const t=r.apply(u),e=t-r.apply(g),n=r.apply(y)-t;e<n?g=r.invert(t-n):e>n&&(y=r.invert(t+e))}return n.domain([g,u,y]).unknown(c).interpolator(p),l&&n.clamp(l),a&&n.nice(a),{type:i,domain:[g,y],pivot:u,interpolate:p,scale:n}}function nn(t,n,{exponent:r=1,...o}){return en(t,e.scaleDivergingPow().exponent(r=+r),function(t){return.5===t?ln:{apply:e=>Math.sign(e)*Math.pow(Math.abs(e),t),invert:e=>Math.sign(e)*Math.pow(Math.abs(e),1/t)}}(r),n,{...o,type:"diverging-pow"})}function rn(t,n,{constant:r=1,...o}){return en(t,e.scaleDivergingSymlog().constant(r=+r),function(t){return{apply:e=>Math.sign(e)*Math.log1p(Math.abs(e/t)),invert:e=>Math.sign(e)*Math.expm1(Math.abs(e))*t}}(r),n,o)}const on={apply:t=>t,invert:t=>t},an={apply:Math.log,invert:Math.exp},ln={apply:t=>Math.sign(t)*Math.sqrt(Math.abs(t)),invert:t=>Math.sign(t)*(t*t)};function sn(t,e,n,r){return _e(t,e,n,r)}const cn=Symbol("ordinal");function un(t,n,r,{type:o,interval:i,domain:a,range:l,reverse:s,hint:c}){return i=H(i,o),void 0===a&&(a=dn(r,i,t)),"categorical"!==o&&o!==cn||(o="ordinal"),s&&(a=e.reverse(a)),n.domain(a),void 0!==l&&("function"==typeof l&&(l=l(a)),n.range(l)),{type:o,domain:a,range:l,scale:n,hint:c,interval:i}}function fn(t,n,{type:r,interval:o,domain:i,range:a,scheme:l,unknown:s,...c}){let u;if(o=H(o,r),void 0===i&&(i=dn(n,o,t)),yt.get(t)===gt)u=function(t){return{fill:pn(t,"fill"),stroke:pn(t,"stroke")}}(n),a=void 0===a?function(t){return at(t.fill)?e.symbolsStroke:e.symbolsFill}(u):E(a,Mt);else if(yt.get(t)===ht&&(void 0!==a||"ordinal"!==r&&r!==cn||(a=function(t,e="greys"){const n=new Set,[r,o]=Ne(e,2);for(const e of t)if(null!=e)if(!0===e)n.add(o);else{if(!1!==e)return;n.add(r)}return[...n]}(i,l),void 0!==a&&(l=void 0)),void 0===l&&void 0===a&&(l="ordinal"===r?"turbo":"tableau10"),void 0!==l))if(void 0!==a){const t=We(l),n=a[0],r=a[1]-a[0];a=({length:o})=>e.quantize((e=>t(n+r*e)),o)}else a=Te(l);if(s===e.scaleImplicit)throw new Error(`implicit unknown on ${t} scale is not supported`);return un(t,e.scaleOrdinal().unknown(s),n,{...c,type:r,domain:i,range:a,hint:u})}function hn(t,e,n,r){let{round:o}=n;return void 0!==o&&t.round(o=!!o),(t=un(r,t,e,n)).round=o,t}function dn(t,n,r){const o=new e.InternSet;for(const{value:e,domain:n}of t){if(void 0!==n)return n();if(void 0!==e)for(const t of e)o.add(t)}if(void 0!==n){const[t,r]=e.extent(o).map(n.floor,n);return n.range(t,n.offset(r))}if(o.size>1e4&&yt.get(r)===ft)throw new Error(`implicit ordinal domain of ${r} scale has more than 10,000 values`);return e.sort(o,At)}function pn(t,e){let n;for(const{hint:r}of t){const t=r?.[e];if(void 0!==t)if(void 0===n)n=t;else if(n!==t)return}return n}let mn=0;function gn(t){console.warn(t),++mn}function yn(t,{label:e,inset:n=0,insetTop:r=n,insetRight:o=n,insetBottom:i=n,insetLeft:a=n,round:l,nice:s,clamp:c,zero:u,align:f,padding:h,projection:d,facet:{label:p=e}={},...m}={}){const g={};for(const[n,y]of t){const t=m[n],v=Rn(n,y,{round:yt.get(n)===ft?l:void 0,nice:s,clamp:c,zero:u,align:f,padding:h,projection:d,...t});if(v){let{label:l=("fx"===n||"fy"===n?p:e),percent:s,transform:c,inset:u,insetTop:f=(void 0!==u?u:"y"===n?r:0),insetRight:h=(void 0!==u?u:"x"===n?o:0),insetBottom:d=(void 0!==u?u:"y"===n?i:0),insetLeft:m=(void 0!==u?u:"x"===n?a:0)}=t||{};if(null==c)c=void 0;else if("function"!=typeof c)throw new Error("invalid scale transform; not a function");v.percent=!!s,v.label=void 0===l?xn(y,v):l,v.transform=c,"x"===n||"fx"===n?(v.insetLeft=+m,v.insetRight=+h):"y"!==n&&"fy"!==n||(v.insetTop=+f,v.insetBottom=+d),g[n]=v}}return g}function vn(t){return Object.fromEntries(Object.entries(t).filter((([,{scale:t}])=>t)).map((([t,{scale:e,type:n,interval:r,label:o}])=>(e.type=n,null!=r&&(e.interval=r),null!=o&&(e.label=o),[t,e]))))}function xn(t=[],e){let n;for(const{label:e}of t)if(void 0!==e)if(void 0===n)n=e;else if(n!==e)return;if(!(void 0===n||Sn(e)&&/^(date|time|year)$/i.test(n)))return!Cn(e)&&e.percent&&(n=`${n} (%)`),{inferred:!0,toString:()=>n}}function wn(t){const{marginTop:e,marginRight:n,marginBottom:r,marginLeft:o,width:i,height:a,facet:{marginTop:l,marginRight:s,marginBottom:c,marginLeft:u}}=t;return{marginTop:Math.max(e,l),marginRight:Math.max(n,s),marginBottom:Math.max(r,c),marginLeft:Math.max(o,u),width:i,height:a}}function bn({fx:t,fy:e},n){const{marginTop:r,marginRight:o,marginBottom:i,marginLeft:a,width:l,height:s}=wn(n);return{marginTop:r,marginRight:o,marginBottom:i,marginLeft:a,width:t?t.scale.bandwidth()+a+o:l,height:e?e.scale.bandwidth()+r+i:s}}function kn(t,e){if(void 0===t.range){const{insetLeft:n,insetRight:r}=t,{width:o,marginLeft:i=0,marginRight:a=0}=e,l=i+n,s=o-a-r;t.range=[l,Math.max(l,s)],Cn(t)||(t.range=Ln(t)),t.scale.range(t.range)}Mn(t)}function $n(t,e){if(void 0===t.range){const{insetTop:n,insetBottom:r}=t,{height:o,marginTop:i=0,marginBottom:a=0}=e,l=i+n,s=o-a-r;t.range=[Math.max(l,s),l],Cn(t)?t.range.reverse():t.range=Ln(t),t.scale.range(t.range)}Mn(t)}function Mn(t){void 0===t.round&&function({type:t}){return"point"===t||"band"===t}(t)&&function({scale:t}){const e=t.domain().length,[n,r]=t.range(),o=t.paddingInner?t.paddingInner():1,i=t.paddingOuter?t.paddingOuter():t.padding(),a=e-o,l=Math.abs(r-n)/Math.max(1,a+2*i);return(l-Math.floor(l))*a}(t)<=30&&t.scale.round(!0)}function Ln(t){const e=t.scale.domain().length+Bn(t);if(!(e>2))return t.range;const[n,r]=t.range;return Array.from({length:e},((t,o)=>n+o/(e-1)*(r-n)))}function An(t,e,n){return Rn(t,void 0===n?void 0:[{hint:n}],{...e})}function Rn(t,n=[],r={}){const o=function(t,e,{type:n,domain:r,range:o,scheme:i,pivot:a,projection:l}){if("fx"===t||"fy"===t)return"band";"x"!==t&&"y"!==t||null==l||(n=On);for(const{type:t}of e)if(void 0!==t)if(void 0===n)n=t;else if(n!==t)throw new Error(`scale incompatible with channel: ${n} !== ${t}`);if(n===On)return;if(void 0!==n)return n;if(void 0===r&&!e.some((({value:t})=>void 0!==t)))return;const s=yt.get(t);if(s===dt)return"sqrt";if(s===mt||s===pt)return"linear";if(s===gt)return"ordinal";if((r||o||[]).length>2)return En(s);if(void 0!==r)return K(r)?En(s):tt(r)?"utc":s!==ht||null==a&&!De(i)?"linear":"diverging";const c=e.map((({value:t})=>t)).filter((t=>void 0!==t));return c.some(K)?En(s):c.some(tt)?"utc":s!==ht||null==a&&!De(i)?"linear":"diverging"}(t,n,r);if(void 0===r.type&&void 0===r.domain&&void 0===r.range&&null==r.interval&&"fx"!==t&&"fy"!==t&&Cn({type:o})){const e=n.map((({value:t})=>t)).filter((t=>void 0!==t));e.some(tt)?gn(`Warning: some data associated with the ${t} scale are dates. Dates are typically associated with a "utc" or "time" scale rather than a "${zn(o)}" scale. If you are using a bar mark, you probably want a rect mark with the interval option instead; if you are using a group transform, you probably want a bin transform instead. If you want to treat this data as ordinal, you can specify the interval of the ${t} scale (e.g., d3.utcDay), or you can suppress this warning by setting the type of the ${t} scale to "${zn(o)}".`):e.some(et)?gn(`Warning: some data associated with the ${t} scale are strings that appear to be dates (e.g., YYYY-MM-DD). If these strings represent dates, you should parse them to Date objects. Dates are typically associated with a "utc" or "time" scale rather than a "${zn(o)}" scale. If you are using a bar mark, you probably want a rect mark with the interval option instead; if you are using a group transform, you probably want a bin transform instead. If you want to treat this data as ordinal, you can suppress this warning by setting the type of the ${t} scale to "${zn(o)}".`):e.some(nt)&&gn(`Warning: some data associated with the ${t} scale are strings that appear to be numbers. If these strings represent numbers, you should parse or coerce them to numbers. Numbers are typically associated with a "linear" scale rather than a "${zn(o)}" scale. If you want to treat this data as ordinal, you can specify the interval of the ${t} scale (e.g., 1 for integers), or you can suppress this warning by setting the type of the ${t} scale to "${zn(o)}".`)}switch(r.type=o,o){case"diverging":case"diverging-sqrt":case"diverging-pow":case"diverging-log":case"diverging-symlog":case"cyclical":case"sequential":case"linear":case"sqrt":case"threshold":case"quantile":case"pow":case"log":case"symlog":r=Nn(n,r,jn);break;case"identity":switch(yt.get(t)){case ft:r=Nn(n,r,jn);break;case gt:r=Nn(n,r,Pn)}break;case"utc":case"time":r=Nn(n,r,Wn)}switch(o){case"diverging":return function(t,n,r){return en(t,e.scaleDiverging(),on,n,r)}(t,n,r);case"diverging-sqrt":return function(t,e,n){return nn(t,e,{...n,exponent:.5})}(t,n,r);case"diverging-pow":return nn(t,n,r);case"diverging-log":return function(t,n,{base:r=10,pivot:o=1,domain:i=Ue(n,o<0?St:Et),...a}){return en(t,e.scaleDivergingLog().base(r=+r),an,n,{domain:i,pivot:o,...a})}(t,n,r);case"diverging-symlog":return rn(t,n,r);case"categorical":case"ordinal":case cn:return fn(t,n,r);case"cyclical":case"sequential":case"linear":return function(t,n,r){return _e(t,e.scaleLinear(),n,r)}(t,n,r);case"sqrt":return function(t,e,n){return Ge(t,e,{...n,exponent:.5})}(t,n,r);case"threshold":return Xe(t,0,r);case"quantile":return function(t,n,{range:r,quantiles:o=(void 0===r?5:(r=[...r]).length),n:i=o,scheme:a="rdylbu",domain:l=Ke(n),interpolate:s,reverse:c}){return void 0===r&&(r=void 0!==s?e.quantize(s,i):yt.get(t)===ht?Ne(a,i):void 0),l.length>0&&(l=e.scaleQuantile(l,void 0===r?{length:i}:r).quantiles()),Xe(t,0,{domain:l,range:r,reverse:c})}(t,n,r);case"quantize":return function(t,n,{range:r,n:o=(void 0===r?5:(r=[...r]).length),scheme:i="rdylbu",domain:a=He(t,n),unknown:l,interpolate:s,reverse:c}){const[u,f]=e.extent(a);let h;return void 0===r?(h=e.ticks(u,f,o),h[0]<=u&&h.splice(0,1),h[h.length-1]>=f&&h.pop(),o=h.length+1,r=void 0!==s?e.quantize(s,o):yt.get(t)===ht?Ne(i,o):void 0):(h=e.quantize(e.interpolateNumber(u,f),o+1).slice(1,-1),u instanceof Date&&(h=h.map((t=>new Date(t))))),ct(O(a))<0&&h.reverse(),Xe(t,0,{domain:h,range:r,reverse:c,unknown:l})}(t,n,r);case"pow":return Ge(t,n,r);case"log":return function(t,n,{base:r=10,domain:o=Je(n),...i}){return _e(t,e.scaleLog().base(r),n,{...i,domain:o})}(t,n,r);case"symlog":return function(t,n,{constant:r=1,...o}){return _e(t,e.scaleSymlog().constant(r),n,o)}(t,n,r);case"utc":return function(t,n,r){return sn(t,e.scaleUtc(),n,r)}(t,n,r);case"time":return function(t,n,r){return sn(t,e.scaleTime(),n,r)}(t,n,r);case"point":return function(t,n,{align:r=.5,padding:o=.5,...i}){return hn(e.scalePoint().align(r).padding(o),n,i,t)}(t,n,r);case"band":return function(t,n,{align:r=.5,padding:o=.1,paddingInner:i=o,paddingOuter:a=("fx"===t||"fy"===t?0:o),...l}){return hn(e.scaleBand().align(r).paddingInner(i).paddingOuter(a),n,l,t)}(t,n,r);case"identity":return yt.get(t)===ft?{type:"identity",scale:e.scaleIdentity()}:{type:"identity"};case void 0:return;default:throw new Error(`unknown scale type: ${o}`)}}function zn(t){return"symbol"==typeof t?t.description:t}const On={toString:()=>"projection"};function En(t){switch(t){case ft:return"point";case ht:return cn;default:return"ordinal"}}function Sn({type:t}){return"time"===t||"utc"===t}function Cn({type:t}){return"ordinal"===t||"point"===t||"band"===t||t===cn}function Bn({type:t}){return"threshold"===t}function Tn(t){if(void 0===t)return!0;const e=t.domain(),n=t(e[0]);for(let r=1,o=e.length;r<o;++r)if(t(e[r])-n)return!1;return!0}function Nn(t,{domain:e,...n},r){for(const e of t)void 0!==e.value&&(e.value=r(e.value));return{domain:void 0===e?e:r(e),...n}}function Pn(t){return E(t,Mt)}function Wn(t){return E(t,qn)}function jn(t){return C(t)?t:E(t,Dn,Float64Array)}function Dn(t){return null==t?NaN:Number(t)}function qn(t){return t instanceof Date&&!isNaN(t)?t:"string"==typeof t?i(t):null==t||isNaN(t=+t)?void 0:new Date(t)}function Fn({scale:t,type:e,domain:n,range:r,interpolate:o,interval:i,transform:a,percent:l,pivot:s}){if("identity"===e)return{type:"identity",apply:t=>t,invert:t=>t};const c=t.unknown?t.unknown():void 0;return{type:e,domain:S(n),...void 0!==r&&{range:S(r)},...void 0!==a&&{transform:a},...l&&{percent:l},...void 0!==c&&{unknown:c},...void 0!==i&&{interval:i},...void 0!==o&&{interpolate:o},...t.clamp&&{clamp:t.clamp()},...void 0!==s&&{pivot:s,symmetric:!1},...t.base&&{base:t.base()},...t.exponent&&{exponent:t.exponent()},...t.constant&&{constant:t.constant()},...t.align&&{align:t.align(),round:t.round()},...t.padding&&(t.paddingInner?{paddingInner:t.paddingInner(),paddingOuter:t.paddingOuter()}:{padding:t.padding()}),...t.bandwidth&&{bandwidth:t.bandwidth(),step:t.step()},apply:e=>t(e),...t.invert&&{invert:e=>t.invert(e)}}}const Yn=Math.PI,In=2*Yn,_n=.618;function Gn({projection:t,inset:n=0,insetTop:r=n,insetRight:o=n,insetBottom:i=n,insetLeft:a=n}={},l){if(null==t)return;if("function"==typeof t.stream)return t;let s,c,u="frame";if(B(t)){let e;if(({type:t,domain:c,inset:e,insetTop:r=(void 0!==e?e:r),insetRight:o=(void 0!==e?e:o),insetBottom:i=(void 0!==e?e:i),insetLeft:a=(void 0!==e?e:a),clip:u=u,...s}=t),null==t)return}"function"!=typeof t&&({type:t}=Xn(t));const{width:f,height:h,marginLeft:d,marginRight:p,marginTop:m,marginBottom:g}=l,y=f-d-p-a-o,v=h-m-g-r-i;if(t=t?.({width:y,height:v,clip:u,...s}),null==t)return;u=function(t,n,r,o,i){if(!1===t||null==t||"number"==typeof t)return t=>t;!0===t&&(t="frame");if("frame"===`${t}`.toLowerCase())return e.geoClipRectangle(n,r,o,i);throw new Error(`unknown projection clip type: ${t}`)}(u,d,m,f-p,h-g);let x,w=d+a,b=m+r;if(null!=c){const[[n,r],[o,i]]=e.geoPath(t).bounds(c),a=Math.min(y/(o-n),v/(i-r));a>0?(w-=(a*(n+o)-y)/2,b-=(a*(r+i)-v)/2,x=e.geoTransform({point(t,e){this.stream.point(t*a+w,e*a+b)}})):gn("Warning: the projection could not be fit to the specified domain; using the default scale.")}return x??=0===w&&0===b?Vn():e.geoTransform({point(t,e){this.stream.point(t+w,e+b)}}),{stream:e=>t.stream(x.stream(u(e)))}}function Xn(t){switch(`${t}`.toLowerCase()){case"albers-usa":return Un(e.geoAlbersUsa,.7463,.4673);case"albers":return Hn(e.geoAlbers,.7463,.4673);case"azimuthal-equal-area":return Un(e.geoAzimuthalEqualArea,4,4);case"azimuthal-equidistant":return Un(e.geoAzimuthalEquidistant,In,In);case"conic-conformal":return Hn(e.geoConicConformal,In,In);case"conic-equal-area":return Hn(e.geoConicEqualArea,6.1702,2.9781);case"conic-equidistant":return Hn(e.geoConicEquidistant,7.312,3.6282);case"equal-earth":return Un(e.geoEqualEarth,5.4133,2.6347);case"equirectangular":return Un(e.geoEquirectangular,In,Yn);case"gnomonic":return Un(e.geoGnomonic,3.4641,3.4641);case"identity":return{type:Vn};case"reflect-y":return{type:Zn};case"mercator":return Un(e.geoMercator,In,In);case"orthographic":return Un(e.geoOrthographic,2,2);case"stereographic":return Un(e.geoStereographic,2,2);case"transverse-mercator":return Un(e.geoTransverseMercator,In,In);default:throw new Error(`unknown projection type: ${t}`)}}function Un(t,e,n){return{type:({width:r,height:o,rotate:i,precision:a=.15,clip:l})=>{const s=t();return null!=a&&s.precision?.(a),null!=i&&s.rotate?.(i),"number"==typeof l&&s.clipAngle?.(l),s.scale(Math.min(r/e,o/n)),s.translate([r/2,o/2]),s},aspectRatio:n/e}}function Hn(t,e,n){const{type:r,aspectRatio:o}=Un(t,e,n);return{type:t=>{const{parallels:e,domain:n,width:o,height:i}=t,a=r(t);return null!=e&&(a.parallels(e),void 0===n&&a.fitSize([o,i],{type:"Sphere"})),a},aspectRatio:o}}const Vn=$({stream:t=>t}),Zn=$(e.geoTransform({point(t,e){this.stream.point(t,-e)}}));function Qn(t,e,n,r,o){const i=n[t]&&"x"===n[t].scale,a=n[e]&&"y"===n[e].scale;if(i&&a)!function(t,e,n,r){const o=n[t],i=n[e],a=o.length,l=n[t]=new Float64Array(a).fill(NaN),s=n[e]=new Float64Array(a).fill(NaN);let c;const u=r.stream({point(t,e){l[c]=t,s[c]=e}});for(c=0;c<a;++c)u.point(o[c],i[c])}(t,e,r,o.projection);else{if(i)throw new Error(`projection requires paired x and y channels; ${t} is missing ${e}`);if(a)throw new Error(`projection requires paired x and y channels; ${e} is missing ${t}`)}}function Jn(t,e,n){const{x:r,y:o}=t;let i={};return r&&(i.x=r),o&&(i.y=o),i=be(i,e),n.projection&&Qn("x","y",t,i,n),r&&(i.x=jn(i.x)),o&&(i.y=jn(i.y)),i}function Kn(t={},e){const{document:n=("undefined"!=typeof window?window.document:void 0)}=t;return{document:n,projection:Gn(t,e)}}function tr(t,{document:n}){return e.select(e.creator(t).call(n.documentElement))}function er(t){let e,n;return(...r)=>((n?.length!==r.length||n.some(((t,e)=>t!==r[e])))&&(n=r,e=t(...r)),e)}const nr=er((t=>new Intl.NumberFormat(t))),rr=er(((t,e)=>new Intl.DateTimeFormat(t,{timeZone:"UTC",...e&&{month:e}}))),or=er(((t,e)=>new Intl.DateTimeFormat(t,{timeZone:"UTC",...e&&{weekday:e}})));function ir(t){return n(t,"Invalid Date")}const ar=function(t="en-US"){const e=function(t="en-US"){const e=nr(t);return t=>null==t||isNaN(t)?void 0:e.format(t)}(t);return t=>(t instanceof Date?ir:"number"==typeof t?e:v)(t)}(),lr="undefined"!=typeof window&&window.devicePixelRatio>1?0:.5;let sr=0;function cr(){return"plot-clip-"+ ++sr}function ur(t,{title:e,href:n,ariaLabel:r,ariaDescription:o,ariaHidden:i,target:a,fill:l,fillOpacity:s,stroke:c,strokeWidth:u,strokeOpacity:f,strokeLinejoin:h,strokeLinecap:d,strokeMiterlimit:p,strokeDasharray:m,strokeDashoffset:g,opacity:y,mixBlendMode:x,paintOrder:w,pointerEvents:b,shapeRendering:k},{ariaLabel:$,fill:M="currentColor",fillOpacity:R,stroke:z="none",strokeOpacity:O,strokeWidth:E,strokeLinecap:S,strokeLinejoin:C,strokeMiterlimit:B,paintOrder:T}){null===M&&(l=null,s=null),null===z&&(c=null,f=null),at(M)?at(z)||at(l)||(z="none"):at(z)&&!at(c)&&(M="none");const[N,P]=L(l,M),[W,j]=A(s,R),[D,q]=L(c,z),[F,Y]=A(f,O),[I,_]=A(y);lt(q)||(void 0===u&&(u=E),void 0===d&&(d=S),void 0===h&&(h=C),void 0!==p||/^\s*round\s*$/i.test(h)||(p=B),lt(P)||void 0!==w||(w=T));const[G,X]=A(u);return null!==M&&(t.fill=kr(P,"currentColor"),t.fillOpacity=$r(j,1)),null!==z&&(t.stroke=kr(q,"none"),t.strokeWidth=$r(X,1),t.strokeOpacity=$r(Y,1),t.strokeLinejoin=kr(h,"miter"),t.strokeLinecap=kr(d,"butt"),t.strokeMiterlimit=$r(p,4),t.strokeDasharray=kr(m,"none"),t.strokeDashoffset=kr(g,"0")),t.target=v(a),t.ariaLabel=v($),t.ariaDescription=v(o),t.ariaHidden=v(i),t.opacity=$r(_,1),t.mixBlendMode=kr(x,"normal"),t.paintOrder=kr(w,"normal"),t.pointerEvents=kr(b,"auto"),t.shapeRendering=kr(k,"auto"),{title:{value:e,optional:!0},href:{value:n,optional:!0},ariaLabel:{value:r,optional:!0},fill:{value:N,scale:"auto",optional:!0},fillOpacity:{value:W,scale:"opacity",optional:!0},stroke:{value:D,scale:"auto",optional:!0},strokeOpacity:{value:F,scale:"opacity",optional:!0},strokeWidth:{value:G,optional:!0},opacity:{value:I,scale:"opacity",optional:!0}}}function fr(t,e){e&&t.text((t=>ar(e[t])))}function hr(t,e){e&&t.text((([t])=>ar(e[t])))}function dr(t,{target:e},{ariaLabel:n,title:r,fill:o,fillOpacity:i,stroke:a,strokeOpacity:l,strokeWidth:s,opacity:c,href:u}){n&&wr(t,"aria-label",(t=>n[t])),o&&wr(t,"fill",(t=>o[t])),i&&wr(t,"fill-opacity",(t=>i[t])),a&&wr(t,"stroke",(t=>a[t])),l&&wr(t,"stroke-opacity",(t=>l[t])),s&&wr(t,"stroke-width",(t=>s[t])),c&&wr(t,"opacity",(t=>c[t])),u&&xr(t,(t=>u[t]),e),function(t,e){e&&t.filter((t=>zt(e[t]))).append("title").call(fr,e)}(t,r)}function pr(t,{target:e},{ariaLabel:n,title:r,fill:o,fillOpacity:i,stroke:a,strokeOpacity:l,strokeWidth:s,opacity:c,href:u}){n&&wr(t,"aria-label",(([t])=>n[t])),o&&wr(t,"fill",(([t])=>o[t])),i&&wr(t,"fill-opacity",(([t])=>i[t])),a&&wr(t,"stroke",(([t])=>a[t])),l&&wr(t,"stroke-opacity",(([t])=>l[t])),s&&wr(t,"stroke-width",(([t])=>s[t])),c&&wr(t,"opacity",(([t])=>c[t])),u&&xr(t,(([t])=>u[t]),e),function(t,e){e&&t.filter((([t])=>zt(e[t]))).append("title").call(hr,e)}(t,r)}function mr(t,n,r){const o=e.group(t,(t=>n[t]));return void 0===r&&o.size>t.length>>1&&gn("Warning: the implicit z channel has high cardinality. This may occur when the fill or stroke channel is associated with quantitative data rather than ordinal or categorical data. You can suppress this warning by setting the z option explicitly; if this data represents a single series, set z to null."),o.values()}function*gr(t,e,{z:n},r){const{z:o}=r,i=function({ariaLabel:t,title:e,fill:n,fillOpacity:r,stroke:o,strokeOpacity:i,strokeWidth:a,opacity:l,href:s}){return[t,e,n,r,o,i,a,l,s].filter((t=>void 0!==t))}(r),a=[...e,...i];for(const e of o?mr(t,o,n):[t]){let t,n;t:for(const r of e){for(const t of a)if(!Lt(t[r])){n&&n.push(-1);continue t}if(void 0!==t){n.push(r);for(let e=0;e<i.length;++e){if(Y(i[e][r])!==t[e]){yield n,t=i.map((t=>Y(t[r]))),n=[r];continue t}}}else n&&(yield n),t=i.map((t=>Y(t[r]))),n=[r]}n&&(yield n)}}function yr(t,n,r,o){!function(t,n,r,o){let i;switch(n.clip){case"frame":{const{width:e,height:n,marginLeft:a,marginRight:l,marginTop:s,marginBottom:c}=r,u=cr();i=`url(#${u})`,t=tr("svg:g",o).call((t=>t.append("svg:clipPath").attr("id",u).append("rect").attr("x",a).attr("y",s).attr("width",e-l-a).attr("height",n-s-c))).each((function(){this.appendChild(t.node()),t.node=()=>this}));break}case"sphere":{const{projection:n}=o;if(!n)throw new Error('the "sphere" clip option requires a projection');const r=cr();i=`url(#${r})`,t.append("clipPath").attr("id",r).append("path").attr("d",e.geoPath(n)({type:"Sphere"}));break}}wr(t,"aria-label",n.ariaLabel),wr(t,"aria-description",n.ariaDescription),wr(t,"aria-hidden",n.ariaHidden),wr(t,"clip-path",i)}(t,n,r,o),wr(t,"fill",n.fill),wr(t,"fill-opacity",n.fillOpacity),wr(t,"stroke",n.stroke),wr(t,"stroke-width",n.strokeWidth),wr(t,"stroke-opacity",n.strokeOpacity),wr(t,"stroke-linejoin",n.strokeLinejoin),wr(t,"stroke-linecap",n.strokeLinecap),wr(t,"stroke-miterlimit",n.strokeMiterlimit),wr(t,"stroke-dasharray",n.strokeDasharray),wr(t,"stroke-dashoffset",n.strokeDashoffset),wr(t,"shape-rendering",n.shapeRendering),wr(t,"paint-order",n.paintOrder),wr(t,"pointer-events",n.pointerEvents)}function vr(t,e){!function(t,e,n){null!=n&&t.style(e,n)}(t,"mix-blend-mode",e.mixBlendMode),wr(t,"opacity",e.opacity)}function xr(t,n,r){t.each((function(t){const o=n(t);if(null!=o){const t=this.ownerDocument.createElementNS(e.namespaces.svg,"a");t.setAttribute("fill","inherit"),t.setAttributeNS(e.namespaces.xlink,"href",o),null!=r&&t.setAttribute("target",r),this.parentNode.insertBefore(t,this).appendChild(this)}}))}function wr(t,e,n){null!=n&&t.attr(e,n)}function br(t,e,{x:n,y:r},o=lr,i=lr){o+=e.dx,i+=e.dy,n?.bandwidth&&(o+=n.bandwidth()/2),r?.bandwidth&&(i+=r.bandwidth()/2),(o||i)&&t.attr("transform",`translate(${o},${i})`)}function kr(t,e){if((t=v(t))!==e)return t}function $r(t,e){if((t=x(t))!==e)return t}const Mr=/^-?([_a-z]|[\240-\377]|\\[0-9a-f]{1,6}(\r\n|[ \t\r\n\f])?|\\[^\r\n\f0-9a-f])([_a-z0-9-]|[\240-\377]|\\[0-9a-f]{1,6}(\r\n|[ \t\r\n\f])?|\\[^\r\n\f0-9a-f])*$/;function Lr(t){if(void 0===t)return`plot-${Math.random().toString(16).slice(2)}`;if(t=`${t}`,!Mr.test(t))throw new Error(`invalid class name: ${t}`);return t}function Ar(t,e){if("string"==typeof e)t.property("style",e);else if(null!=e)for(const n of t)Object.assign(n.style,e)}function Rr({frameAnchor:t},{width:e,height:n,marginTop:r,marginRight:o,marginBottom:i,marginLeft:a}){return[/left$/.test(t)?a:/right$/.test(t)?e-o:(a+e-o)/2,/^top/.test(t)?r:/^bottom/.test(t)?n-i:(r+n-i)/2]}function zr({x:t,y:e,fy:n,fx:r},o,{projection:i,aspectRatio:a},{width:l,marginTopDefault:s,marginRightDefault:c,marginBottomDefault:u,marginLeftDefault:f}){const h=n?n.scale.domain().length:1,d=function(t,e){if("function"==typeof t?.stream)return _n;if(B(t)&&(t=t.type),null==t)return function(t){for(const e of t)if(e.channels.geometry)return!0;return!1}(e)?_n:void 0;if("function"!=typeof t){const{aspectRatio:e}=Xn(t);if(e)return e}return _n}(i,o);if(d){const t=(1.1*h-.1)/(1.1*(r?r.scale.domain().length:1)-.1)*d,e=Math.max(.1,Math.min(10,t));return Math.round((l-f-c)*e+s+u)}const p=e?Cn(e)?e.scale.domain().length:Math.max(7,17/h):1;if(null!=a){if(a=+a,!(isFinite(a)&&a>0))throw new Error(`invalid aspectRatio: ${a}`);const o=Or("y",e)/(Or("x",t)*a),i=r?r.scale.bandwidth():1,h=n?n.scale.bandwidth():1;return(o*(i*(l-f-c)-t.insetLeft-t.insetRight)+e.insetTop+e.insetBottom)/h+s+u}return!(!e&&!n)*Math.max(1,Math.min(60,p*h))*20+30*!!r+60}function Or(t,n){if(!n)throw new Error(`aspectRatio requires ${t} scale`);const{type:r,domain:o}=n;let i;switch(r){case"linear":case"utc":case"time":i=Number;break;case"pow":{const t=n.scale.exponent();i=e=>Math.pow(e,t);break}case"log":i=Math.log;break;case"point":case"band":return o.length;default:throw new Error(`unsupported ${t} scale for aspectRatio: ${r}`)}const[a,l]=e.extent(o);return Math.abs(i(l)-i(a))}function Er(t,{fx:n,fy:r}){const o=q(t),i=n?.value,a=r?.value;return n&&r?e.rollup(o,(t=>(t.fx=i[t[0]],t.fy=a[t[0]],t)),(t=>i[t]),(t=>a[t])):n?e.rollup(o,(t=>(t.fx=i[t[0]],t)),(t=>i[t])):e.rollup(o,(t=>(t.fy=a[t[0]],t)),(t=>a[t]))}function Sr(t){const n=[],r=new Uint32Array(e.sum(t,(t=>t.length)));for(const e of t){let o=0;for(const n of t)e!==n&&(r.set(n,o),o+=n.length);n.push(r.slice(0,o))}return n}const Cr=new Map([["top",Br],["right",Pr],["bottom",Tr],["left",Nr],["top-left",Wr(Br,Nr)],["top-right",Wr(Br,Pr)],["bottom-left",Wr(Tr,Nr)],["bottom-right",Wr(Tr,Pr)],["top-empty",function(t,{y:e},{x:n,y:r,empty:o}){if(o)return!1;const i=e?.indexOf(r);if(i>0){const r=e[i-1];return t.find((t=>t.x===n&&t.y===r))?.empty}}],["right-empty",function(t,{x:e},{x:n,y:r,empty:o}){if(o)return!1;const i=e?.indexOf(n);if(i<e?.length-1){const n=e[i+1];return t.find((t=>t.x===n&&t.y===r))?.empty}}],["bottom-empty",function(t,{y:e},{x:n,y:r,empty:o}){if(o)return!1;const i=e?.indexOf(r);if(i<e?.length-1){const r=e[i+1];return t.find((t=>t.x===n&&t.y===r))?.empty}}],["left-empty",function(t,{x:e},{x:n,y:r,empty:o}){if(o)return!1;const i=e?.indexOf(n);if(i>0){const n=e[i-1];return t.find((t=>t.x===n&&t.y===r))?.empty}}],["empty",function(t,e,{empty:n}){return n}]]);function Br(t,{y:e},{y:n}){return!e||0===e.indexOf(n)}function Tr(t,{y:e},{y:n}){return!e||e.indexOf(n)===e.length-1}function Nr(t,{x:e},{x:n}){return!e||0===e.indexOf(n)}function Pr(t,{x:e},{x:n}){return!e||e.indexOf(n)===e.length-1}function Wr(t,e){return function(){return t.apply(null,arguments)&&e.apply(null,arguments)}}function jr(t,{channels:{fx:e,fy:n},groups:r}){return e&&n?t.map((({x:t,y:e})=>r.get(t)?.get(e)??[])):e?t.map((({x:t})=>r.get(t)??[])):t.map((({y:t})=>r.get(t)??[]))}function Dr(t){return Cn(t)&&void 0===t.interval?void 0:"tabular-nums"}function qr(t,e){if(null==e)return e;const n=t(e);if(!n)throw new Error(`scale not found: ${e}`);return n}function Fr(t,n={},r,o){let{columns:i,tickFormat:a,fontVariant:l=Dr(t),swatchSize:s=15,swatchWidth:c=s,swatchHeight:u=s,marginLeft:f=0,className:h,style:d,width:p}=n;const m=Kn(n);h=Lr(h),a=function(t,n){return void 0===t?tt(n)?ir:v:"function"==typeof t?t:("string"==typeof t?tt(n)?e.utcFormat:e.format:$)(t)}(a,t.domain);const g=tr("div",m).attr("class",h).attr("style",`\n        --swatchWidth: ${+c}px;\n        --swatchHeight: ${+u}px;\n      `);let y;return null!=i?(y=`\n      .${h}-swatch {\n        display: flex;\n        align-items: center;\n        break-inside: avoid;\n        padding-bottom: 1px;\n      }\n      .${h}-swatch::before {\n        flex-shrink: 0;\n      }\n      .${h}-label {\n        white-space: nowrap;\n        overflow: hidden;\n        text-overflow: ellipsis;\n      }\n    `,g.style("columns",i).selectAll().data(t.domain).enter().append("div").attr("class",`${h}-swatch`).call(r,t).call((t=>t.append("div").attr("class",`${h}-label`).attr("title",a).text(a)))):(y=`\n      .${h} {\n        display: flex;\n        align-items: center;\n        min-height: 33px;\n        flex-wrap: wrap;\n      }\n      .${h}-swatch {\n        display: inline-flex;\n        align-items: center;\n        margin-right: 1em;\n      }\n    `,g.selectAll().data(t.domain).enter().append("span").attr("class",`${h}-swatch`).call(r,t).append((function(){return this.ownerDocument.createTextNode(a.apply(this,arguments))}))),g.call((t=>t.insert("style","*").text(`\n        .${h} {\n          font-family: system-ui, sans-serif;\n          font-size: 10px;\n          margin-bottom: 0.5em;${void 0===f?"":`\n          margin-left: ${+f}px;`}${void 0===p?"":`\n          width: ${p}px;`}\n        }\n        ${o(h)}\n        ${y}\n      `))).style("font-variant",kr(l,"normal")).call(Ar,d).node()}const Yr=new Map([["symbol",function(t,{fill:n=(void 0!==t.hint?.fill?t.hint.fill:"none"),fillOpacity:r=1,stroke:o=(void 0!==t.hint?.stroke?t.hint.stroke:at(n)?"currentColor":"none"),strokeOpacity:i=1,strokeWidth:a=1.5,r:l=4.5,...s}={},c){const[u,f]=L(n),[h,d]=L(o),p=qr(c,u),m=qr(c,h),g=l*l*Math.PI;return r=A(r)[1],i=A(i)[1],a=A(a)[1],Fr(t,s,(n=>n.append("svg").attr("viewBox","-8 -8 16 16").attr("fill","color"===u?t=>p.scale(t):null).attr("stroke","color"===h?t=>m.scale(t):null).append("path").attr("d",(n=>{const r=e.pathRound();return t.scale(n).draw(r,g),r}))),(t=>`.${t}-swatch > svg {\n        width: var(--swatchWidth);\n        height: var(--swatchHeight);\n        margin-right: 0.5em;\n        overflow: visible;\n        fill: ${f};\n        fill-opacity: ${r};\n        stroke: ${d};\n        stroke-width: ${a}px;\n        stroke-opacity: ${i};\n      }`))}],["color",_r],["opacity",function({type:t,interpolate:n,...r},{legend:o=!0,color:i=e.rgb(0,0,0),...a}){if(!n)throw new Error(`${t} opacity scales are not supported`);!0===o&&(o="ramp");if("ramp"!==`${o}`.toLowerCase())throw new Error(`${o} opacity legends are not supported`);return _r({type:t,...r,interpolate:Gr(i)},{legend:o,...a})}]]);function Ir(t,{label:e,ticks:n,tickFormat:r}={},o){return function(t={},...e){let n=t;for(const r of e)for(const e in r)if(void 0===n[e]){const o=r[e];n===t?n={...n,[e]:o}:n[e]=o}return n}(o,t,{label:e,ticks:n,tickFormat:r})}function _r(t,{legend:n=!0,...r}){if(!0===n&&(n="ordinal"===t.type?"swatches":"ramp"),void 0!==t.domain)switch(`${n}`.toLowerCase()){case"swatches":return function(t,e){if(!Cn(t)&&!Bn(t))throw new Error(`swatches legend requires ordinal or threshold color scale (not ${t.type})`);return Fr(t,e,((t,e)=>t.append("svg").attr("fill",e.scale).append("rect").attr("width","100%").attr("height","100%")),(t=>`.${t}-swatch svg {\n        width: var(--swatchWidth);\n        height: var(--swatchHeight);\n        margin-right: 0.5em;\n      }`))}(t,r);case"ramp":return function(t,n){let{label:r=t.label,tickSize:o=6,width:i=240,height:a=44+o,marginTop:l=18,marginRight:s=0,marginBottom:c=16+o,marginLeft:u=0,style:f,ticks:h=(i-u-s)/64,tickFormat:d,fontVariant:p=Dr(t),round:m=!0,className:g}=n;const y=Kn(n);g=Lr(g),null===d&&(d=()=>null);const v=tr("svg",y).attr("class",g).attr("font-family","system-ui, sans-serif").attr("font-size",10).attr("width",i).attr("height",a).attr("viewBox",`0 0 ${i} ${a}`).call((t=>t.append("style").text(`\n        .${g} {\n          display: block;\n          background: white;\n          height: auto;\n          height: intrinsic;\n          max-width: 100%;\n          overflow: visible;\n        }\n        .${g} text {\n          white-space: pre;\n        }\n      `))).call(Ar,f);let x,w=t=>t.selectAll(".tick line").attr("y1",l+c-a);const b=m?(t,e)=>t.rangeRound(e):(t,e)=>t.range(e),{type:k,domain:$,range:M,interpolate:L,scale:A,pivot:R}=t;if(L){const t=void 0===M?L:e.piecewise(1===L.length?tn(L):L,M);x=b(A.copy(),e.quantize(e.interpolateNumber(u,i-s),Math.min($.length+(void 0!==R),void 0===M?1/0:M.length)));const n=256,r=y.document.createElement("canvas");r.width=n,r.height=1;const o=r.getContext("2d");for(let e=0,r=n-1;e<n;++e)o.fillStyle=t(e/r),o.fillRect(e,0,1,1);v.append("image").attr("x",u).attr("y",l).attr("width",i-u-s).attr("height",a-l-c).attr("preserveAspectRatio","none").attr("xlink:href",r.toDataURL())}else if("threshold"===k){const t=$,n=void 0===d?t=>t:"string"==typeof d?e.format(d):d;x=b(e.scaleLinear().domain([-1,M.length-1]),[u,i-s]),v.append("g").selectAll().data(M).enter().append("rect").attr("x",((t,e)=>x(e-1))).attr("y",l).attr("width",((t,e)=>x(e)-x(e-1))).attr("height",a-l-c).attr("fill",(t=>t)),h=E(t,((t,e)=>e)),d=e=>n(t[e],e)}else x=b(e.scaleBand().domain($),[u,i-s]),v.append("g").selectAll().data($).enter().append("rect").attr("x",x).attr("y",l).attr("width",Math.max(0,x.bandwidth()-1)).attr("height",a-l-c).attr("fill",A),w=()=>{};return v.append("g").attr("transform",`translate(0,${a-c})`).call(e.axisBottom(x).ticks(Array.isArray(h)?null:h,"string"==typeof d?d:void 0).tickFormat("function"==typeof d?d:void 0).tickSize(o).tickValues(Array.isArray(h)?h:null)).attr("font-size",null).attr("font-family",null).attr("font-variant",kr(p,"normal")).call(w).call((t=>t.select(".domain").remove())),void 0!==r&&v.append("text").attr("x",u).attr("y",l-6).attr("fill","currentColor").attr("font-weight","bold").text(r),v.node()}(t,r);default:throw new Error(`unknown legend type: ${n}`)}}function Gr(t){const{r:n,g:r,b:o}=e.rgb(t)||e.rgb(0,0,0);return t=>`rgba(${n},${r},${o},${t})`}class Xr{constructor(t,e={},n={},r){const{facet:o="auto",facetAnchor:i,fx:a,fy:l,sort:s,dx:c=0,dy:u=0,margin:f=0,marginTop:h=f,marginRight:d=f,marginBottom:p=f,marginLeft:m=f,clip:g,channels:y}=n;if(this.data=t,this.sort=P(s)?s:null,this.initializer=Bt(n).initializer,this.transform=this.initializer?n.transform:Ct(n).transform,null===o||!1===o?this.facet=null:(this.facet=z(!0===o?"include":o,"facet",["auto","include","exclude","super"]),this.fx=a,this.fy=l),this.facetAnchor=function(t){if(null==t)return null;const e=Cr.get(`${t}`.toLowerCase());if(e)return e;throw new Error(`invalid facet anchor: ${t}`)}(i),e=ut(e),void 0!==y&&(e={...ut(y),...e}),void 0!==r&&(e={...ur(this,n,r),...e}),this.channels=Object.fromEntries(Object.entries(e).map((([t,e])=>{const{value:n}=e;return N(n)&&(e={...e,value:n.value},void 0!==n.scale&&(e.scale=n.scale)),[t,e]})).filter((([t,{value:e,optional:n}])=>{if(null!=e)return!0;if(n)return!1;throw new Error(`missing channel value: ${t}`)}))),this.dx=+c,this.dy=+u,this.marginTop=+h,this.marginRight=+d,this.marginBottom=+p,this.marginLeft=+m,this.clip=function(t){return!0===t?t="frame":!1===t&&(t=null),R(t,"clip",["frame","sphere"])}(g),"super"===this.facet){if(a||l)throw new Error("super-faceting cannot use fx or fy");for(const t in this.channels){const{scale:n}=e[t];if("x"===n||"y"===n)throw new Error("super-faceting cannot use x or y")}}}initialize(t,n){let r=O(this.data);void 0===t&&null!=r&&(t=[q(r)]),null!=this.transform&&(({facets:t,data:r}=this.transform(r,t)),r=O(r));const o=we(this.channels,r);return null!=this.sort&&function(t,n,r,o){const{reverse:i,reduce:a=!0,limit:l}=o;for(const s in o){if(!yt.has(s))continue;let{value:c,reverse:u=i,reduce:f=a,limit:h=l}=V(o[s]);if(void 0===u&&(u="width"===c||"height"===c),null==f||!1===f)continue;const d=$e(t,s)||n&&$e(n,s);if(!d)throw new Error(`missing channel for scale: ${s}`);const p=d.value,[m=0,g=1/0]=Q(h)?h:h<0?[h]:[0,h];if(null==c)d.domain=()=>{let t=p;return u&&(t=t.slice().reverse()),0===m&&g===1/0||(t=t.slice(m,g)),t};else{const n="data"===c?r:"height"===c?Me(t,"y1","y2"):"width"===c?Me(t,"x1","x2"):Le(t,c,"y"===c?"y2":"x"===c?"x2":void 0),o=Kt(!0===f?"max":f,n);d.domain=()=>{let t=e.rollup(q(p),(t=>o.reduce(t,n)),(t=>p[t]));return t=e.sort(t,u?Re:Ae),0===m&&g===1/0||(t=t.slice(m,g)),t.map(w)}}}}(o,n,r,this.sort),{data:r,facets:t,channels:o}}filter(t,e,n){for(const r in e){const{filter:o=Lt}=e[r];if(null!==o){const e=n[r];t=t.filter((t=>o(e[t])))}}return t}project(t,e,n){Qn("x","y",t,e,n),Qn("x1","y1",t,e,n),Qn("x2","y2",t,e,n)}scale(t,e,n){const r=be(t,e);return n.projection&&this.project(t,r,n),r}}function Ur(...t){return t.plot=Xr.prototype.plot,t}const Hr=Math.PI/180;function Vr({inset:t,insetLeft:e,insetRight:n,...r}={}){return[e,n]=Qr(t,e,n),{inset:t,insetLeft:e,insetRight:n,...r}}function Zr({inset:t,insetTop:e,insetBottom:n,...r}={}){return[e,n]=Qr(t,e,n),{inset:t,insetTop:e,insetBottom:n,...r}}function Qr(t,e,n){return void 0===t&&void 0===e&&void 0===n?lr?[1,0]:[.5,.5]:[e,n]}function Jr(t,{interval:e}){return(t={...V(t)}).interval=H(void 0===t.interval?e:t.interval),t}function Kr(t,e,n,r){const{[t]:o,[`${t}1`]:i,[`${t}2`]:a}=n,{value:l,interval:s}=Jr(o,n);if(null==l||null==s&&!r)return n;const c=X(o);if(null==s){let e;const r={transform:t=>e||(e=h(t,l)),label:c};return{...n,[t]:void 0,[`${t}1`]:void 0===i?r:i,[`${t}2`]:void 0===a?r:a}}let u,f;function d(t){return void 0!==f&&t===u?f:f=E(h(u=t,l),(t=>s.floor(t)))}return e({...n,[t]:void 0,[`${t}1`]:void 0===i?{transform:d,label:c}:i,[`${t}2`]:void 0===a?{transform:t=>d(t).map((t=>s.offset(t))),label:c}:a})}function to(t,e,n){const{[t]:r}=n,{value:o,interval:i}=Jr(r,n);return null==o||null==i?n:e({...n,[t]:{label:X(r),transform:t=>{const e=E(h(t,o),(t=>i.floor(t))),n=e.map((t=>i.offset(t)));return e.map(tt(e)?(t,e)=>null==t||isNaN(t=+t)||null==(e=n[e])||isNaN(e=+e)?void 0:new Date((t+e)/2):(t,e)=>null==t||null==(e=n[e])?NaN:(+t+ +e)/2)}}})}function eo(t={}){return Kr("x",Vr,t,!0)}function no(t={}){return Kr("y",Zr,t,!0)}function ro(t={}){return Kr("x",Vr,t)}function oo(t={}){return Kr("y",Zr,t)}function io(t={}){return to("x",Vr,t)}function ao(t={}){return to("y",Zr,t)}const lo={ariaLabel:"rule",fill:null,stroke:"currentColor"};class so extends Xr{constructor(t,e={}){const{x:n,y1:r,y2:o,inset:i=0,insetTop:a=i,insetBottom:l=i}=e;super(t,{x:{value:n,scale:"x",optional:!0},y1:{value:r,scale:"y",optional:!0},y2:{value:o,scale:"y",optional:!0}},e,lo),this.insetTop=x(a),this.insetBottom=x(l)}render(t,e,n,r,o){const{x:i,y:a}=e,{x:l,y1:s,y2:c}=n,{width:u,height:f,marginTop:h,marginRight:d,marginLeft:p,marginBottom:m}=r,{insetTop:g,insetBottom:y}=this;return tr("svg:g",o).call(yr,this,r).call(br,this,{x:l&&i},lr,0).call((e=>e.selectAll().data(t).enter().append("line").call(vr,this).attr("x1",l?t=>l[t]:(p+u-d)/2).attr("x2",l?t=>l[t]:(p+u-d)/2).attr("y1",s&&!Tn(a)?t=>s[t]+g:h+g).attr("y2",c&&!Tn(a)?a.bandwidth?t=>c[t]+a.bandwidth()-y:t=>c[t]-y:f-m-y).call(dr,this,n))).node()}}class co extends Xr{constructor(t,e={}){const{x1:n,x2:r,y:o,inset:i=0,insetRight:a=i,insetLeft:l=i}=e;super(t,{y:{value:o,scale:"y",optional:!0},x1:{value:n,scale:"x",optional:!0},x2:{value:r,scale:"x",optional:!0}},e,lo),this.insetRight=x(a),this.insetLeft=x(l)}render(t,e,n,r,o){const{x:i,y:a}=e,{y:l,x1:s,x2:c}=n,{width:u,height:f,marginTop:h,marginRight:d,marginLeft:p,marginBottom:m}=r,{insetLeft:g,insetRight:y}=this;return tr("svg:g",o).call(yr,this,r,o).call(br,this,{y:l&&a},0,lr).call((e=>e.selectAll().data(t).enter().append("line").call(vr,this).attr("x1",s&&!Tn(i)?t=>s[t]+g:p+g).attr("x2",c&&!Tn(i)?i.bandwidth?t=>c[t]+i.bandwidth()-y:t=>c[t]-y:u-d-y).attr("y1",l?t=>l[t]:(h+f-m)/2).attr("y2",l?t=>l[t]:(h+f-m)/2).call(dr,this,n))).node()}}function uo(t,e){let{x:n=m,y:r,y1:o,y2:i,...a}=oo(e);return[o,i]=ho(r,o,i),new so(t,{...a,x:n,y1:o,y2:i})}function fo(t,e){let{y:n=m,x:r,x1:o,x2:i,...a}=ro(e);return[o,i]=ho(r,o,i),new co(t,{...a,y:n,x1:o,x2:i})}function ho(t,e,n){if(void 0===t){if(void 0===e){if(void 0!==n)return[0,n]}else if(void 0===n)return[0,e]}else{if(void 0===e)return void 0===n?[0,t]:[t,n];if(void 0===n)return[t,e]}return[e,n]}function po(t,...e){let n=e.length;for(let r=0,o=!0;r<n;++r)"function"!=typeof e[r]&&(o&&(t=t.slice(),o=!1),t.splice(r,2,t[r]+e[r]+t[r+1]),e.splice(r,1),--r,--n);return r=>{let o=t[0];for(let i=0;i<n;++i)o+=e[i](r)+t[i+1];return o}}const mo={ariaLabel:"text",strokeLinejoin:"round",strokeWidth:3,paintOrder:"stroke"},go="­";class yo extends Xr{constructor(t,e={}){const{x:n,y:r,text:o=(Q(t)&&J(t)?m:p),frameAnchor:i,textAnchor:a=(/right$/i.test(i)?"end":/left$/i.test(i)?"start":"middle"),lineAnchor:l=(/^top/i.test(i)?"top":/^bottom/i.test(i)?"bottom":"middle"),lineHeight:s=1,lineWidth:c=1/0,textOverflow:u,monospace:f,fontFamily:d=(f?"ui-monospace, monospace":void 0),fontSize:g,fontStyle:y,fontVariant:x,fontWeight:w,rotate:b}=e,[k,$]=A(b,0),[M,L]=function(t){return null==t||"number"==typeof t?[void 0,t]:"string"!=typeof t?[t,void 0]:(t=t.trim().toLowerCase(),$o.has(t)||/^[+-]?\d*\.?\d+(e[+-]?\d+)?(\w*|%)$/.test(t)?[void 0,t]:[t,void 0])}(g);var R;if(super(t,{x:{value:n,scale:"x",optional:!0},y:{value:r,scale:"y",optional:!0},fontSize:{value:M,optional:!0},rotate:{value:(R=k,null==R?null:{transform:t=>h(t,R,Float64Array),label:X(R)}),optional:!0},text:{value:o,filter:zt,optional:!0}},e,mo),this.rotate=$,this.textAnchor=kr(a,"middle"),this.lineAnchor=z(l,"lineAnchor",["top","middle","bottom"]),this.lineHeight=+s,this.lineWidth=+c,this.textOverflow=function(t){return null==t?null:z(t,"textOverflow",["clip","ellipsis","clip-start","clip-end","ellipsis-start","ellipsis-middle","ellipsis-end"]).replace(/^(clip|ellipsis)$/,"$1-end")}(u),this.monospace=!!f,this.fontFamily=v(d),this.fontSize=L,this.fontStyle=v(y),this.fontVariant=v(x),this.fontWeight=v(w),this.frameAnchor=st(i),!(this.lineWidth>=0))throw new Error(`invalid lineWidth: ${c}`);this.splitLines=function({monospace:t,lineWidth:e,textOverflow:n}){if(null!=n||e==1/0)return t=>t.split(/\r\n?|\n/g);const r=t?Ao:Lo,o=100*e;return t=>function(t,e,n){const r=[];let o,i=0;for(const[a,l,s]of function*(t){let e=0,n=0;const r=t.length;for(;n<r;){let r=1;switch(t[n]){case go:case"-":++n,yield[e,n,!1],e=n;break;case" ":for(yield[e,n,!1];" "===t[++n];);e=n;break;case"\r":"\n"===t[n+1]&&++r;case"\n":yield[e,n,!0],n+=r,e=n;break;default:++n}}yield[e,n,!0]}(t))void 0===o&&(o=a),i>o&&n(t,o,l)>e&&(r.push(t.slice(o,i)+(t[i-1]===go?"-":"")),o=a),s?(r.push(t.slice(o,l)),o=void 0):i=l;return r}(t,o,r)}(this),this.clipLine=function({monospace:t,lineWidth:e,textOverflow:n}){if(null==n||e==1/0)return t=>t;const r=t?Ao:Lo,o=100*e;switch(n){case"clip-start":return t=>Oo(t,o,r,"");case"clip-end":return t=>zo(t,o,r,"");case"ellipsis-start":return t=>Oo(t,o,r,"…");case"ellipsis-middle":return t=>function(t,e,n,r){t=t.trim();const o=n(t);if(o<=e)return t;const i=n(r)/2,[a,l]=Ro(t,e/2,n,i),[s]=Ro(t,o-e/2-l+i,n,-i);return s<0?r:t.slice(0,a).trimEnd()+r+t.slice(Co(t,s)).trimStart()}(t,o,r,"…");case"ellipsis-end":return t=>zo(t,o,r,"…")}}(this)}render(t,e,n,r,o){const{x:i,y:a}=e,{x:l,y:s,rotate:c,text:u,title:f,fontSize:h}=n,{rotate:d}=this,[p,m]=Rr(this,r);return tr("svg:g",o).call(yr,this,r,o).call(ko,this,u,r).call(br,this,{x:l&&i,y:s&&a}).call((e=>e.selectAll().data(t).enter().append("text").call(vr,this).call(vo,this,u,f).attr("transform",po`translate(${l?t=>l[t]:p},${s?t=>s[t]:m})${c?t=>` rotate(${c[t]})`:d?` rotate(${d})`:""}`).call(wr,"font-size",h&&(t=>h[t])).call(dr,this,n))).node()}}function vo(t,n,r,o){if(!r)return;const{lineAnchor:i,lineHeight:a,textOverflow:l,splitLines:s,clipLine:c}=n;t.each((function(t){const n=s(ar(r[t])).map(c),u=n.length,f="top"===i?.71:"bottom"===i?1-u:(164-100*u)/200;if(u>1)for(let t=0;t<u;++t){if(!n[t])continue;const r=this.ownerDocument.createElementNS(e.namespaces.svg,"tspan");r.setAttribute("x",0),r.setAttribute("y",(f+t)*a+"em"),r.textContent=n[t],this.appendChild(r)}else f&&this.setAttribute("y",f*a+"em"),this.textContent=n[0];if(l&&!o&&n[0]!==r[t]){const n=this.ownerDocument.createElementNS(e.namespaces.svg,"title");n.textContent=r[t],this.appendChild(n)}}))}function xo(t,e={}){let{x:n,y:r,...o}=e;return void 0===e.frameAnchor&&([n,r]=j(n,r)),new yo(t,{...o,x:n,y:r})}function wo(t,e={}){const{x:n=m,...r}=e;return new yo(t,ao({...r,x:n}))}function bo(t,e={}){const{y:n=m,...r}=e;return new yo(t,io({...r,y:n}))}function ko(t,e,n){wr(t,"text-anchor",e.textAnchor),wr(t,"font-family",e.fontFamily),wr(t,"font-size",e.fontSize),wr(t,"font-style",e.fontStyle),wr(t,"font-variant",void 0===e.fontVariant?function(t){return rt(t)||tt(t)?"tabular-nums":void 0}(n):e.fontVariant),wr(t,"font-weight",e.fontWeight)}const $o=new Set(["inherit","initial","revert","unset","xx-small","x-small","small","medium","large","x-large","xx-large","xxx-large","larger","smaller"]);const Mo={a:56,b:63,c:57,d:63,e:58,f:37,g:62,h:60,i:26,j:26,k:55,l:26,m:88,n:60,o:60,p:62,q:62,r:39,s:54,t:38,u:60,v:55,w:79,x:54,y:55,z:55,A:69,B:67,C:73,D:74,E:61,F:58,G:76,H:75,I:28,J:55,K:67,L:58,M:89,N:75,O:78,P:65,Q:78,R:67,S:65,T:65,U:75,V:69,W:98,X:69,Y:67,Z:67,0:64,1:48,2:62,3:64,4:66,5:63,6:65,7:58,8:65,9:65," ":29,"!":32,'"':49,"'":31,"(":39,")":39,",":31,"-":48,".":31,"/":32,":":31,";":31,"?":52,"‘":31,"’":31,"“":47,"”":47,"…":82};function Lo(t,e=0,n=t.length){let r=0;for(let o=e;o<n;o=Co(t,o))r+=Mo[t[o]]??(To(t,o)?120:Mo.e);return r}function Ao(t,e=0,n=t.length){let r=0;for(let o=e;o<n;o=Co(t,o))r+=To(t,o)?200:100;return r}function Ro(t,e,n,r){const o=[];let i=0;for(let a=0,l=0,s=t.length;a<s;a=l){l=Co(t,a);const s=n(t,a,l);if(i+s>e){for(i+=r;i>e&&a>0;)l=a,a=o.pop(),i-=n(t,a,l);return[a,e-i]}i+=s,o.push(a)}return[-1,0]}function zo(t,e,n,r){t=t.trim();const o=n(r),[i]=Ro(t,e,n,o);return i<0?t:t.slice(0,i).trimEnd()+r}function Oo(t,e,n,r){const o=n(t=t.trim());if(o<=e)return t;const i=n(r),[a]=Ro(t,o-e+i,n,-i);return a<0?r:r+t.slice(Co(t,a)).trimStart()}const Eo=/[\p{Combining_Mark}\p{Emoji_Modifier}]+/uy,So=/\p{Extended_Pictographic}/uy;function Co(t,e){return e+=function(t,e){const n=t.charCodeAt(e);if(n>=55296&&n<56320){const n=t.charCodeAt(e+1);return n>=56320&&n<57344}return!1}(t,e)?2:1,function(t,e){return!Bo(t,e)&&(Eo.lastIndex=e,Eo.test(t))}(t,e)&&(e=Eo.lastIndex),function(t,e){return 8205===t.charCodeAt(e)}(t,e)?Co(t,e+1):e}function Bo(t,e){return t.charCodeAt(e)<128}function To(t,e){return!Bo(t,e)&&(So.lastIndex=e,So.test(t))}const No={ariaLabel:"vector",fill:"none",stroke:"currentColor",strokeWidth:1.5,strokeLinejoin:"round",strokeLinecap:"round"},Po=3.5,Wo=5*Po,jo={draw(t,e,n){const r=e*n/Wo;t.moveTo(0,0),t.lineTo(0,-e),t.moveTo(-r,r-e),t.lineTo(0,-e),t.lineTo(r,r-e)}},Do={draw(t,e,n){t.moveTo(-n,0),t.lineTo(0,-e),t.lineTo(n,0)}},qo=new Map([["arrow",jo],["spike",Do]]);class Fo extends Xr{constructor(t,e={}){const{x:n,y:r,r:o=Po,length:i,rotate:a,shape:l=jo,anchor:s="middle",frameAnchor:c}=e,[u,f]=A(i,12),[h,d]=A(a,0);super(t,{x:{value:n,scale:"x",optional:!0},y:{value:r,scale:"y",optional:!0},length:{value:u,scale:"length",optional:!0},rotate:{value:h,optional:!0}},e,No),this.r=+o,this.length=f,this.rotate=d,this.shape=function(t){if(function(t){return t&&"function"==typeof t.draw}(t))return t;const e=qo.get(`${t}`.toLowerCase());if(e)return e;throw new Error(`invalid shape: ${t}`)}(l),this.anchor=z(s,"anchor",["start","middle","end"]),this.frameAnchor=st(c)}render(t,n,r,o,i){const{x:a,y:l}=n,{x:s,y:c,length:u,rotate:f}=r,{length:h,rotate:d,anchor:p,shape:m,r:g}=this,[y,v]=Rr(this,o);return tr("svg:g",i).call(yr,this,o,i).call(br,this,{x:s&&a,y:c&&l}).call((n=>n.selectAll().data(t).enter().append("path").call(vr,this).attr("transform",po`translate(${s?t=>s[t]:y},${c?t=>c[t]:v})${f?t=>` rotate(${f[t]})`:d?` rotate(${d})`:""}${"start"===p?"":"end"===p?u?t=>` translate(0,${u[t]})`:` translate(0,${h})`:u?t=>` translate(0,${u[t]/2})`:` translate(0,${h/2})`}`).attr("d",u?t=>{const n=e.pathRound();return m.draw(n,u[t],g),n}:(()=>{const t=e.pathRound();return m.draw(t,h,g),t})()).call(dr,this,r))).node()}}function Yo(t,e={}){let{x:n,y:r,...o}=e;return void 0===e.frameAnchor&&([n,r]=j(n,r)),new Fo(t,{...o,x:n,y:r})}function Io(t,e={}){const{x:n=m,...r}=e;return new Fo(t,{...r,x:n})}function _o(t,e={}){const{y:n=m,...r}=e;return new Fo(t,{...r,y:n})}function Go(t,e){return arguments.length<2&&!Q(t)&&(e=t,t=null),void 0===e&&(e={}),[t,e]}function Xo({anchor:t}={},e){return void 0===t?e[0]:z(t,"anchor",e)}function Uo(t){return Xo(t,["left","right"])}function Ho(t){return Xo(t,["right","left"])}function Vo(t){return Xo(t,["bottom","top"])}function Zo(t){return Xo(t,["top","bottom"])}function Qo(){const[t,e]=Go(...arguments);return ei("y",Uo(e),t,e)}function Jo(){const[t,e]=Go(...arguments);return ei("fy",Ho(e),t,e)}function Ko(){const[t,e]=Go(...arguments);return ni("x",Vo(e),t,e)}function ti(){const[t,e]=Go(...arguments);return ni("fx",Zo(e),t,e)}function ei(t,e,n,{color:r="currentColor",opacity:o=1,stroke:i=r,strokeOpacity:a=o,strokeWidth:l=1,fill:s=r,fillOpacity:c=o,textAnchor:u,textStroke:f,textStrokeOpacity:h,textStrokeWidth:d,tickSize:p=("y"===t?6:0),tickPadding:m,tickRotate:g,x:y,marginTop:v=20,marginRight:w=("right"===e?40:0),marginBottom:b=20,marginLeft:k=("left"===e?40:0),label:$,labelOffset:M,labelAnchor:L,...A}){return p=x(p),m=x(m),g=x(g),void 0!==L&&(L=z(L,"labelAnchor",["center","top","bottom"])),Ur(p&&!at(i)?function(t,e,n,{strokeWidth:r=1,strokeLinecap:o=null,strokeLinejoin:i=null,facetAnchor:a=e+("y"===t?"-empty":""),frameAnchor:l=e,tickSize:s,inset:c=0,insetLeft:u=c,insetRight:f=c,dx:h=0,y:d=("y"===t?void 0:null),...p}){return ui(_o,t,`${t}-axis tick`,n,{strokeWidth:r,strokeLinecap:o,strokeLinejoin:i,facetAnchor:a,frameAnchor:l,y:d,...p,dx:"left"===e?+h-lr+ +u:+h+lr-f,anchor:"start",length:s,shape:"left"===e?mi:gi})}(t,e,n,{stroke:i,strokeOpacity:a,strokeWidth:l,tickSize:p,tickPadding:m,tickRotate:g,x:y,...A}):null,at(s)?null:function(t,e,n,{facetAnchor:r=e+("y"===t?"-empty":""),frameAnchor:o=e,tickSize:i,tickRotate:a=0,tickPadding:l=Math.max(3,9-i)+(Math.abs(a)>60?4*Math.cos(a*Hr):0),tickFormat:s,text:c=("function"==typeof s?s:void 0),textAnchor:u=(Math.abs(a)>60?"middle":"left"===e?"end":"start"),lineAnchor:f=(a>60?"top":a<-60?"bottom":"middle"),fontVariant:h,inset:d=0,insetLeft:p=d,insetRight:m=d,dx:g=0,y:y=("y"===t?void 0:null),...v}){return ui(bo,t,`${t}-axis tick label`,n,{facetAnchor:r,frameAnchor:o,text:void 0===c?null:c,textAnchor:u,lineAnchor:f,fontVariant:h,rotate:a,y:y,...v,dx:"left"===e?+g-i-l+ +p:+g+ +i+ +l-m},(function(t,e,n){void 0===h&&(this.fontVariant=yi(t)),void 0===c&&(n.text=fi(t,e,s))}))}(t,e,n,{fill:s,fillOpacity:c,stroke:f,strokeOpacity:h,strokeWidth:d,textAnchor:u,tickSize:p,tickPadding:m,tickRotate:g,x:y,marginTop:v,marginRight:w,marginBottom:b,marginLeft:k,...A}),at(s)||null===$?null:xo([],{fill:s,fillOpacity:c,...A,lineWidth:void 0,textOverflow:void 0,facet:"super",x:null,y:null,initializer:function(n,r,o,i,a){const l=i[t],{marginTop:s,marginRight:c,marginBottom:u,marginLeft:f}="y"===t&&a.inset||a,h=L??(l.bandwidth?"center":"top"),d=M??("right"===e?c:f)-3;return"center"===h?(this.textAnchor=void 0,this.lineAnchor="right"===e?"bottom":"top",this.frameAnchor=e,this.rotate=-90):(this.textAnchor="right"===e?"end":"start",this.lineAnchor=h,this.frameAnchor=`${h}-${e}`,this.rotate=0),this.dy="top"===h?3-s:"bottom"===h?u-3:0,this.dx="right"===e?d:-d,this.ariaLabel=`${t}-axis label`,{facets:[[0]],channels:{text:{value:[void 0===$?vi(t,l,h):$]}}}}}))}function ni(t,e,n,{color:r="currentColor",opacity:o=1,stroke:i=r,strokeOpacity:a=o,strokeWidth:l=1,fill:s=r,fillOpacity:c=o,textAnchor:u,textStroke:f,textStrokeOpacity:h,textStrokeWidth:d,tickSize:p=("x"===t?6:0),tickPadding:m,tickRotate:g,y:y,marginTop:v=("top"===e?30:0),marginRight:w=20,marginBottom:b=("bottom"===e?30:0),marginLeft:k=20,label:$,labelAnchor:M,labelOffset:L,...A}){return p=x(p),m=x(m),g=x(g),void 0!==M&&(M=z(M,"labelAnchor",["center","left","right"])),Ur(p&&!at(i)?function(t,e,n,{strokeWidth:r=1,strokeLinecap:o=null,strokeLinejoin:i=null,facetAnchor:a=e+("x"===t?"-empty":""),frameAnchor:l=e,tickSize:s,inset:c=0,insetTop:u=c,insetBottom:f=c,dy:h=0,x:d=("x"===t?void 0:null),...p}){return ui(Io,t,`${t}-axis tick`,n,{strokeWidth:r,strokeLinejoin:i,strokeLinecap:o,facetAnchor:a,frameAnchor:l,x:d,...p,dy:"bottom"===e?+h-lr-f:+h+lr+ +u,anchor:"start",length:s,shape:"bottom"===e?di:pi})}(t,e,n,{stroke:i,strokeOpacity:a,strokeWidth:l,tickSize:p,tickPadding:m,tickRotate:g,y:y,...A}):null,at(s)?null:function(t,e,n,{facetAnchor:r=e+("x"===t?"-empty":""),frameAnchor:o=e,tickSize:i,tickRotate:a=0,tickPadding:l=Math.max(3,9-i)+(Math.abs(a)>=10?4*Math.cos(a*Hr):0),tickFormat:s,text:c=("function"==typeof s?s:void 0),textAnchor:u=(Math.abs(a)>=10?a<0^"bottom"===e?"start":"end":"middle"),lineAnchor:f=(Math.abs(a)>=10?"middle":"bottom"===e?"top":"bottom"),fontVariant:h,inset:d=0,insetTop:p=d,insetBottom:m=d,dy:g=0,x:y=("x"===t?void 0:null),...v}){return ui(wo,t,`${t}-axis tick label`,n,{facetAnchor:r,frameAnchor:o,text:void 0===c?null:c,textAnchor:u,lineAnchor:f,fontVariant:h,rotate:a,x:y,...v,dy:"bottom"===e?+g+ +i+ +l-m:+g-i-l+ +p},(function(t,e,n){void 0===h&&(this.fontVariant=yi(t)),void 0===c&&(n.text=fi(t,e,s))}))}(t,e,n,{fill:s,fillOpacity:c,stroke:f,strokeOpacity:h,strokeWidth:d,textAnchor:u,tickSize:p,tickPadding:m,tickRotate:g,y:y,marginTop:v,marginRight:w,marginBottom:b,marginLeft:k,...A}),at(s)||null===$?null:xo([],{fill:s,fillOpacity:c,...A,lineWidth:void 0,textOverflow:void 0,facet:"super",x:null,y:null,initializer:function(n,r,o,i,a){const l=i[t],{marginTop:s,marginRight:c,marginBottom:u,marginLeft:f}="x"===t&&a.inset||a,h=M??(l.bandwidth?"center":"right"),d=L??("top"===e?s:u)-3;return"center"===h?(this.frameAnchor=e,this.textAnchor=void 0):(this.frameAnchor=`${e}-${h}`,this.textAnchor="right"===h?"end":"start"),this.lineAnchor=e,this.dy="top"===e?-d:d,this.dx="right"===h?c-3:"left"===h?3-f:0,this.ariaLabel=`${t}-axis label`,{facets:[[0]],channels:{text:{value:[void 0===$?vi(t,l,h):$]}}}}}))}function ri(){const[t,e]=Go(...arguments);return li("y",Uo(e),t,e)}function oi(){const[t,e]=Go(...arguments);return li("fy",Ho(e),t,e)}function ii(){const[t,e]=Go(...arguments);return si("x",Vo(e),t,e)}function ai(){const[t,e]=Go(...arguments);return si("fx",Zo(e),t,e)}function li(t,e,n,{y:r=("y"===t?void 0:null),x:o=null,x1:i=("left"===e?o:null),x2:a=("right"===e?o:null),...l}){return ui(fo,t,`${t}-grid`,n,{y:r,x1:i,x2:a,...ci(l)})}function si(t,e,n,{x:r=("x"===t?void 0:null),y:o=null,y1:i=("top"===e?o:null),y2:a=("bottom"===e?o:null),...l}){return ui(uo,t,`${t}-grid`,n,{x:r,y1:i,y2:a,...ci(l)})}function ci({color:t="currentColor",opacity:e=.1,stroke:n=t,strokeOpacity:r=e,strokeWidth:o=1,...i}){return{stroke:n,strokeOpacity:r,strokeWidth:o,...i}}function ui(t,n,r,o,i,a){let l;const s=t(o,Bt(i,(function(t,r,o,s){const{[n]:c}=s;if(!c)throw new Error(`missing scale: ${n}`);let{ticks:u,tickSpacing:f,interval:d}=i;if(Sn(c)&&"string"==typeof u&&(d=u,u=void 0),null==t){if(Q(u))t=O(u);else if(c.ticks)if(void 0!==u)t=c.ticks(u);else if(d=H(void 0===d?c.interval:d,c.type),void 0!==d){const[n,r]=e.extent(c.domain());t=d.range(n,d.offset(d.floor(r)))}else{const[r,o]=e.extent(c.range());u=(o-r)/(void 0===f?"x"===n?80:35:f),t=c.ticks(u)}else t=c.domain();"y"===n||"x"===n?r=[q(t)]:(l[n]={scale:n,value:m},r=void 0)}return a?.call(this,c,u,l),{data:t,facets:r,channels:Object.fromEntries(Object.entries(l).map((([e,n])=>[e,{...n,value:h(t,n.value)}])))}})));return null==o?(l=s.channels,s.channels={}):l={},s.ariaLabel=r,s}function fi(t,e,n){return{value:hi(t,e,n)}}function hi(t,n,r){return t.tickFormat?t.tickFormat(Q(n)?null:n,r):void 0===r?ar:"string"==typeof r?(tt(t.domain())?e.utcFormat:e.format)(r):$(r)}const di={draw(t,e){t.moveTo(0,0),t.lineTo(0,e)}},pi={draw(t,e){t.moveTo(0,0),t.lineTo(0,-e)}},mi={draw(t,e){t.moveTo(0,0),t.lineTo(-e,0)}},gi={draw(t,e){t.moveTo(0,0),t.lineTo(e,0)}};function yi(t){return t.bandwidth&&void 0===t.interval?void 0:"tabular-nums"}function vi(t,e,n){const r=e.label;if(e.bandwidth||!r?.inferred)return r;const o=function(t){return Math.sign(ct(t.domain()))*Math.sign(ct(t.range()))}(e);return o?"x"===t||"center"===n?"x"===t==o<0?`← ${r}`:`${r} →`:`${o<0?"↑ ":"↓ "}${r}`:r}const xi={ariaLabel:"frame",fill:"none",stroke:"currentColor"},wi={ariaLabel:"frame",fill:null,stroke:"currentColor",strokeLinecap:"square"};class bi extends Xr{constructor(t={}){const{anchor:e=null,inset:n=0,insetTop:r=n,insetRight:o=n,insetBottom:i=n,insetLeft:a=n,rx:l,ry:s}=t;super(void 0,void 0,t,null==e?xi:wi),this.anchor=R(e,"anchor",["top","right","bottom","left"]),this.insetTop=x(r),this.insetRight=x(o),this.insetBottom=x(i),this.insetLeft=x(a),this.rx=x(l),this.ry=x(s)}render(t,e,n,r,o){const{marginTop:i,marginRight:a,marginBottom:l,marginLeft:s,width:c,height:u}=r,{anchor:f,insetTop:h,insetRight:d,insetBottom:p,insetLeft:m,rx:g,ry:y}=this,v=s+m,x=c-a-d,w=i+h,b=u-l-p;return tr(f?"svg:line":"svg:rect",o).call(yr,this,r,o).call(vr,this).call(br,this,{}).call("left"===f?t=>t.attr("x1",v).attr("x2",v).attr("y1",w).attr("y2",b):"right"===f?t=>t.attr("x1",x).attr("x2",x).attr("y1",w).attr("y2",b):"top"===f?t=>t.attr("x1",v).attr("x2",x).attr("y1",w).attr("y2",w):"bottom"===f?t=>t.attr("x1",v).attr("x2",x).attr("y1",b).attr("y2",b):t=>t.attr("x",v).attr("y",w).attr("width",x-v).attr("height",b-w).attr("rx",g).attr("ry",y)).node()}}function ki(t){return new bi(t)}function $i(t={}){const{facet:n,style:r,caption:o,ariaLabel:i,ariaDescription:a}=t,l=Lr(t.className),s=void 0===t.marks?[]:Mi(t.marks),c=function(t,e){if(null==t)return;const{x:n,y:r}=t;if(null==n&&null==r)return;const o=O(t.data??n??r);if(void 0===o)throw new Error("missing facet data");const i={};null!=n&&(i.fx=xe(o,{value:n,scale:"fx"}));null!=r&&(i.fy=xe(o,{value:r,scale:"fy"}));Ri(i,e);const a=Er(o,i);return{channels:i,groups:a,data:t.data}}(n,t),u=new Map;for(const e of s){const n=Si(e,c,t);n&&u.set(e,n)}const f=new Map;c&&Ei(f,[c]),Ei(f,u);const h=Mi(function(t,e,n){let{projection:r,x:o={},y:i={},fx:a={},fy:l={},axis:s,grid:c,facet:u={},facet:{axis:f=s,grid:h}=u,x:{axis:d=s,grid:p=(null===d?null:c)}=o,y:{axis:m=s,grid:g=(null===m?null:c)}=i,fx:{axis:y=f,grid:v=(null===y?null:h)}=a,fy:{axis:x=f,grid:w=(null===x?null:h)}=l}=n;(r||!T(o)&&!Pi("x",t))&&(d=p=null);(r||!T(i)&&!Pi("y",t))&&(m=g=null);e.has("fx")||(y=v=null);e.has("fy")||(x=w=null);void 0===d&&(d=!Ni(t,"x"));void 0===m&&(m=!Ni(t,"y"));void 0===y&&(y=!Ni(t,"fx"));void 0===x&&(x=!Ni(t,"fy"));!0===d&&(d="bottom");!0===m&&(m="left");!0===y&&(y="top"===d||null===d?"bottom":"top");!0===x&&(x="right"===m||null===m?"left":"right");const b=[];return Bi(b,w,oi,l),Ci(b,x,Jo,"right","left",u,l),Bi(b,v,ai,a),Ci(b,y,ti,"top","bottom",u,a),Bi(b,g,ri,i),Ci(b,m,Qo,"left","right",n,i),Bi(b,p,ii,o),Ci(b,d,Ko,"bottom","top",n,o),b}(s,f,t));for(const e of h){const n=Si(e,c,t);n&&u.set(e,n)}s.unshift(...h);const d=function(t,n){const{fx:r,fy:o}=yn(t,n),i=r?.scale.domain(),a=o?.scale.domain();return i&&a?e.cross(i,a).map((([t,e],n)=>({x:t,y:e,i:n}))):i?i.map(((t,e)=>({x:t,i:e}))):a?a.map(((t,e)=>({y:t,i:e}))):void 0}(f,t);if(void 0!==d){const t=c?jr(d,c):void 0;for(const e of s){if(null===e.facet||"super"===e.facet)continue;const n=u.get(e);void 0!==n&&(n.facetsIndex=null!=e.fx||null!=e.fy?jr(d,n):t)}const e=new Set;for(const{facetsIndex:t}of u.values())t?.forEach(((t,n)=>{t?.length>0&&e.add(n)}));d.forEach(0<e.size&&e.size<d.length?(t,n)=>t.empty=!e.has(n):t=>t.empty=!1);for(const t of s)if("exclude"===t.facet){const e=u.get(t);void 0!==e&&(e.facetsIndex=Sr(e.facetsIndex))}}for(const e of yt.keys())T(t[e])&&"fx"!==e&&"fy"!==e&&f.set(e,[]);const p=new Map;for(const e of s){if(p.has(e))throw new Error("duplicate mark; each mark must be unique");const{facetsIndex:n,channels:r}=u.get(e)??{},{data:o,facets:i,channels:a}=e.initialize(n,r);Ri(a,t),p.set(e,{data:o,facets:i,channels:a})}const m=yn(Ei(f,p),t),g=vn(m),y=function(t,e,n={}){let r=.5-lr,o=.5+lr,i=.5+lr,a=.5-lr;for(const{marginTop:t,marginRight:n,marginBottom:l,marginLeft:s}of e)t>r&&(r=t),n>o&&(o=n),l>i&&(i=l),s>a&&(a=s);let{margin:l,marginTop:s=(void 0!==l?l:r),marginRight:c=(void 0!==l?l:o),marginBottom:u=(void 0!==l?l:i),marginLeft:f=(void 0!==l?l:a)}=n;s=+s,c=+c,u=+u,f=+f;let{width:h=640,height:d=zr(t,e,n,{width:h,marginTopDefault:r,marginRightDefault:o,marginBottomDefault:i,marginLeftDefault:a})+Math.max(0,s-r+u-i)}=n;h=+h,d=+d;const p={width:h,height:d,marginTop:s,marginRight:c,marginBottom:u,marginLeft:f};if(t.fx||t.fy){let{margin:t,marginTop:e=(void 0!==t?t:s),marginRight:r=(void 0!==t?t:c),marginBottom:o=(void 0!==t?t:u),marginLeft:i=(void 0!==t?t:f)}=n.facet??{};e=+e,r=+r,o=+o,i=+i,p.facet={marginTop:e,marginRight:r,marginBottom:o,marginLeft:i}}return p}(m,s,t);!function(t,e){const{x:n,y:r,fx:o,fy:i}=t,a=o||i?wn(e):e;o&&kn(o,a),i&&$n(i,a);const l=o||i?bn(t,e):e;n&&kn(n,l),r&&$n(r,l)}(m,y);const{fx:v,fy:x}=g,w=v||x?bn(m,y):y,b=v||x?function({fx:t,fy:e},n){const{marginTop:r,marginRight:o,marginBottom:i,marginLeft:a,width:l,height:s}=wn(n),c=t&&Wi(t),u=e&&Wi(e);return{marginTop:e?u[0]:r,marginRight:t?l-c[1]:o,marginBottom:e?s-u[1]:i,marginLeft:t?c[0]:a,inset:{marginTop:n.marginTop,marginRight:n.marginRight,marginBottom:n.marginBottom,marginLeft:n.marginLeft},width:l,height:s}}(g,y):y,k=Kn(t,w),$=new Set;for(const[e,n]of p)if(null!=e.initializer){const r="super"===e.facet?b:w,o=e.initializer(n.data,n.facets,n.channels,g,r,k);if(void 0!==o.data&&(n.data=o.data),void 0!==o.facets&&(n.facets=o.facets),void 0!==o.channels){Oi(o.channels),Object.assign(n.channels,o.channels);for(const e of Object.values(o.channels)){const{scale:n}=e;null!=n&&yt.get(n)!==ft&&(zi(e,t),$.add(n))}const{fx:r,fy:i}=o.channels;if(null!=r||null!=i){const t=u.get(e)??{channels:{}};null!=r&&(t.channels.fx=r),null!=i&&(t.channels.fy=i),t.groups=Er(n.data,t.channels),t.facetsIndex=n.facets=jr(d,t),u.set(e,t)}}}if($.size){const e=new Map;Ei(e,p,(t=>$.has(t))),Ei(f,p,(t=>$.has(t)));const n=function(t,e){for(const n in t){const r=t[n],o=e[n];void 0===r.label&&o&&(r.label=o.label)}return t}(yn(e,t),m),r=vn(n);Object.assign(m,n),Object.assign(g,r)}for(const[t,e]of p)e.values=t.scale(e.channels,g,k);const{width:M,height:L}=y,A=tr("svg",k).attr("class",l).attr("fill","currentColor").attr("font-family","system-ui, sans-serif").attr("font-size",10).attr("text-anchor","middle").attr("width",M).attr("height",L).attr("viewBox",`0 0 ${M} ${L}`).attr("aria-label",i).attr("aria-description",a).call((t=>t.append("style").text(`\n        .${l} {\n          display: block;\n          background: white;\n          height: auto;\n          height: intrinsic;\n          max-width: 100%;\n        }\n        .${l} text,\n        .${l} tspan {\n          white-space: pre;\n        }\n      `))).call(Ar,r).node();if(void 0!==d){const t={x:v?.domain(),y:x?.domain()};d.sort(function({x:t,y:e}){const n=t&&new Map(t.map(((t,e)=>[t,e]))),r=e&&new Map(e.map(((t,e)=>[t,e])));return t&&e?(t,e)=>n.get(t.x)-n.get(e.x)||r.get(t.y)-r.get(e.y):t?(t,e)=>n.get(t.x)-n.get(e.x):(t,e)=>r.get(t.y)-r.get(e.y)}(t)),e.select(A).selectAll().data(d).enter().append("g").attr("aria-label","facet").attr("transform",function(t,e,{marginTop:n,marginLeft:r}){return t&&e?({x:o,y:i})=>`translate(${t(o)-r},${e(i)-n})`:t?({x:e})=>`translate(${t(e)-r},0)`:({y:t})=>`translate(0,${e(t)-n})`}(v,x,y)).each((function(e){let n=!0;for(const r of s){if("super"===r.facet)continue;const{channels:o,values:i,facets:a}=p.get(r);if(!(r.facetAnchor?.(d,t,e)??!e.empty))continue;let l=null;if(a){if(l=a[u.has(r)?e.i:0],l=r.filter(l,o,i),0===l.length)continue;l.fi=e.i}const s=r.render(l,g,i,w,k);null!=s&&(n=!1,this.appendChild(s))}n&&this.remove()}))}for(const t of s){if(void 0!==d&&"super"!==t.facet)continue;const{channels:e,values:n,facets:r}=p.get(t);let o=null;if(r&&(o=r[0],o=t.filter(o,e,n),0===o.length))continue;const i=t.render(o,g,n,b,k);null!=i&&A.appendChild(i)}let R=A;const z=function(t,e,n){const r=[];for(const[o,i]of Yr){const a=n[o];if(a?.legend&&o in t){const n=i(t[o],Ir(e,t[o],a),(e=>t[e]));null!=n&&r.push(n)}}return r}(m,k,t);if(null!=o||z.length>0){const{document:t}=k;R=t.createElement("figure"),R.style.maxWidth="initial";for(const t of z)R.appendChild(t);if(R.appendChild(A),null!=o){const e=t.createElement("figcaption");e.appendChild(o instanceof Node?o:t.createTextNode(o)),R.appendChild(e)}}R.scale=function(t){return e=>{if(!yt.has(e=`${e}`))throw new Error(`unknown scale: ${e}`);return e in t?Fn(t[e]):void 0}}(m),R.legend=function(t,e,n={}){return(r,o)=>{if(!Yr.has(r))throw new Error(`unknown legend type: ${r}`);if(r in t)return Yr.get(r)(t[r],Ir(e,n[r],o),(e=>t[e]))}}(m,k,t);const E=function(){const t=mn;return mn=0,t}();return E>0&&e.select(A).append("text").attr("x",M).attr("y",20).attr("dy","-1em").attr("text-anchor","end").attr("font-family","initial").text("⚠️").append("title").text(`${E.toLocaleString("en-US")} warning${1===E?"":"s"}. Please check the console.`),R}function Mi(t){return t.flat(1/0).filter((t=>null!=t)).map(Li)}function Li(t){return"function"==typeof t.render?t:new Ai(t)}Xr.prototype.plot=function({marks:t=[],...e}={}){return $i({...e,marks:[...t,this]})};class Ai extends Xr{constructor(t){if("function"!=typeof t)throw new TypeError("invalid mark; missing render function");super(),this.render=t}render(){}}function Ri(t,e){for(const n in t)zi(t[n],e);return t}function zi(t,e){const{scale:n}=t;if(null==n)return;const{type:r,percent:o,interval:i,transform:a=(o?t=>100*t:H(i,r)?.floor)}=e[n]??{};null!=a&&(t.value=E(t.value,a))}function Oi(t){for(const e in t)ke(e,t[e])}function Ei(t,e,n=y){for(const{channels:r}of e.values())for(const e in r){const o=r[e],{scale:i}=o;if(null!=i&&n(i)){const e=t.get(i);void 0!==e?e.push(o):t.set(i,[o])}}return t}function Si(t,e,n){if(null===t.facet||"super"===t.facet)return;const{fx:r,fy:o}=t;if(null!=r||null!=o){const e=O(t.data??r??o);if(void 0===e)throw new Error(`missing facet data in ${t.ariaLabel}`);if(null===e)return;const i={};return null!=r&&(i.fx=xe(e,{value:r,scale:"fx"})),null!=o&&(i.fy=xe(e,{value:o,scale:"fy"})),Ri(i,n),{channels:i,groups:Er(e,i)}}if(void 0===e)return;const{channels:i,groups:a,data:l}=e;if("auto"!==t.facet||t.data===l)return{channels:i,groups:a};(a.size>1||1===a.size&&i.fx&&i.fy&&[...a][0][1].size>1)&&O(t.data)?.length===l.length&&gn(`Warning: the ${t.ariaLabel} mark appears to use faceted data, but isn’t faceted. The mark data has the same length as the facet data and the mark facet option is "auto", but the mark data and facet data are distinct. If this mark should be faceted, set the mark facet option to true; otherwise, suppress this warning by setting the mark facet option to false.`)}function Ci(t,e,n,r,o,i,a){if(!e)return;const l=/^\s*both\s*$/i.test(e);a=function(t,e,{line:n=e.line,ticks:r,tickSize:o,tickSpacing:i,tickPadding:a,tickFormat:l,tickRotate:s,fontVariant:c,ariaLabel:u,ariaDescription:f,label:h=e.label,labelAnchor:d,labelOffset:p}){return{anchor:t,line:n,ticks:r,tickSize:o,tickSpacing:i,tickPadding:a,tickFormat:l,tickRotate:s,fontVariant:c,ariaLabel:u,ariaDescription:f,label:h,labelAnchor:d,labelOffset:p}}(l?r:e,i,a);const{line:s}=a;n!==Qo&&n!==Ko||!s||lt(s)||t.push(ki(function(t){const{anchor:e,line:n}=t;return{anchor:e,facetAnchor:e+"-empty",stroke:!0===n?void 0:n}}(a))),t.push(n(a)),l&&t.push(n({...a,anchor:o,label:null}))}function Bi(t,e,n,r){e&&!lt(e)&&t.push(n(function(t,{stroke:e=(it(t)?t:void 0),ticks:n=(Ti(t)?t:void 0),tickSpacing:r,ariaLabel:o,ariaDescription:i}){return{stroke:e,ticks:n,tickSpacing:r,ariaLabel:o,ariaDescription:i}}(e,r)))}function Ti(t){switch(typeof t){case"number":return!0;case"string":return!it(t)}return Q(t)||"function"==typeof t?.range}function Ni(t,e){const n=`${e}-axis `;return t.some((t=>t.ariaLabel?.startsWith(n)))}function Pi(t,e){for(const n of e)for(const e in n.channels)if(n.channels[e].scale===t)return!0;return!1}function Wi(t){const e=t.domain();let n=t(e[0]),r=t(e[e.length-1]);return r<n&&([n,r]=[r,n]),[n,r+t.bandwidth()]}const ji=new Map([["basis",e.curveBasis],["basis-closed",e.curveBasisClosed],["basis-open",e.curveBasisOpen],["bundle",e.curveBundle],["bump-x",e.curveBumpX],["bump-y",e.curveBumpY],["cardinal",e.curveCardinal],["cardinal-closed",e.curveCardinalClosed],["cardinal-open",e.curveCardinalOpen],["catmull-rom",e.curveCatmullRom],["catmull-rom-closed",e.curveCatmullRomClosed],["catmull-rom-open",e.curveCatmullRomOpen],["linear",e.curveLinear],["linear-closed",e.curveLinearClosed],["monotone-x",e.curveMonotoneX],["monotone-y",e.curveMonotoneY],["natural",e.curveNatural],["step",e.curveStep],["step-after",e.curveStepAfter],["step-before",e.curveStepBefore]]);function Di(t=e.curveLinear,n){if("function"==typeof t)return t;const r=ji.get(`${t}`.toLowerCase());if(!r)throw new Error(`unknown curve: ${t}`);if(void 0!==n){if("beta"in r)return r.beta(n);if("tension"in r)return r.tension(n);if("alpha"in r)return r.alpha(n)}return r}function qi(t=Fi,e){return"function"!=typeof t&&"auto"===`${t}`.toLowerCase()?Fi:Di(t,e)}function Fi(t){return e.curveLinear(t)}function Yi(t={y:"count"},e={}){[t,e]=Vi(t,e);const{x:n,y:r}=e;return Hi(Zi(n,e,m),null,null,r,t,Vr(e))}function Ii(t={x:"count"},e={}){[t,e]=Vi(t,e);const{x:n,y:r}=e;return Hi(null,Zi(r,e,m),n,null,t,Zr(e))}function _i(t={fill:"count"},e={}){[t,e]=Vi(t,e);const{x:n,y:r}=function(t){let{x:e,y:n}=t;return e=Zi(e,t),n=Zi(n,t),[e.value,n.value]=j(e.value,n.value),{x:e,y:n}}(e);return Hi(n,r,null,null,t,Vr(Zr(e)))}function Gi(t,e,n={}){return null==n?.interval?n:t({[e]:void 0===n?.reduce?ie:n.reduce,filter:null},n)}function Xi(t){return Gi(Yi,"y",t)}function Ui(t){return Gi(Ii,"x",t)}function Hi(t,e,n,r,{data:o=oe,filter:i=se,sort:a,reverse:l,...s}={},c={}){t=Qi(t),e=Qi(e),s=Vt(s,c),o=Kt(o,m),a=null==a?void 0:Zt("sort",a,c),i=null==i?void 0:Qt("filter",i,c),null!=n&&Ht(s,"x","x1","x2")&&(n=null),null!=r&&Ht(s,"y","y1","y2")&&(r=null);const[u,f]=G(t),[d,p]=G(t),[g,y]=G(e),[v,x]=G(e),[w,b]=null!=n?[n,"x"]:null!=r?[r,"y"]:[],[k,$]=G(w),{x:M,y:A,z:R,fill:z,stroke:O,x1:E,x2:S,y1:C,y2:B,domain:T,cumulative:N,thresholds:P,interval:W,...j}=c,[D,q]=G(R),[F]=L(z),[Y]=L(O),[I,_]=G(F),[X,H]=G(Y);return{..."z"in c&&{z:D||R},..."fill"in c&&{fill:I||z},..."stroke"in c&&{stroke:X||O},...Ct(j,((n,r)=>{const c=h(n,w),u=h(n,R),d=h(n,F),m=h(n,Y),g=te(s,{z:u,fill:d,stroke:m}),v=[],b=[],k=c&&$([]),M=u&&q([]),L=d&&_([]),A=m&&H([]),z=t&&f([]),O=t&&p([]),E=e&&y([]),S=e&&x([]),C=(B=t?.(n),T=e?.(n),B&&T?function*(t){const e=B.bin(t);for(const[t,[n,r]]of B.entries()){const o=T.bin(e[t]);for(const[t,[e,i]]of T.entries())yield[o[t],{x1:n,y1:e,x2:r,y2:i}]}}:B?function*(t){const e=B.bin(t);for(const[t,[n,r]]of B.entries())yield[e[t],{x1:n,x2:r}]}:function*(t){const e=T.bin(t);for(const[t,[n,r]]of T.entries())yield[e[t],{y1:n,y2:r}]});var B,T;let N=0;for(const t of s)t.initialize(n);a&&a.initialize(n),i&&i.initialize(n);for(const t of r){const e=[];for(const e of s)e.scope("facet",t);a&&a.scope("facet",t),i&&i.scope("facet",t);for(const[r,l]of Jt(t,g))for(const[t,f]of Jt(l,c))for(const[l,h]of C(f))if(!i||i.reduce(l,h)){e.push(N++),b.push(o.reduce(l,n,h)),c&&k.push(t),u&&M.push(g===u?r:u[l[0]]),d&&L.push(g===d?r:d[l[0]]),m&&A.push(g===m?r:m[l[0]]),z&&(z.push(h.x1),O.push(h.x2)),E&&(E.push(h.y1),S.push(h.y2));for(const t of s)t.reduce(l,h);a&&a.reduce(l)}v.push(e)}return ee(v,a,l),{data:b,facets:v}})),...!Ht(s,"x")&&(u?{x1:u,x2:d,x:U(u,d)}:{x:M,x1:E,x2:S}),...!Ht(s,"y")&&(g?{y1:g,y2:v,y:U(g,v)}:{y:A,y1:C,y2:B}),...k&&{[b]:k},...Object.fromEntries(s.map((({name:t,output:e})=>[t,e])))}}function Vi({cumulative:t,domain:e,thresholds:n,interval:r,...o},i){return[o,{cumulative:t,domain:e,thresholds:n,interval:r,...i}]}function Zi(t,{cumulative:e,domain:n,thresholds:r,interval:o},i){return void 0===(t={...V(t)}).domain&&(t.domain=n),void 0===t.cumulative&&(t.cumulative=e),void 0===t.thresholds&&(t.thresholds=r),void 0===t.interval&&(t.interval=o),void 0===t.value&&(t.value=i),t.thresholds=Ji(t.thresholds,t.interval),t}function Qi(t){if(null==t)return;const{value:n,cumulative:r,domain:o=e.extent,thresholds:i}=t,a=t=>{let a,l=h(t,n);if(tt(l)||(function(t){return ta(t)&&"function"==typeof t&&t()instanceof Date}(s=i)||Q(s)&&tt(s))){l=E(l,qn,Float64Array);let[t,n]="function"==typeof o?o(l):o,r="function"!=typeof i||ta(i)?i:i(l,t,n);"number"==typeof r&&(r=e.utcTickInterval(t,n,r)),ta(r)&&(o===e.extent&&(t=r.floor(t),n=r.offset(r.floor(n))),r=r.range(t,r.offset(n))),a=r}else{l=E(l,Dn,Float64Array);let[t,n]="function"==typeof o?o(l):o,r="function"!=typeof i||ta(i)?i:i(l,t,n);if("number"==typeof r)if(o===e.extent){let o=e.tickIncrement(t,n,r);if(isFinite(o))if(o>0){let e=Math.round(t/o),i=Math.round(n/o);e*o<=t||--e,i*o>n||++i;let a=i-e+1;r=new Float64Array(a);for(let t=0;t<a;++t)r[t]=(e+t)*o}else if(o<0){o=-o;let e=Math.round(t*o),i=Math.round(n*o);e/o<=t||--e,i/o>n||++i;let a=i-e+1;r=new Float64Array(a);for(let t=0;t<a;++t)r[t]=(e+t)/o}else r=[t];else r=[t]}else r=e.ticks(t,n,r);else ta(r)&&(o===e.extent&&(t=r.floor(t),n=r.offset(r.floor(n))),r=r.range(t,r.offset(n)));a=r}var s;const c=[];if(1===a.length)c.push([a[0],a[0]]);else for(let t=1;t<a.length;++t)c.push([a[t-1],a[t]]);return c.bin=(r<0?ra:r>0?na:ea)(c,a,l),c};return a.label=X(n),a}function Ji(t,n,r=Ki){if(void 0===t)return void 0===n?r:function(t){if(t=H(t),!ta(t))throw new Error(`invalid interval: ${t}`);return t}(n);if("string"==typeof t){switch(t.toLowerCase()){case"freedman-diaconis":return e.thresholdFreedmanDiaconis;case"scott":return e.thresholdScott;case"sturges":return e.thresholdSturges;case"auto":return Ki}const n=H(t);if(void 0!==n)return n;throw new Error(`invalid thresholds: ${t}`)}return t}function Ki(t,n,r){return Math.min(200,e.thresholdScott(t,n,r))}function ta(t){return!!t&&"function"==typeof t.range}function ea(t,n,r){return n=n.map(Dn),o=>{const i=t.map((()=>[]));for(const t of o)i[e.bisect(n,r[t])-1]?.push(t);return i}}function na(t,e,n){const r=ea(t,e,n);return t=>{const e=r(t);for(let t=1,n=e.length;t<n;++t){const n=e[t-1],r=e[t];for(const t of n)r.push(t)}return e}}function ra(t,e,n){const r=ea(t,e,n);return t=>{const e=r(t);for(let t=e.length-2;t>=0;--t){const n=e[t+1],r=e[t];for(const t of n)r.push(t)}return e}}function oa(t={}){const{x:e,x1:n,x2:r}=t;return void 0===n&&void 0===r&&void 0===e?{...t,x:m}:t}function ia(t={}){const{y:e,y1:n,y2:r}=t;return void 0===n&&void 0===r&&void 0===e?{...t,y:m}:t}function aa(t={},e={}){1===arguments.length&&([t,e]=ua(t));const{y1:n,y:r=n,x:o,...i}=e,[a,l,s,c]=fa(r,o,"x",t,i);return{...a,y1:n,y:l,x1:s,x2:c,x:U(s,c)}}function la(t={},e={}){1===arguments.length&&([t,e]=ua(t));const{x1:n,x:r=n,y:o,...i}=e,[a,l,s,c]=fa(r,o,"y",t,i);return{...a,x1:n,x:l,y1:s,y2:c,y:U(s,c)}}function sa({x:t,x1:e,x2:n,...r}={}){return void 0===e&&void 0===n?aa({x:t,...r}):([e,n]=W(t,e,n),{...r,x1:e,x2:n})}function ca({y:t,y1:e,y2:n,...r}={}){return void 0===e&&void 0===n?la({y:t,...r}):([e,n]=W(t,e,n),{...r,y1:e,y2:n})}function ua(t){const{offset:e,order:n,reverse:r,...o}=t;return[{offset:e,order:n,reverse:r},o]}const fa=function(t,n=g,r,{offset:o,order:i,reverse:a},l){const s=D(l),[c,u]=G(t),[f,p]=_(n),[m,y]=_(n);return o=function(t){if(null==t)return;if("function"==typeof t)return t;switch(`${t}`.toLowerCase()){case"expand":case"normalize":return da;case"center":case"silhouette":return pa;case"wiggle":return ma}throw new Error(`unknown offset: ${t}`)}(o),i=function(t,e,n){if(void 0===t&&e===ma)return ka;if(null==t)return;if("string"==typeof t){switch(t.toLowerCase()){case"value":case n:return va;case"z":return xa;case"sum":return wa;case"appearance":return ba;case"inside-out":return ka}return $a(d(t))}if("function"==typeof t)return $a(t);if(Array.isArray(t))return r=t,(t,e,n,o)=>Ma(o,r);var r;throw new Error(`invalid order: ${t}`)}(i,o,r),[Ct(l,((r,l)=>{const c=null==t?void 0:u(h(r,t)),f=h(r,n,Float64Array),d=h(r,s),m=i&&i(r,c,f,d),g=r.length,v=p(new Float64Array(g)),x=y(new Float64Array(g)),w=[];for(const t of l){const n=c?Array.from(e.group(t,(t=>c[t])).values()):[t];m&&La(n,m);for(const t of n){let e=0,n=0;a&&t.reverse();for(const r of t){const t=f[r];t<0?e=x[r]=(v[r]=e)+t:t>0?n=x[r]=(v[r]=n)+t:x[r]=v[r]=n}}w.push(n)}return o&&o(w,v,x,d),{data:r,facets:l}})),c,f,m]};function ha(t,e){let n=0,r=0;for(const o of t){const t=e[o];t<n&&(n=t),t>r&&(r=t)}return[n,r]}function da(t,e,n){for(const r of t)for(const t of r){const[r,o]=ha(t,n);for(const i of t){const t=1/(o-r||1);e[i]=t*(e[i]-r),n[i]=t*(n[i]-r)}}}function pa(t,e,n){for(const r of t){for(const t of r){const[r,o]=ha(t,n);for(const i of t){const t=(o+r)/2;e[i]-=t,n[i]-=t}}ga(r,e,n)}ya(t,e,n)}function ma(t,n,r,o){for(const i of t){const t=new e.InternMap;let a=0;for(const l of i){let i=-1;const s=l.map((t=>Math.abs(r[t]-n[t]))),c=l.map((e=>{i=o?o[e]:++i;const a=r[e]-n[e],l=t.has(i)?a-t.get(i):0;return t.set(i,a),l})),u=[0,...e.cumsum(c)];for(const t of l)n[t]+=a,r[t]+=a;const f=e.sum(s);f&&(a-=e.sum(s,((t,e)=>(c[e]/2+u[e])*t))/f)}ga(i,n,r)}ya(t,n,r)}function ga(t,n,r){const o=e.min(t,(t=>e.min(t,(t=>n[t]))));for(const e of t)for(const t of e)n[t]-=o,r[t]-=o}function ya(t,n,r){const o=t.length;if(1===o)return;const i=t.map((t=>t.flat())),a=i.map((t=>(e.min(t,(t=>n[t]))+e.max(t,(t=>r[t])))/2)),l=e.min(a);for(let t=0;t<o;t++){const e=l-a[t];for(const o of i[t])n[o]+=e,r[o]+=e}}function va(t,e,n){return n}function xa(t,e,n,r){return r}function wa(t,n,r,o){return Ma(o,e.groupSort(q(t),(t=>e.sum(t,(t=>r[t]))),(t=>o[t])))}function ba(t,n,r,o){return Ma(o,e.groupSort(q(t),(t=>n[e.greatest(t,(t=>r[t]))]),(t=>o[t])))}function ka(t,n,r,o){const i=q(t),a=e.groupSort(i,(t=>n[e.greatest(t,(t=>r[t]))]),(t=>o[t])),l=e.rollup(i,(t=>e.sum(t,(t=>r[t]))),(t=>o[t])),s=[],c=[];let u=0;for(const t of a)u<0?(u+=l.get(t),s.push(t)):(u-=l.get(t),c.push(t));return Ma(o,c.reverse().concat(s))}function $a(t){return e=>h(e,t)}function Ma(t,n){if(!t)throw new Error("missing channel: z");return n=new e.InternMap(n.map(((t,e)=>[t,e]))),t.map((t=>n.get(t)))}function La(t,e){for(const n of t)n.sort(((t,n)=>At(e[t],e[n])))}const Aa={ariaLabel:"area",strokeWidth:1,strokeLinecap:"round",strokeLinejoin:"round",strokeMiterlimit:1};class Ra extends Xr{constructor(t,e={}){const{x1:n,y1:r,x2:o,y2:i,z:a,curve:l,tension:s}=e;super(t,{x1:{value:n,scale:"x"},y1:{value:r,scale:"y"},x2:{value:o,scale:"x",optional:!0},y2:{value:i,scale:"y",optional:!0},z:{value:D(e),optional:!0}},e,Aa),this.z=a,this.curve=Di(l,s)}filter(t){return t}render(t,n,r,o,i){const{x1:a,y1:l,x2:s=a,y2:c=l}=r;return tr("svg:g",i).call(yr,this,o,i).call(br,this,n,0,0).call((n=>n.selectAll().data(gr(t,[a,l,s,c],this,r)).enter().append("path").call(vr,this).call(pr,this,r).attr("d",e.area().curve(this.curve).defined((t=>t>=0)).x0((t=>a[t])).y0((t=>l[t])).x1((t=>s[t])).y1((t=>c[t]))))).node()}}function za(t,e){const{y:n=p,...r}=Ui(e);return new Ra(t,sa(oa({...r,y1:n,y2:void 0})))}function Oa(t,e){const{x:n=p,...r}=Xi(e);return new Ra(t,ca(ia({...r,x1:n,x2:void 0})))}function Ea(t,{marker:e,markerStart:n=e,markerMid:r=e,markerEnd:o=e}={}){t.markerStart=Sa(n),t.markerMid=Sa(r),t.markerEnd=Sa(o)}function Sa(t){if(null==t||!1===t)return null;if(!0===t)return Ta;if("function"==typeof t)return t;switch(`${t}`.toLowerCase()){case"none":return null;case"arrow":return Ca;case"dot":return Ba;case"circle":case"circle-fill":return Ta;case"circle-stroke":return Na}throw new Error(`invalid marker: ${t}`)}function Ca(t,e){return tr("svg:marker",e).attr("viewBox","-5 -5 10 10").attr("markerWidth",6.67).attr("markerHeight",6.67).attr("orient","auto").attr("fill","none").attr("stroke",t).attr("stroke-width",1.5).attr("stroke-linecap","round").attr("stroke-linejoin","round").call((t=>t.append("path").attr("d","M-1.5,-3l3,3l-3,3"))).node()}function Ba(t,e){return tr("svg:marker",e).attr("viewBox","-5 -5 10 10").attr("markerWidth",6.67).attr("markerHeight",6.67).attr("fill",t).attr("stroke","none").call((t=>t.append("circle").attr("r",2.5))).node()}function Ta(t,e){return tr("svg:marker",e).attr("viewBox","-5 -5 10 10").attr("markerWidth",6.67).attr("markerHeight",6.67).attr("fill",t).attr("stroke","white").attr("stroke-width",1.5).call((t=>t.append("circle").attr("r",3))).node()}function Na(t,e){return tr("svg:marker",e).attr("viewBox","-5 -5 10 10").attr("markerWidth",6.67).attr("markerHeight",6.67).attr("fill","white").attr("stroke",t).attr("stroke-width",1.5).call((t=>t.append("circle").attr("r",3))).node()}let Pa=0;function Wa(t,e,{stroke:n}={}){return Da(t,e,n&&(t=>n[t]))}function ja(t,e,{stroke:n}={}){return Da(t,e,n&&(([t])=>n[t]))}function Da(t,{markerStart:e,markerMid:n,markerEnd:r,stroke:o},i=(()=>o)){const a=new Map;function l(t){return function(e){const n=i(e);let r=a.get(t);r||a.set(t,r=new Map);let o=r.get(n);if(!o){const e={document:this.ownerDocument},i=this.parentNode.insertBefore(t(n,e),this),a="plot-marker-"+ ++Pa;i.setAttribute("id",a),r.set(n,o=`url(#${a})`)}return o}}e&&t.attr("marker-start",l(e)),n&&t.attr("marker-mid",l(n)),r&&t.attr("marker-end",l(r))}const qa={ariaLabel:"link",fill:"none",stroke:"currentColor",strokeMiterlimit:1};class Fa extends Xr{constructor(t,e={}){const{x1:n,y1:r,x2:o,y2:i,curve:a,tension:l}=e;super(t,{x1:{value:n,scale:"x"},y1:{value:r,scale:"y"},x2:{value:o,scale:"x",optional:!0},y2:{value:i,scale:"y",optional:!0}},e,qa),this.curve=qi(a,l),Ea(this,e)}project(t,e,n){this.curve!==Fi&&super.project(t,e,n)}render(t,n,r,o,i){const{x1:a,y1:l,x2:s=a,y2:c=l}=r,{curve:u}=this;return tr("svg:g",i).call(yr,this,o,i).call(br,this,n).call((n=>n.selectAll().data(t).enter().append("path").call(vr,this).attr("d",u===Fi&&i.projection?function(t,n,r,o,i){const a=e.geoPath(t);return n=jn(n),r=jn(r),o=jn(o),i=jn(i),t=>a({type:"LineString",coordinates:[[n[t],r[t]],[o[t],i[t]]]})}(i.projection,a,l,s,c):t=>{const n=e.pathRound(),r=u(n);return r.lineStart(),r.point(a[t],l[t]),r.point(s[t],c[t]),r.lineEnd(),n}).call(dr,this,r).call(Wa,this,r))).node()}}function Ya(t,e={}){let{x:n,x1:r,x2:o,y:i,y1:a,y2:l,...s}=e;return[r,o]=Ia(n,r,o),[a,l]=Ia(i,a,l),new Fa(t,{...s,x1:r,x2:o,y1:a,y2:l})}function Ia(t,e,n){if(void 0===t){if(void 0===e){if(void 0!==n)return[n]}else if(void 0===n)return[e]}else{if(void 0===e)return void 0===n?[t]:[t,n];if(void 0===n)return[t,e]}return[e,n]}const _a={ariaLabel:"arrow",fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeMiterlimit:1,strokeWidth:1.5};class Ga extends Xr{constructor(t,e={}){const{x1:n,y1:r,x2:o,y2:i,bend:a=0,headAngle:l=60,headLength:s=8,inset:c=0,insetStart:u=c,insetEnd:f=c}=e;super(t,{x1:{value:n,scale:"x"},y1:{value:r,scale:"y"},x2:{value:o,scale:"x",optional:!0},y2:{value:i,scale:"y",optional:!0}},e,_a),this.bend=!0===a?22.5:Math.max(-90,Math.min(90,a)),this.headAngle=+l,this.headLength=+s,this.insetStart=+u,this.insetEnd=+f}render(t,e,n,r,o){const{x1:i,y1:a,x2:l=i,y2:s=a,SW:c}=n,{strokeWidth:u,bend:f,headAngle:h,headLength:d,insetStart:p,insetEnd:m}=this,g=c?t=>c[t]:$(void 0===u?1:u),y=f*Hr,v=h*Hr/2,x=d/1.5;return tr("svg:g",o).call(yr,this,r,o).call(br,this,e).call((e=>e.selectAll().data(t).enter().append("path").call(vr,this).attr("d",(t=>{let e=i[t],n=a[t],r=l[t],o=s[t];const c=Math.hypot(r-e,o-n);if(c<=p+m)return null;let u=Math.atan2(o-n,r-e);const f=Math.min(x*g(t),c/3),h=Math.hypot(c/Math.tan(y),c)/2;if(p||m)if(h<1e5){const t=Math.sign(y),[i,a]=function([t,e],[n,r],o,i){const a=n-t,l=r-e,s=Math.hypot(a,l),c=i*Math.sqrt(o*o-s*s/4)/s;return[(t+n)/2-l*c,(e+r)/2+a*c]}([e,n],[r,o],h,t);if(p&&([e,n]=Xa([i,a,h],[e,n,p],-t*Math.sign(p))),m){const[e,n]=Xa([i,a,h],[r,o,m],t*Math.sign(m));u+=Math.atan2(n-a,e-i)-Math.atan2(o-a,r-i),r=e,o=n}}else{const t=r-e,i=o-n,a=Math.hypot(t,i);p&&(e+=t/a*p,n+=i/a*p),m&&(r-=t/a*m,o-=i/a*m)}const d=u+y,w=d+v,b=d-v,k=r-f*Math.cos(w),$=o-f*Math.sin(w),M=r-f*Math.cos(b),L=o-f*Math.sin(b);return`M${e},${n}${h<1e5?`A${h},${h} 0,0,${y>0?1:0} `:"L"}${r},${o}M${k},${$}L${r},${o}L${M},${L}`})).call(dr,this,n))).node()}}function Xa([t,e,n],[r,o,i],a){const l=r-t,s=o-e,c=Math.hypot(l,s),u=(l*l+s*s-i*i+n*n)/(2*c),f=a*Math.sqrt(n*n-u*u);return[t+(l*u+s*f)/c,e+(s*u-l*f)/c]}const Ua={ariaLabel:"dot",fill:"none",stroke:"currentColor",strokeWidth:1.5};function Ha(t){return void 0===t.sort&&void 0===t.reverse?Dt({channel:"r",order:"descending"},t):t}class Va extends Xr{constructor(t,n={}){const{x:r,y:o,r:i,rotate:a,symbol:l=e.symbolCircle,frameAnchor:s}=n,[c,u]=A(a,0),[f,h]=function(t){if(null==t||kt(t))return[void 0,t];if("string"==typeof t){const e=bt.get(`${t}`.toLowerCase());if(e)return[void 0,e]}return[t,void 0]}(l),[d,p]=A(i,null==f?3:4.5);super(t,{x:{value:r,scale:"x",optional:!0},y:{value:o,scale:"y",optional:!0},r:{value:d,scale:"r",filter:Et,optional:!0},rotate:{value:c,optional:!0},symbol:{value:f,scale:"auto",optional:!0}},Ha(n),Ua),this.r=p,this.rotate=u,this.symbol=h,this.frameAnchor=st(s);const{channels:m}=this,{symbol:g}=m;if(g){const{fill:t,stroke:e}=m;g.hint={fill:t?t.value===g.value?"color":"currentColor":this.fill,stroke:e?e.value===g.value?"color":"currentColor":this.stroke}}}render(t,n,r,o,i){const{x:a,y:l}=n,{x:s,y:c,r:u,rotate:f,symbol:h}=r,{r:d,rotate:p,symbol:m}=this,[g,y]=Rr(this,o),v=this.symbol===e.symbolCircle,x=u?void 0:d*d*Math.PI;return St(d)&&(t=[]),tr("svg:g",i).call(yr,this,o,i).call(br,this,{x:s&&a,y:c&&l}).call((n=>n.selectAll().data(t).enter().append(v?"circle":"path").call(vr,this).call(v?t=>{t.attr("cx",s?t=>s[t]:g).attr("cy",c?t=>c[t]:y).attr("r",u?t=>u[t]:d)}:t=>{t.attr("transform",po`translate(${s?t=>s[t]:g},${c?t=>c[t]:y})${f?t=>` rotate(${f[t]})`:p?` rotate(${p})`:""}`).attr("d",u&&h?t=>{const n=e.pathRound();return h[t].draw(n,u[t]*u[t]*Math.PI),n}:u?t=>{const n=e.pathRound();return m.draw(n,u[t]*u[t]*Math.PI),n}:h?t=>{const n=e.pathRound();return h[t].draw(n,x),n}:(()=>{const t=e.pathRound();return m.draw(t,x),t})())}).call(dr,this,r))).node()}}function Za(t,e={}){let{x:n,y:r,...o}=e;return void 0===e.frameAnchor&&([n,r]=j(n,r)),new Va(t,{...o,x:n,y:r})}const Qa={ariaLabel:"line",fill:"none",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round",strokeMiterlimit:1};class Ja extends Xr{constructor(t,e={}){const{x:n,y:r,z:o,curve:i,tension:a}=e;super(t,{x:{value:n,scale:"x"},y:{value:r,scale:"y"},z:{value:D(e),optional:!0}},e,Qa),this.z=o,this.curve=qi(i,a),Ea(this,e)}filter(t){return t}project(t,e,n){this.curve!==Fi&&super.project(t,e,n)}render(t,n,r,o,i){const{x:a,y:l}=r,{curve:s}=this;return tr("svg:g",i).call(yr,this,o,i).call(br,this,n).call((n=>n.selectAll().data(gr(t,[a,l],this,r)).enter().append("path").call(vr,this).call(pr,this,r).call(ja,this,r).attr("d",s===Fi&&i.projection?function(t,n,r){const o=e.geoPath(t);return n=jn(n),r=jn(r),t=>{let e=[];const i=[e];for(const o of t)-1===o?(e=[],i.push(e)):e.push([n[o],r[o]]);return o({type:"MultiLineString",coordinates:i})}}(i.projection,a,l):e.line().curve(s).defined((t=>t>=0)).x((t=>a[t])).y((t=>l[t]))))).node()}}function Ka(t,e={}){let{x:n,y:r,...o}=e;return[n,r]=j(n,r),new Ja(t,{...o,x:n,y:r})}function tl(t,e={}){const{x:n=m,y:r=p,...o}=e;return new Ja(t,Ui({...o,x:n,y:r}))}function el(t,e={}){const{x:n=p,y:r=m,...o}=e;return new Ja(t,Xi({...o,x:n,y:r}))}class nl extends Xr{constructor(t,e,n={},r){super(t,e,n,r);const{inset:o=0,insetTop:i=o,insetRight:a=o,insetBottom:l=o,insetLeft:s=o,rx:c,ry:u}=n;this.insetTop=x(i),this.insetRight=x(a),this.insetBottom=x(l),this.insetLeft=x(s),this.rx=kr(c,"auto"),this.ry=kr(u,"auto")}render(t,e,n,r,o){const{rx:i,ry:a}=this;return tr("svg:g",o).call(yr,this,r,o).call(this._transform,this,e).call((o=>o.selectAll().data(t).enter().append("rect").call(vr,this).attr("x",this._x(e,n,r)).attr("width",this._width(e,n,r)).attr("y",this._y(e,n,r)).attr("height",this._height(e,n,r)).call(wr,"rx",i).call(wr,"ry",a).call(dr,this,n))).node()}_x(t,{x:e},{marginLeft:n}){const{insetLeft:r}=this;return e?t=>e[t]+r:n+r}_y(t,{y:e},{marginTop:n}){const{insetTop:r}=this;return e?t=>e[t]+r:n+r}_width({x:t},{x:e},{marginRight:n,marginLeft:r,width:o}){const{insetLeft:i,insetRight:a}=this,l=e&&t?t.bandwidth():o-n-r;return Math.max(0,l-i-a)}_height({y:t},{y:e},{marginTop:n,marginBottom:r,height:o}){const{insetTop:i,insetBottom:a}=this,l=e&&t?t.bandwidth():o-n-r;return Math.max(0,l-i-a)}}const rl={ariaLabel:"bar"};class ol extends nl{constructor(t,e={}){const{x1:n,x2:r,y:o}=e;super(t,{x1:{value:n,scale:"x"},x2:{value:r,scale:"x"},y:{value:o,scale:"y",type:"band",optional:!0}},e,rl)}_transform(t,e,{x:n}){t.call(br,e,{x:n},0,0)}_x({x:t},{x1:e,x2:n},{marginLeft:r}){const{insetLeft:o}=this;return Tn(t)?r+o:t=>Math.min(e[t],n[t])+o}_width({x:t},{x1:e,x2:n},{marginRight:r,marginLeft:o,width:i}){const{insetLeft:a,insetRight:l}=this;return Tn(t)?i-r-o-a-l:t=>Math.max(0,Math.abs(n[t]-e[t])-a-l)}}class il extends nl{constructor(t,e={}){const{x:n,y1:r,y2:o}=e;super(t,{y1:{value:r,scale:"y"},y2:{value:o,scale:"y"},x:{value:n,scale:"x",type:"band",optional:!0}},e,rl)}_transform(t,e,{y:n}){t.call(br,e,{y:n},0,0)}_y({y:t},{y1:e,y2:n},{marginTop:r}){const{insetTop:o}=this;return Tn(t)?r+o:t=>Math.min(e[t],n[t])+o}_height({y:t},{y1:e,y2:n},{marginTop:r,marginBottom:o,height:i}){const{insetTop:a,insetBottom:l}=this;return Tn(t)?i-r-o-a-l:t=>Math.max(0,Math.abs(n[t]-e[t])-a-l)}}function al(t,e={y:p,x2:m}){return new ol(t,sa(ro(oa(e))))}function ll(t,e={x:p,y2:m}){return new il(t,ca(oo(ia(e))))}const sl={ariaLabel:"rect"};class cl extends Xr{constructor(t,e={}){const{x1:n,y1:r,x2:o,y2:i,inset:a=0,insetTop:l=a,insetRight:s=a,insetBottom:c=a,insetLeft:u=a,rx:f,ry:h}=e;super(t,{x1:{value:n,scale:"x",optional:!0},y1:{value:r,scale:"y",optional:!0},x2:{value:o,scale:"x",optional:!0},y2:{value:i,scale:"y",optional:!0}},e,sl),this.insetTop=x(l),this.insetRight=x(s),this.insetBottom=x(c),this.insetLeft=x(u),this.rx=kr(f,"auto"),this.ry=kr(h,"auto")}render(t,e,n,r,o){const{x:i,y:a}=e,{x1:l,y1:s,x2:c,y2:u}=n,{marginTop:f,marginRight:h,marginBottom:d,marginLeft:p,width:m,height:g}=r,{projection:y}=o,{insetTop:v,insetRight:x,insetBottom:w,insetLeft:b,rx:k,ry:$}=this;return tr("svg:g",o).call(yr,this,r,o).call(br,this,{x:l&&c&&i,y:s&&u&&a},0,0).call((e=>e.selectAll().data(t).enter().append("rect").call(vr,this).attr("x",l&&c&&(y||!Tn(i))?t=>Math.min(l[t],c[t])+b:p+b).attr("y",s&&u&&(y||!Tn(a))?t=>Math.min(s[t],u[t])+v:f+v).attr("width",l&&c&&(y||!Tn(i))?t=>Math.max(0,Math.abs(c[t]-l[t])-b-x):m-h-p-x-b).attr("height",s&&u&&(y||!Tn(a))?t=>Math.max(0,Math.abs(s[t]-u[t])-v-w):g-f-d-v-w).call(wr,"rx",k).call(wr,"ry",$).call(dr,this,n))).node()}}function ul(t,e){return new cl(t,eo(no(e)))}function fl(t,e={y:p,interval:1,x2:m}){return new cl(t,sa(no(oa(e))))}function hl(t,e={x:p,interval:1,y2:m}){return new cl(t,ca(eo(ia(e))))}const dl={ariaLabel:"cell"};class pl extends nl{constructor(t,{x:e,y:n,...r}={}){super(t,{x:{value:e,scale:"x",type:"band",optional:!0},y:{value:n,scale:"y",type:"band",optional:!0}},r,dl)}_transform(t,e){t.call(br,e,{},0,0)}}function ml(t,e={}){let{x:n,y:r,...o}=e;return[n,r]=j(n,r),new pl(t,{...o,x:n,y:r})}function gl(t,e){e=vl(e);let{fx:n,fy:r,x:{value:o,reduce:i,zero:a,...l},y:{value:s,reduce:c,zero:u,...f},color:{value:h,color:d,reduce:p},size:{value:m,reduce:g},mark:y}=e;const{x:v,y:x}=e;let w,b;if(void 0===i&&(i=null==c&&null==o&&null==m&&null!=s?"count":null),void 0===c&&(c=null==i&&null==s&&null==m&&null!=o?"count":null),void 0!==g||null!=m||null!=p||null!=i||null!=c||null!=o&&!K(w??=xl(t,v))||null!=s&&!K(b??=xl(t,x))||(g="count"),void 0===a&&(a=!!bl(i)||void 0),void 0===u&&(u=!!bl(c)||void 0),null==o&&null==s)throw new Error("must specify x or y");if(null!=i&&null==s)throw new Error("reducing x requires y");if(null!=c&&null==o)throw new Error("reducing y requires x");return void 0===y&&(y=null!=m||null!=g?"dot":a||u||null!=p?"bar":null!=o&&null!=s?K(w??=xl(t,v))||K(b??=xl(t,x))||null==i&&null==c&&!yl(w)&&!yl(b)?"dot":"line":null!=o||null!=s?"rule":null),{fx:n??null,fy:r??null,x:{value:o??null,reduce:i??null,...void 0!==a&&{zero:a},...l},y:{value:s??null,reduce:c??null,...void 0!==u&&{zero:u},...f},color:{value:h??null,reduce:p??null,...void 0!==d&&{color:d}},size:{value:m??null,reduce:g??null},mark:y}}function yl(t){let n,r;for(const o of t){if(null==o)continue;if(void 0===n){n=o;continue}const t=Math.sign(e.ascending(n,o));if(t){if(void 0!==r&&t!==r)return!1;n=o,r=t}}return!0}function vl({x:t,y:e,color:n,size:r,fx:o,fy:i,mark:a}={}){return N(t)||(t=wl(t)),N(e)||(e=wl(e)),N(n)||(n=it(n)?{color:n}:wl(n)),N(r)||(r=wl(r)),N(o)&&({value:o}=wl(o)),N(i)&&({value:i}=wl(i)),{x:t,y:e,color:n,size:r,fx:o,fy:i,mark:a}}function xl(t,e){const n=h(t,e.value);return n&&(n.label=X(e.value)),n}function wl(t){return function(t){if("function"==typeof t?.reduce&&B(t))return!0;if(/^p\d{2}$/i.test(t))return!0;switch(`${t}`.toLowerCase()){case"first":case"last":case"count":case"distinct":case"sum":case"proportion":case"proportion-facet":case"deviation":case"min":case"min-index":case"max":case"max-index":case"mean":case"median":case"variance":case"mode":return!0}return!1}(t)?{reduce:t}:{value:t}}function bl(t){return/^(?:distinct|count|sum|proportion)$/i.test(t)}function kl(t,e){return!(null!=t&&!function(t){return/^(?:first|last|mode)$/i.test(t)}(t)||!e)&&K(e)}function $l(t){return!!t&&new e.InternSet(t).size>t.length>>1}function Ml(t,e={}){return Rl(Object.fromEntries(["x","x1","x2"].filter((t=>null!=e[t])).map((e=>[e,t]))),e)}function Ll(t,e={}){return Rl(Object.fromEntries(["y","y1","y2"].filter((t=>null!=e[t])).map((e=>[e,t]))),e)}function Al(t={},n={}){const r=D(n),o=Object.entries(t).map((([t,e])=>{const r=I(t,n);if(null==r)throw new Error(`missing channel: ${t}`);const[o,i]=_(r);return{key:t,input:r,output:o,setOutput:i,map:zl(e)}}));return{...Ct(n,((t,n)=>{const i=h(t,r),a=o.map((({input:e})=>h(t,e))),l=o.map((({setOutput:e})=>e(new Array(t.length))));for(const t of n)for(const n of i?e.group(t,(t=>i[t])).values():[t])o.forEach((({map:t},e)=>t.map(n,a[e],l[e])));return{data:t,facets:n}})),...Object.fromEntries(o.map((({key:t,output:e})=>[t,e])))}}const Rl=Al;function zl(t){if(t&&"function"==typeof t.map)return t;if("function"==typeof t)return El(t);switch(`${t}`.toLowerCase()){case"cumsum":return Sl;case"rank":return El(e.rank);case"quantile":return El(Ol)}throw new Error(`invalid map: ${t}`)}function Ol(t){const n=e.count(t)-1;return e.rank(t).map((t=>t/n))}function El(t){return{map(e,n,r){const o=t(F(n,e));if(o.length!==e.length)throw new Error("map function returned a mismatched length");for(let t=0,n=e.length;t<n;++t)r[e[t]]=o[t]}}}const Sl={map(t,e,n){let r=0;for(const o of t)n[o]=r+=e[o]}},Cl={ariaLabel:"tick",fill:null,stroke:"currentColor"};class Bl extends Xr{constructor(t,e,n){super(t,e,n,Cl)}render(t,e,n,r,o){return tr("svg:g",o).call(yr,this,r,o).call(this._transform,this,e).call((o=>o.selectAll().data(t).enter().append("line").call(vr,this).attr("x1",this._x1(e,n,r)).attr("x2",this._x2(e,n,r)).attr("y1",this._y1(e,n,r)).attr("y2",this._y2(e,n,r)).call(dr,this,n))).node()}}class Tl extends Bl{constructor(t,e={}){const{x:n,y:r,inset:o=0,insetTop:i=o,insetBottom:a=o}=e;super(t,{x:{value:n,scale:"x"},y:{value:r,scale:"y",type:"band",optional:!0}},e),this.insetTop=x(i),this.insetBottom=x(a)}_transform(t,e,{x:n}){t.call(br,e,{x:n},lr,0)}_x1(t,{x:e}){return t=>e[t]}_x2(t,{x:e}){return t=>e[t]}_y1({y:t},{y:e},{marginTop:n}){const{insetTop:r}=this;return e&&t?t=>e[t]+r:n+r}_y2({y:t},{y:e},{height:n,marginBottom:r}){const{insetBottom:o}=this;return e&&t?n=>e[n]+t.bandwidth()-o:n-r-o}}class Nl extends Bl{constructor(t,e={}){const{x:n,y:r,inset:o=0,insetRight:i=o,insetLeft:a=o}=e;super(t,{y:{value:r,scale:"y"},x:{value:n,scale:"x",type:"band",optional:!0}},e),this.insetRight=x(i),this.insetLeft=x(a)}_transform(t,e,{y:n}){t.call(br,e,{y:n},0,lr)}_x1({x:t},{x:e},{marginLeft:n}){const{insetLeft:r}=this;return e&&t?t=>e[t]+r:n+r}_x2({x:t},{x:e},{width:n,marginRight:r}){const{insetRight:o}=this;return e&&t?n=>e[n]+t.bandwidth()-o:n-r-o}_y1(t,{y:e}){return t=>e[t]}_y2(t,{y:e}){return t=>e[t]}}function Pl(t,e={}){const{x:n=m,...r}=e;return new Tl(t,{...r,x:n})}function Wl(t,e={}){const{y:n=m,...r}=e;return new Nl(t,{...r,y:n})}function jl(t){const e=Dl(t),n=ql(t);return t.map((t=>t<e||t>n?t:NaN))}function Dl(t,n){const r=2.5*Fl(t,n)-1.5*Yl(t,n);return e.min(t,(t=>t>=r?t:NaN))}function ql(t,n){const r=2.5*Yl(t,n)-1.5*Fl(t,n);return e.max(t,(t=>t<=r?t:NaN))}function Fl(t,n){return e.quantile(t,.25,n)}function Yl(t,n){return e.quantile(t,.75,n)}const Il={ariaLabel:"raster",stroke:null,pixelSize:1};function _l(t,e){const n=+t;if(isNaN(n))throw new Error(`invalid ${e}: ${t}`);return n}function Gl(t,e){const n=Math.floor(t);if(isNaN(n))throw new Error(`invalid ${e}: ${t}`);return n}class Xl extends Xr{constructor(t,e,n={},r){let{width:o,height:i,x:a,y:l,x1:s=(null==a?0:void 0),y1:c=(null==l?0:void 0),x2:u=(null==a?o:void 0),y2:f=(null==l?i:void 0),pixelSize:h=r.pixelSize,blur:d=0,interpolate:p}=n;if(null!=o&&(o=Gl(o,"width")),null!=i&&(i=Gl(i,"height")),null!=s&&(s=_l(s,"x1")),null!=c&&(c=_l(c,"y1")),null!=u&&(u=_l(u,"x2")),null!=f&&(f=_l(f,"y2")),null==a&&(null==s||null==u))throw new Error("missing x");if(null==l&&(null==c||null==f))throw new Error("missing y");null!=t&&null!=o&&null!=i&&(void 0===a&&null!=s&&null!=u&&(a=function(t,e,n){return{transform(r){const o=r.length,i=new Float64Array(o),a=(e-t)/n,l=t+a/2;for(let t=0;t<o;++t)i[t]=t%n*a+l;return i}}}(s,u,o)),void 0===l&&null!=c&&null!=f&&(l=function(t,e,n,r){return{transform(o){const i=o.length,a=new Float64Array(i),l=(e-t)/r,s=t+l/2;for(let t=0;t<i;++t)a[t]=Math.floor(t/n)%r*l+s;return a}}}(c,f,o,i))),super(t,{x:{value:a,scale:"x",optional:!0},y:{value:l,scale:"y",optional:!0},x1:{value:null==s?null:[s],scale:"x",optional:!0,filter:null},y1:{value:null==c?null:[c],scale:"y",optional:!0,filter:null},x2:{value:null==u?null:[u],scale:"x",optional:!0,filter:null},y2:{value:null==f?null:[f],scale:"y",optional:!0,filter:null},...e},n,r),this.width=o,this.height=i,this.pixelSize=_l(h,"pixelSize"),this.blur=_l(d,"blur"),this.interpolate=null==a||null==l?null:function(t){if("function"==typeof t)return t;if(null==t)return Jl;switch(`${t}`.toLowerCase()){case"none":return Jl;case"nearest":return ts;case"barycentric":return Kl();case"random-walk":return es()}throw new Error(`invalid interpolate: ${t}`)}(p)}}class Ul extends Xl{constructor(t,e={}){const{imageRendering:n}=e;if(null==t){const{fill:t,fillOpacity:n}=e;void 0!==A(n)[0]&&(e=Ql("fillOpacity",e)),void 0!==L(t)[0]&&(e=Ql("fill",e))}super(t,void 0,e,Il),this.imageRendering=kr(n,"auto")}scale(t,{color:e,...n},r){return super.scale(t,n,r)}render(t,n,r,o,i){const a=n.color??(t=>t),{x:l,y:s}=r,{document:c}=i,[u,f,h,d]=Vl(r,o,i),p=h-u,m=d-f,{pixelSize:g,width:y=Math.round(Math.abs(p)/g),height:v=Math.round(Math.abs(m)/g)}=this,x=y*v;let{fill:w,fillOpacity:b}=r,k=0;if(this.interpolate){const e=y/p,n=v/m,r=E(l,(t=>(t-u)*e),Float64Array),o=E(s,(t=>(t-f)*n),Float64Array);w&&(w=this.interpolate(t,y,v,r,o,w)),b&&(b=this.interpolate(t,y,v,r,o,b))}else null==this.data&&t&&(k=t.fi*x);const $=c.createElement("canvas");$.width=y,$.height=v;const M=$.getContext("2d"),L=M.createImageData(y,v),A=L.data;let{r:R,g:z,b:O}=e.rgb(this.fill)??{r:0,g:0,b:0},S=255*(this.fillOpacity??1);for(let t=0;t<x;++t){const n=t<<2;if(w){const r=a(w[t+k]);if(null==r){A[n+3]=0;continue}({r:R,g:z,b:O}=e.rgb(r))}b&&(S=255*b[t+k]),A[n+0]=R,A[n+1]=z,A[n+2]=O,A[n+3]=S}return this.blur>0&&e.blurImage(L,this.blur),M.putImageData(L,0,0),tr("svg:g",i).call(yr,this,o,i).call(br,this,n).call((t=>t.append("image").attr("transform",`translate(${u},${f}) scale(${Math.sign(h-u)},${Math.sign(d-f)})`).attr("width",Math.abs(p)).attr("height",Math.abs(m)).attr("preserveAspectRatio","none").call(wr,"image-rendering",this.imageRendering).call(vr,this).attr("xlink:href",$.toDataURL()))).node()}}function Hl(t,e,n){arguments.length<3&&(n=e,e=null);let{x:r,y:o,[t]:i,...a}=n;return void 0===r&&void 0===o&&Z(e)&&(r=w,o=b,void 0===i&&(i=k)),[e,{...a,x:r,y:o,[t]:i}]}function Vl({x1:t,y1:e,x2:n,y2:r},o,{projection:i}){const{width:a,height:l,marginTop:s,marginRight:c,marginBottom:u,marginLeft:f}=o;return[t&&null==i?t[0]:f,e&&null==i?e[0]:s,n&&null==i?n[0]:a-c,r&&null==i?r[0]:l-u]}function Zl({x1:t,y1:e,x2:n,y2:r},o,i,a){const l={};return t&&(l.x1=t),e&&(l.y1=e),n&&(l.x2=n),r&&(l.y2=r),Vl(be(l,o),i,a)}function Ql(t,e={}){const{[t]:n}=e;if("function"!=typeof n)throw new Error(`invalid ${t}: not a function`);return Bt({...e,[t]:void 0},(function(r,o,i,a,l,s){const{x:c,y:u}=a;if(!c)throw new Error("missing scale: x");if(!u)throw new Error("missing scale: y");const[f,h,d,p]=Zl(i,a,l,s),m=d-f,g=p-h,{pixelSize:y}=this,{width:v=Math.round(Math.abs(m)/y),height:x=Math.round(Math.abs(g)/y)}=e,w=new Array(v*x*(o?o.length:1)),b=m/v,k=g/x;let $=0;for(const t of o??[void 0])for(let e=.5;e<x;++e)for(let r=.5;r<v;++r,++$)w[$]=n(c.invert(f+r*b),u.invert(h+e*k),t);return{data:w,facets:o,channels:{[t]:{value:w,scale:!0}}}}))}function Jl(t,e,n,r,o,i){const a=new Array(e*n);for(const l of t)r[l]<0||r[l]>=e||o[l]<0||o[l]>=n||(a[Math.floor(o[l])*e+Math.floor(r[l])]=i[l]);return a}function Kl({random:t=e.randomLcg(42)}={}){return(n,r,o,i,a,l)=>{const s=n.length,c=r>>2,u=(o>>2)-1,f=s+2*c+2*u,h=new Float64Array(2*f);for(let t=0;t<s;++t)h[2*t]=i[n[t]],h[2*t+1]=a[n[t]];let d=s;const p=(t,e)=>(h[2*d]=t,h[2*d+1]=e,d++);for(let t=0;t<=c;++t)p(t/c*r,0),p(t/c*r,o);for(let t=0;t<u;++t)p(r,t/u*o),p(0,t/u*o);l=F(l,n);const m=new e.Delaunay(h.subarray(0,2*s));for(let t,e=s;e<f;++e)l[e]=l[t=m.find(h[2*e],h[2*e+1],t)];const{points:g,triangles:y}=new e.Delaunay(h),v=new l.constructor(r*o),x=function(t,e){return rt(t)||tt(t)?ns:function(t){return(e,n,r,o,i,a,l,s)=>{const c=t(l,s);return c<n?e:c<n+o?r:i}}(e)}(l,t);for(let t=0;t<y.length;t+=3){const e=y[t],n=y[t+1],i=y[t+2],a=g[2*e],s=g[2*n],c=g[2*i],u=g[2*e+1],f=g[2*n+1],h=g[2*i+1],d=Math.min(a,s,c),p=Math.max(a,s,c),m=Math.min(u,f,h),w=Math.max(u,f,h),b=(f-h)*(a-c)+(u-h)*(c-s);if(!b)continue;const k=l[e],$=l[n],M=l[i];for(let t=Math.floor(d);t<p;++t)for(let e=Math.floor(m);e<w;++e){if(t<0||t>=r||e<0||e>=o)continue;const n=t+.5,i=e+.5,l=((f-h)*(n-c)+(i-h)*(c-s))/b;if(l<0)continue;const d=((h-u)*(n-c)+(i-h)*(a-c))/b;if(d<0)continue;const p=1-l-d;p<0||(v[t+r*e]=x(k,l,$,d,M,p,t,e))}}return v}}function ts(t,n,r,o,i,a){const l=new a.constructor(n*r),s=e.Delaunay.from(t,(t=>o[t]),(t=>i[t]));let c,u;for(let e=.5,o=0;e<r;++e){u=c;for(let r=.5;r<n;++r,++o)u=s.find(r,e,u),.5===r&&(c=u),l[o]=a[t[u]]}return l}function es({random:t=e.randomLcg(42),minDistance:n=.5,maxSteps:r=2}={}){return(o,i,a,l,s,c)=>{const u=new c.constructor(i*a),f=e.Delaunay.from(o,(t=>l[t]),(t=>s[t]));let h,d,p;for(let e=.5,m=0;e<a;++e){d=h;for(let a=.5;a<i;++a,++m){let i,g=a,y=e;p=d=f.find(g,y,d),.5===a&&(h=d);let v=0;for(;(i=Math.hypot(l[o[p]]-g,s[o[p]]-y))>n&&v<r;){const n=2*t(a,e,v)*Math.PI;g+=Math.cos(n)*i,y+=Math.sin(n)*i,p=f.find(g,y,p),++v}u[m]=c[o[p]]}}return u}}function ns(t,e,n,r,o,i){return e*t+r*n+i*o}const rs={ariaLabel:"contour",fill:"none",stroke:"currentColor",strokeMiterlimit:1,pixelSize:2};class os extends Xl{constructor(t,{smooth:n=!0,value:r,...o}={}){const i=ur({},o,rs);if(void 0===r)for(const t in i)if(null!=i[t].value){if(void 0!==r)throw new Error("ambiguous contour value");r=o[t],o[t]="value"}if(null!=r){const t={transform:t=>t.map((t=>t.value)),label:X(r)};for(const e in i)"value"===o[e]&&(o[e]=t)}if(null==t){if(null==r)throw new Error("missing contour value");o=Ql("value",{value:r,...o}),r=null}else{let{interpolate:t}=o;void 0===r&&(r=m),void 0===t&&(o.interpolate="nearest")}super(t,{value:{value:r,optional:!0}},function({thresholds:t,interval:n,...r}){return t=Ji(t,n,e.thresholdSturges),Bt(r,(function(n,r,o,i,a,l){const[s,c,u,f]=Zl(o,i,a,l),h=u-s,d=f-c,{pixelSize:p,width:m=Math.round(Math.abs(h)/p),height:g=Math.round(Math.abs(d)/p)}=this,y=m/h,v=g/d,x=o.value.value,w=[];if(this.interpolate){const{x:t,y:n}=Jn(o,i,l),a=e.map(t,(t=>(t-s)*y),Float64Array),u=e.map(n,(t=>(t-c)*v),Float64Array),f=[o.x,o.y,o.value],h=[a,u,x];for(const t of r){const e=this.filter(t,f,h);w.push(this.interpolate(e,m,g,a,u,x))}}else if(r){const t=m*g,e=r.length;for(let n=0;n<e;++n)w.push(x.slice(n*t,n*t+t))}else w.push(x);if(this.blur>0)for(const t of w)e.blur2({data:t,width:m,height:g},this.blur);const b=function(t,n,r,o){if("function"==typeof t?.range)return t.range(t.floor(r),o);"function"==typeof t&&(t=t(n,r,o));if("number"!=typeof t)return O(t,Array);const i=e.ticks(...e.nice(r,o,t),t);for(;i[i.length-1]>=o;)i.pop();for(;i[1]<r;)i.shift();return i}(t,x,...function(t){return[e.min(t,(t=>e.min(t,is))),e.max(t,(t=>e.max(t,is)))]}(w));if(null===b)throw new Error(`unsupported thresholds: ${t}`);const{contour:k}=e.contours().size([m,g]).smooth(this.smooth),$=[],M=[];for(const t of w)M.push(e.range($.length,$.push(...b.map((e=>k(t,e))))));for(const{coordinates:t}of $)for(const e of t)for(const t of e)for(const e of t)e[0]=e[0]/y+s,e[1]=e[1]/v+c;return{data:$,facets:M,channels:we(this.contourChannels,$)}}))}(o),rs);const a={geometry:{value:m}};for(const t in this.channels){const e=this.channels[t],{scale:n}=e;"x"!==n&&"y"!==n&&"value"!==t&&(a[t]=e,delete this.channels[t])}this.contourChannels=a,this.smooth=!!n}filter(t,{x:e,y:n,value:r,...o},i){return super.filter(t,o,i)}render(t,n,r,o,i){const{geometry:a}=r,l=e.geoPath();return tr("svg:g",i).call(yr,this,o,i).call(br,this,n).call((e=>{e.selectAll().data(t).enter().append("path").call(vr,this).attr("d",(t=>l(a[t]))).call(dr,this,r)})).node()}}function is(t){return isFinite(t)?t:NaN}const as={ariaLabel:"delaunay link",fill:"none",stroke:"currentColor",strokeMiterlimit:1},ls={ariaLabel:"delaunay mesh",fill:null,stroke:"currentColor",strokeOpacity:.2},ss={ariaLabel:"hull",fill:"none",stroke:"currentColor",strokeWidth:1.5,strokeMiterlimit:1},cs={ariaLabel:"voronoi",fill:"none",stroke:"currentColor",strokeMiterlimit:1},us={ariaLabel:"voronoi mesh",fill:null,stroke:"currentColor",strokeOpacity:.2};class fs extends Xr{constructor(t,e={}){const{x:n,y:r,z:o,curve:i,tension:a}=e;super(t,{x:{value:n,scale:"x",optional:!0},y:{value:r,scale:"y",optional:!0},z:{value:o,optional:!0}},e,as),this.curve=Di(i,a),Ea(this,e)}render(t,n,r,o,i){const{x:a,y:l}=n,{x:s,y:c,z:u}=r,{curve:f}=this,[h,d]=Rr(this,o),p=s?t=>s[t]:$(h),m=c?t=>c[t]:$(d),g=this;function y(t){let n=-1;const o=[],i={};for(const t in r)i[t]=[];const a=[],l=[],s=[],c=[];function u(e,u){e=t[e],u=t[u],o.push(++n),a[n]=p(e),s[n]=m(e),l[n]=p(u),c[n]=m(u);for(const t in r)i[t].push(r[t][u])}const{halfedges:h,hull:d,triangles:y}=e.Delaunay.from(t,p,m);for(let t=0;t<h.length;++t){const e=h[t];e>t&&u(y[t],y[e])}for(let t=0;t<d.length;++t)u(d[t],d[(t+1)%d.length]);e.select(this).selectAll().data(o).join("path").call(vr,g).attr("d",(t=>{const n=e.pathRound(),r=f(n);return r.lineStart(),r.point(a[t],s[t]),r.point(l[t],c[t]),r.lineEnd(),n})).call(dr,g,i).call(Wa,g,i)}return tr("svg:g",i).call(yr,this,o,i).call(br,this,{x:s&&a,y:c&&l}).call(u?n=>n.selectAll().data(e.group(t,(t=>u[t])).values()).enter().append("g").each(y):e=>e.datum(t).each(y)).node()}}class hs extends Xr{constructor(t,e={},n,r=(({z:t})=>t)){const{x:o,y:i}=e;super(t,{x:{value:o,scale:"x",optional:!0},y:{value:i,scale:"y",optional:!0},z:{value:r(e),optional:!0}},e,n)}render(t,n,r,o,i){const{x:a,y:l}=n,{x:s,y:c,z:u}=r,[f,h]=Rr(this,o),d=s?t=>s[t]:$(f),p=c?t=>c[t]:$(h),m=this;function g(t){const n=e.Delaunay.from(t,d,p);e.select(this).append("path").datum(t[0]).call(vr,m).attr("d",m._render(n,o)).call(dr,m,r)}return tr("svg:g",i).call(yr,this,o,i).call(br,this,{x:s&&a,y:c&&l}).call(u?n=>n.selectAll().data(e.group(t,(t=>u[t])).values()).enter().append("g").each(g):e=>e.datum(t).each(g)).node()}}class ds extends hs{constructor(t,e={}){super(t,e,ls),this.fill="none"}_render(t){return t.render()}}class ps extends hs{constructor(t,e={}){super(t,e,ss,D)}_render(t){return t.renderHull()}}class ms extends Xr{constructor(t,e={}){const{x:n,y:r,z:o}=e;super(t,{x:{value:n,scale:"x",optional:!0},y:{value:r,scale:"y",optional:!0},z:{value:o,optional:!0}},e,cs)}render(t,n,r,o,i){const{x:a,y:l}=n,{x:s,y:c,z:u}=r,[f,h]=Rr(this,o),d=s?t=>s[t]:$(f),p=c?t=>c[t]:$(h),m=this;function g(t){const n=ys(e.Delaunay.from(t,d,p),o);e.select(this).selectAll().data(t).enter().append("path").call(vr,m).attr("d",((t,e)=>n.renderCell(e))).call(dr,m,r)}return tr("svg:g",i).call(yr,this,o,i).call(br,this,{x:s&&a,y:c&&l}).call(u?n=>n.selectAll().data(e.group(t,(t=>u[t])).values()).enter().append("g").each(g):e=>e.datum(t).each(g)).node()}}class gs extends hs{constructor(t,e){super(t,e,us),this.fill="none"}_render(t,e){return ys(t,e).render()}}function ys(t,e){const{width:n,height:r,marginTop:o,marginRight:i,marginBottom:a,marginLeft:l}=e;return t.voronoi([l,o,n-i,r-a])}function vs(t,e,{x:n,y:r,...o}={}){return[n,r]=j(n,r),new t(e,{...o,x:n,y:r})}const xs={ariaLabel:"density",fill:"none",stroke:"currentColor",strokeMiterlimit:1};class ws extends Xr{constructor(t,{x:n,y:r,z:o,weight:i,fill:a,stroke:l,...s}={}){const c=ks(a)&&(a="currentColor",!0),u=ks(l)&&(l="currentColor",!0);super(t,{x:{value:n,scale:"x",optional:!0},y:{value:r,scale:"y",optional:!0},z:{value:D({z:o,fill:a,stroke:l}),optional:!0},weight:{value:i,optional:!0}},function(t,n,r){const o=100;let{bandwidth:i,thresholds:a}=t;return i=void 0===i?20:+i,a=void 0===a?20:"function"==typeof a?.[Symbol.iterator]?jn(a):+a,Bt(t,(function(t,l,s,c,u,f){const h=s.weight?jn(s.weight.value):null,d=s.z?.value,{z:p}=this,[m,g]=Rr(this,u),{width:y,height:v}=u,{x:x,y:w}=Jn(s,c,f),b=Object.fromEntries(Object.entries(s).filter((([t])=>!bs.has(t))).map((([t,e])=>[t,{...e,value:[]}]))),k=n&&[],$=r&&[],M=e.contourDensity().x(x?t=>x[t]:m).y(w?t=>w[t]:g).weight(h?t=>h[t]:1).size([y,v]).bandwidth(i),L=[];for(const t of l){const e=[];L.push(e);for(const n of d?mr(t,d,p):[t]){const t=M.contours(n);e.push([n,t])}}let A=a;if(!C(A)){let t=0;for(const e of L)for(const[,n]of e){const e=n.max;e>t&&(t=e)}A=Float64Array.from({length:a-1},((e,n)=>t*o*(n+1)/a))}const R=[],z=[];for(const t of L){const e=[];R.push(e);for(const[n,r]of t)for(const t of A){e.push(z.length),z.push(r(t/o)),k&&k.push(t),$&&$.push(t);for(const t in b)b[t].value.push(s[t].value[n[0]])}}return k&&k.push(0),$&&$.push(0),{data:t,facets:R,channels:{...b,...k&&{fill:{value:k,scale:"color"}},...$&&{stroke:{value:$,scale:"color"}},contours:{value:z}}}}))}({...s,fill:a,stroke:l},c,u),xs),c&&(this.fill=void 0),u&&(this.stroke=void 0),this.z=o}filter(t){return t}render(t,n,r,o,i){const{contours:a}=r,l=e.geoPath();return e.create("svg:g",i).call(yr,this,o,i).call(br,this,{}).call((e=>e.selectAll().data(t).enter().append("path").call(vr,this).call(dr,this,r).attr("d",(t=>l(a[t]))))).node()}}const bs=new Set(["x","y","z","weight"]);function ks(t){return/^density$/i.test(t)}const $s={ariaLabel:"geo",fill:"none",stroke:"currentColor",strokeWidth:1,strokeLinecap:"round",strokeLinejoin:"round",strokeMiterlimit:1};class Ms extends Xr{constructor(t,e={}){const[n,r]=A(e.r,3);super(t,{geometry:{value:e.geometry},r:{value:n,scale:"r",filter:Et,optional:!0}},Ha(e),$s),this.r=r}render(t,n,r,o,i){const{geometry:a,r:l}=r,s=e.geoPath(i.projection??function({x:t,y:n}){if(t||n)return t??=t=>t,n??=t=>t,e.geoTransform({point(e,r){this.stream.point(t(e),n(r))}})}(n)),{r:c}=this;return St(c)?t=[]:void 0!==c&&s.pointRadius(c),tr("svg:g",i).call(yr,this,o,i).call(br,this,n).call((e=>{e.selectAll().data(t).enter().append("path").call(vr,this).attr("d",l?t=>s.pointRadius(l[t])(a[t]):t=>s(a[t])).call(dr,this,r)})).node()}}function Ls(t,{geometry:e=m,...n}={}){switch(t?.type){case"FeatureCollection":t=t.features;break;case"GeometryCollection":t=t.geometries;break;case"Feature":case"LineString":case"MultiLineString":case"MultiPoint":case"MultiPolygon":case"Point":case"Polygon":case"Sphere":t=[t]}return new Ms(t,{geometry:e,...n})}const As=.5;function Rs(t,e,n,r){const o=r*(1.5/vt),i=new Map;for(const a of t){let t=e[a],l=n[a];if(isNaN(t)||isNaN(l))continue;let s=Math.round(l=(l-0)/o),c=Math.round(t=(t-As)/r-(1&s)/2),u=l-s;if(3*Math.abs(u)>1){let e=t-c,n=c+(t<c?-1:1)/2,r=s+(l<s?-1:1),o=t-n,i=l-r;e*e+u*u>o*o+i*i&&(c=n+(1&s?1:-1)/2,s=r)}const f=`${c},${s}`;let h=i.get(f);void 0===h&&(i.set(f,h=[]),h.x=(c+(1&s)/2)*r+As,h.y=s*o+0),h.push(a)}return i.values()}const zs={ariaLabel:"hexgrid",fill:"none",stroke:"currentColor",strokeOpacity:.1};class Os extends Xr{constructor({binWidth:t=20,clip:e=!0,...n}={}){super(void 0,void 0,{clip:e,...n},zs),this.binWidth=x(t)}render(t,e,n,r,o){const{binWidth:i}=this,{marginTop:a,marginRight:l,marginBottom:s,marginLeft:c,width:u,height:f}=r,h=c-As,d=u-l-As,p=a-0,m=f-s-0,g=i/2,y=g*xt,v=y/2,x=2*g,w=1.5*y,b=Math.floor(h/x),k=Math.ceil(d/x),$=Math.floor((p+v)/w),M=Math.ceil((m-v)/w)+1,L=`m0,${Es(-y)}l${Es(g)},${Es(v)}v${Es(y)}l${Es(-g)},${Es(v)}`;let A=L;for(let t=$;t<M;++t)for(let e=b;e<k;++e)A+=`M${Es(e*x+(1&t)*g)},${Es(t*w)}${L}`;return tr("svg:g",o).call(yr,this,r,o).call(br,this,{},lr+As,lr+0).call((t=>t.append("path").call(vr,this).attr("d",A))).node()}}function Es(t){return Math.round(1e3*t)/1e3}const Ss={ariaLabel:"image",fill:null,stroke:null};class Cs extends Xr{constructor(t,e={}){let{x:n,y:r,width:o,height:i,src:a,preserveAspectRatio:l,crossOrigin:s,frameAnchor:c,imageRendering:u}=e;void 0===o&&void 0!==i?o=i:void 0===i&&void 0!==o&&(i=o);const[f,h]="string"==typeof(d=a)&&(function(t){return/^\.*\//.test(t)}(d)||function(t){return/^(blob|data|file|http|https):/i.test(t)}(d))?[void 0,d]:[d,void 0];var d;const[p,m]=A(o,16),[g,y]=A(i,16);super(t,{x:{value:n,scale:"x",optional:!0},y:{value:r,scale:"y",optional:!0},width:{value:p,filter:Et,optional:!0},height:{value:g,filter:Et,optional:!0},src:{value:f,optional:!0}},e,Ss),this.src=h,this.width=m,this.height=y,this.preserveAspectRatio=kr(l,"xMidYMid"),this.crossOrigin=v(s),this.frameAnchor=st(c),this.imageRendering=kr(u,"auto")}render(t,e,n,r,o){const{x:i,y:a}=e,{x:l,y:s,width:c,height:u,src:f}=n,[h,d]=Rr(this,r);return tr("svg:g",o).call(yr,this,r,o).call(br,this,{x:l&&i,y:s&&a}).call((e=>e.selectAll().data(t).enter().append("image").call(vr,this).attr("x",c&&l?t=>l[t]-c[t]/2:c?t=>h-c[t]/2:l?t=>l[t]-this.width/2:h-this.width/2).attr("y",u&&s?t=>s[t]-u[t]/2:u?t=>d-u[t]/2:s?t=>s[t]-this.height/2:d-this.height/2).attr("width",c?t=>c[t]:this.width).attr("height",u?t=>u[t]:this.height).call(wr,"href",f?t=>f[t]:this.src).call(wr,"preserveAspectRatio",this.preserveAspectRatio).call(wr,"crossorigin",this.crossOrigin).call(wr,"image-rendering",this.imageRendering).call(dr,this,n))).node()}}function Bs(t,e,n){var r=0===t||1===t?0:Math.exp(Ns(e+n)-Ns(e)-Ns(n)+e*Math.log(t)+n*Math.log(1-t));return!(t<0||t>1)&&(t<(e+1)/(e+n+2)?r*Ts(t,e,n)/e:1-r*Ts(1-t,n,e)/n)}function Ts(t,e,n){var r,o,i,a,l=1e-30,s=1,c=e+n,u=e+1,f=e-1,h=1,d=1-c*t/u;for(Math.abs(d)<l&&(d=l),a=d=1/d;s<=100&&(d=1+(o=s*(n-s)*t/((f+(r=2*s))*(e+r)))*d,Math.abs(d)<l&&(d=l),h=1+o/h,Math.abs(h)<l&&(h=l),a*=(d=1/d)*h,d=1+(o=-(e+s)*(c+s)*t/((e+r)*(u+r)))*d,Math.abs(d)<l&&(d=l),h=1+o/h,Math.abs(h)<l&&(h=l),a*=i=(d=1/d)*h,!(Math.abs(i-1)<3e-7));s++);return a}function Ns(t){var e,n,r,o=0,i=[76.18009172947146,-86.5053203294167,24.01409824083091,-1.231739572450155,.001208650973866179,-5395239384953e-18],a=1.000000000190015;for(r=(n=e=t)+5.5,r-=(e+.5)*Math.log(r);o<6;o++)a+=i[o]/++n;return Math.log(2.506628274631*a/e)-r}function Ps(t,e){var n=function(t,e,n){var r,o,i,a,l,s,c,u,f,h,d=e-1,p=n-1,m=0;if(t<=0)return 0;if(t>=1)return 1;for(e>=1&&n>=1?(i=t<.5?t:1-t,s=(2.30753+.27061*(a=Math.sqrt(-2*Math.log(i))))/(1+a*(.99229+.04481*a))-a,t<.5&&(s=-s),c=(s*s-3)/6,u=2/(1/(2*e-1)+1/(2*n-1)),f=s*Math.sqrt(c+u)/u-(1/(2*n-1)-1/(2*e-1))*(c+5/6-2/(3*u)),s=e/(e+n*Math.exp(2*f))):(r=Math.log(e/(e+n)),o=Math.log(n/(e+n)),s=t<(a=Math.exp(e*r)/e)/(f=a+(l=Math.exp(n*o)/n))?Math.pow(e*f*t,1/e):1-Math.pow(n*f*(1-t),1/n)),h=-Ns(e)-Ns(n)+Ns(e+n);m<10;m++){if(0===s||1===s)return s;if((s-=a=(l=(Bs(s,e,n)-t)/(a=Math.exp(d*Math.log(s)+p*Math.log(1-s)+h)))/(1-.5*Math.min(1,l*(d/s-p/(1-s)))))<=0&&(s=.5*(s+a)),s>=1&&(s=.5*(s+a+1)),Math.abs(a)<1e-8*s&&m>0)break}return s}(2*Math.min(t,1-t),.5*e,.5);return n=Math.sqrt(e*(1-n)/n),t>.5?n:-n}const Ws={ariaLabel:"linear-regression",fill:"currentColor",fillOpacity:.1,stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round",strokeMiterlimit:1};class js extends Xr{constructor(t,e={}){const{x:n,y:r,z:o,ci:i=.95,precision:a=4}=e;if(super(t,{x:{value:n,scale:"x"},y:{value:r,scale:"y"},z:{value:D(e),optional:!0}},e,Ws),this.z=o,this.ci=+i,this.precision=+a,!(0<=this.ci&&this.ci<1))throw new Error(`invalid ci; not in [0, 1): ${i}`);if(!(this.precision>0))throw new Error(`invalid precision: ${a}`)}render(t,e,n,r,o){const{x:i,y:a,z:l}=n,{ci:s}=this;return tr("svg:g",o).call(yr,this,r,o).call(br,this,e).call((e=>e.selectAll().data(l?mr(t,l,this.z):[t]).enter().call((t=>t.append("path").attr("fill","none").call(vr,this).call(pr,this,{...n,fill:null,fillOpacity:null}).attr("d",(t=>this._renderLine(t,i,a))).call(s&&!lt(this.fill)?t=>t.select(Ds).attr("stroke","none").call(vr,this).call(pr,this,{...n,stroke:null,strokeOpacity:null,strokeWidth:null}).attr("d",(t=>this._renderBand(t,i,a))):()=>{}))))).node()}}function Ds(){return this.parentNode.insertBefore(this.ownerDocument.createElementNS(e.namespaces.svg,"path"),this)}class qs extends js{constructor(t,e){super(t,e)}_renderBand(t,n,r){const{ci:o,precision:i}=this,[a,l]=e.extent(t,(t=>r[t])),s=Ys(t,r,n),c=Is(t,r,n,(1-o)/2,s);return e.area().y((t=>t)).x0((t=>c(t,-1))).x1((t=>c(t,1)))(e.range(a,l-i/2,i).concat(l))}_renderLine(t,n,r){const[o,i]=e.extent(t,(t=>r[t])),a=Ys(t,r,n);return`M${a(o)},${o}L${a(i)},${i}`}}class Fs extends js{constructor(t,e){super(t,e)}_renderBand(t,n,r){const{ci:o,precision:i}=this,[a,l]=e.extent(t,(t=>n[t])),s=Ys(t,n,r),c=Is(t,n,r,(1-o)/2,s);return e.area().x((t=>t)).y0((t=>c(t,-1))).y1((t=>c(t,1)))(e.range(a,l-i/2,i).concat(l))}_renderLine(t,n,r){const[o,i]=e.extent(t,(t=>n[t])),a=Ys(t,n,r);return`M${o},${a(o)}L${i},${a(i)}`}}function Ys(t,e,n){let r=0,o=0,i=0,a=0;for(const l of t){const t=e[l],s=n[l];r+=t,o+=s,i+=t*s,a+=t*t}const l=t.length,s=(l*i-r*o)/(l*a-r*r),c=(o-s*r)/l;return t=>s*t+c}function Is(t,n,r,o,i){const a=e.sum(t,(t=>n[t]))/t.length;let l=0,s=0;for(const e of t)l+=(n[e]-a)**2,s+=(r[e]-i(n[e]))**2;const c=Math.sqrt(s/(t.length-2)),u=Ps(o,t.length-2);return(e,n)=>{const r=i(e),o=c*Math.sqrt(1/t.length+(e-a)**2/l);return r+n*u*o}}function _s(t={}){let{path:n=m,delimiter:r,frameAnchor:o,treeLayout:i=e.tree,treeSort:a,treeSeparation:l,treeAnchor:s,...c}=t;s=Xs(s),a=Vs(a),void 0===o&&(o=s.frameAnchor);const u=Qs(r),f=fc(c,Ks),[d,p]=_(),[y,v]=_();return{x:d,y:y,frameAnchor:o,...Ct(c,((t,r)=>{const o=u(h(t,n)),c=p([]),d=v([]);let m=-1;const y=[],x=[],w=e.stratify().path((t=>o[t])),b=i();b.nodeSize&&b.nodeSize([1,1]),b.separation&&void 0!==l&&b.separation(l??g);for(const t of f)t[uc]=t[sc]([]);for(const e of r){const n=[],r=w(e.filter((t=>null!=o[t]))).each((e=>e.data=t[e.data]));null!=a&&r.sort(a),b(r);for(const t of r.descendants()){n.push(++m),y[m]=t.data,s.position(t,m,c,d);for(const e of f)e[uc][m]=e[cc](t)}x.push(n)}return{data:y,facets:x}})),...Object.fromEntries(f)}}function Gs(t={}){let{path:n=m,delimiter:r,curve:o="bump-x",stroke:i="#555",strokeWidth:a=1.5,strokeOpacity:l=.5,treeLayout:s=e.tree,treeSort:c,treeSeparation:u,treeAnchor:f,...d}=t;f=Xs(f),c=Vs(c),d={curve:o,stroke:i,strokeWidth:a,strokeOpacity:l,...d};const p=Qs(r),y=fc(d,tc),[v,x]=_(),[w,b]=_(),[k,$]=_(),[M,L]=_();return{x1:v,x2:w,y1:k,y2:M,...Ct(d,((t,r)=>{const o=p(h(t,n)),i=x([]),a=b([]),l=$([]),d=L([]);let m=-1;const v=[],w=[],k=e.stratify().path((t=>o[t])),M=s();M.nodeSize&&M.nodeSize([1,1]),M.separation&&void 0!==u&&M.separation(u??g);for(const t of y)t[uc]=t[sc]([]);for(const e of r){const n=[],r=k(e.filter((t=>null!=o[t]))).each((e=>e.data=t[e.data]));null!=c&&r.sort(c),M(r);for(const{source:t,target:e}of r.links()){n.push(++m),v[m]=e.data,f.position(t,m,i,l),f.position(e,m,a,d);for(const n of y)n[uc][m]=n[cc](e,t)}w.push(n)}return{data:v,facets:w}})),...Object.fromEntries(y)}}function Xs(t="left"){switch(`${t}`.trim().toLowerCase()){case"left":return Us;case"right":return Hs}throw new Error(`invalid tree anchor: ${t}`)}const Us={frameAnchor:"left",dx:6,position({x:t,y:e},n,r,o){r[n]=e,o[n]=-t}},Hs={frameAnchor:"right",dx:-6,position({x:t,y:e},n,r,o){r[n]=-e,o[n]=-t}};function Vs(t){return null==t||"function"==typeof t?t:`${t}`.trim().toLowerCase().startsWith("node:")?Zs(Ks(t)):Zs(function(t){return e=>e.data?.[t]}(t))}function Zs(t){return(e,n)=>At(t(e),t(n))}function Qs(t="/"){return"/"==`${t}`?t=>t:e=>{return e.map((n=t,r="/",n=new RegExp(function(t){return`${t}`.replace(/[\\^$*+?.()|[\]{}]/g,"\\$&")}(n),"g"),t=>null==t?null:`${t}`.replace(n,r)));var n,r}}function Js(t){return B(t)&&"function"==typeof t.node}function Ks(t){if(Js(t))return t.node;if((t=`${t}`.trim().toLowerCase()).startsWith("node:")){switch(t){case"node:name":return nc;case"node:path":return ec;case"node:internal":return ic;case"node:depth":return rc;case"node:height":return oc}throw new Error(`invalid node value: ${t}`)}}function tc(t){if(Js(t))return t.node;if(B(e=t)&&"function"==typeof e.link)return t.link;var e;if((t=`${t}`.trim().toLowerCase()).startsWith("node:")||t.startsWith("parent:")){switch(t){case"parent:name":return ac(nc);case"parent:path":return ac(ec);case"parent:depth":return ac(rc);case"parent:height":return ac(oc);case"node:name":return nc;case"node:path":return ec;case"node:internal":return ic;case"node:depth":return rc;case"node:height":return oc}throw new Error(`invalid link value: ${t}`)}}function ec(t){return t.id}function nc(t){return function(t){let e=t.length;for(;--e>0&&!lc(t,e););return t.slice(e+1)}(t.id)}function rc(t){return t.depth}function oc(t){return t.height}function ic(t){return!!t.children}function ac(t){return(e,n)=>null==n?void 0:t(n)}function lc(t,e){if("/"===t[e]){let n=0;for(;e>0&&"\\"===t[--e];)++n;if(0==(1&n))return!0}return!1}const sc=2,cc=3,uc=4;function fc(t,e){const n=[];for(const r in t){const o=t[r],i=e(o);void 0!==i&&n.push([r,..._(o),i])}return n}function hc(t,e={}){let{fill:n,stroke:r,strokeWidth:o,strokeOpacity:i,strokeLinejoin:a,strokeLinecap:l,strokeMiterlimit:s,strokeDasharray:c,strokeDashoffset:u,marker:f,markerStart:h=f,markerEnd:d=f,dot:p=at(h)&&at(d),text:m="node:name",textStroke:g="white",title:y="node:path",dx:v,dy:x,...w}=e;return void 0===v&&(v=Xs(w.treeAnchor).dx),Ur(Ya(t,Gs({markerStart:h,markerEnd:d,stroke:void 0!==r?r:void 0===n?"node:internal":n,strokeWidth:o,strokeOpacity:i,strokeLinejoin:a,strokeLinecap:l,strokeMiterlimit:s,strokeDasharray:c,strokeDashoffset:u,...w})),p?Za(t,_s({fill:void 0===n?"node:internal":n,title:y,...w})):null,null!=m?xo(t,_s({text:m,fill:void 0===n?"currentColor":n,stroke:g,dx:v,dy:x,title:y,...w})):null)}function dc(t,e,n,r,o){for(var i=o+1;r<=o;){var a=r+o>>>1,l=t[a];(void 0!==n?n(l,e):l-e)>=0?(i=a,o=a-1):r=a+1}return i}function pc(t,e,n,r,o){for(var i=o+1;r<=o;){var a=r+o>>>1,l=t[a];(void 0!==n?n(l,e):l-e)>0?(i=a,o=a-1):r=a+1}return i}function mc(t,e,n,r,o){for(var i=r-1;r<=o;){var a=r+o>>>1,l=t[a];(void 0!==n?n(l,e):l-e)<0?(i=a,r=a+1):o=a-1}return i}function gc(t,e,n,r,o){for(var i=r-1;r<=o;){var a=r+o>>>1,l=t[a];(void 0!==n?n(l,e):l-e)<=0?(i=a,r=a+1):o=a-1}return i}function yc(t,e,n,r,o){for(;r<=o;){var i=r+o>>>1,a=t[i],l=void 0!==n?n(a,e):a-e;if(0===l)return i;l<=0?r=i+1:o=i-1}return-1}function vc(t,e,n,r,o,i){return"function"==typeof n?i(t,e,n,void 0===r?0:0|r,void 0===o?t.length-1:0|o):i(t,e,void 0,void 0===n?0:0|n,void 0===r?t.length-1:0|r)}var xc={ge:function(t,e,n,r,o){return vc(t,e,n,r,o,dc)},gt:function(t,e,n,r,o){return vc(t,e,n,r,o,pc)},lt:function(t,e,n,r,o){return vc(t,e,n,r,o,mc)},le:function(t,e,n,r,o){return vc(t,e,n,r,o,gc)},eq:function(t,e,n,r,o){return vc(t,e,n,r,o,yc)}},wc=function(t){if(!t||0===t.length)return new Tc(null);return new Tc(Bc(t))};function bc(t,e,n,r,o){this.mid=t,this.left=e,this.right=n,this.leftPoints=r,this.rightPoints=o,this.count=(e?e.count:0)+(n?n.count:0)+r.length}var kc=bc.prototype;function $c(t,e){t.mid=e.mid,t.left=e.left,t.right=e.right,t.leftPoints=e.leftPoints,t.rightPoints=e.rightPoints,t.count=e.count}function Mc(t,e){var n=Bc(e);t.mid=n.mid,t.left=n.left,t.right=n.right,t.leftPoints=n.leftPoints,t.rightPoints=n.rightPoints,t.count=n.count}function Lc(t,e){var n=t.intervals([]);n.push(e),Mc(t,n)}function Ac(t,e){var n=t.intervals([]),r=n.indexOf(e);return r<0?0:(n.splice(r,1),Mc(t,n),1)}function Rc(t,e,n){for(var r=0;r<t.length&&t[r][0]<=e;++r){var o=n(t[r]);if(o)return o}}function zc(t,e,n){for(var r=t.length-1;r>=0&&t[r][1]>=e;--r){var o=n(t[r]);if(o)return o}}function Oc(t,e){for(var n=0;n<t.length;++n){var r=e(t[n]);if(r)return r}}function Ec(t,e){return t-e}function Sc(t,e){var n=t[0]-e[0];return n||t[1]-e[1]}function Cc(t,e){var n=t[1]-e[1];return n||t[0]-e[0]}function Bc(t){if(0===t.length)return null;for(var e=[],n=0;n<t.length;++n)e.push(t[n][0],t[n][1]);e.sort(Ec);var r=e[e.length>>1],o=[],i=[],a=[];for(n=0;n<t.length;++n){var l=t[n];l[1]<r?o.push(l):r<l[0]?i.push(l):a.push(l)}var s=a,c=a.slice();return s.sort(Sc),c.sort(Cc),new bc(r,Bc(o),Bc(i),s,c)}function Tc(t){this.root=t}kc.intervals=function(t){return t.push.apply(t,this.leftPoints),this.left&&this.left.intervals(t),this.right&&this.right.intervals(t),t},kc.insert=function(t){var e=this.count-this.leftPoints.length;if(this.count+=1,t[1]<this.mid)this.left?4*(this.left.count+1)>3*(e+1)?Lc(this,t):this.left.insert(t):this.left=Bc([t]);else if(t[0]>this.mid)this.right?4*(this.right.count+1)>3*(e+1)?Lc(this,t):this.right.insert(t):this.right=Bc([t]);else{var n=xc.ge(this.leftPoints,t,Sc),r=xc.ge(this.rightPoints,t,Cc);this.leftPoints.splice(n,0,t),this.rightPoints.splice(r,0,t)}},kc.remove=function(t){var e=this.count-this.leftPoints;if(t[1]<this.mid)return this.left?4*(this.right?this.right.count:0)>3*(e-1)?Ac(this,t):2===(i=this.left.remove(t))?(this.left=null,this.count-=1,1):(1===i&&(this.count-=1),i):0;if(t[0]>this.mid)return this.right?4*(this.left?this.left.count:0)>3*(e-1)?Ac(this,t):2===(i=this.right.remove(t))?(this.right=null,this.count-=1,1):(1===i&&(this.count-=1),i):0;if(1===this.count)return this.leftPoints[0]===t?2:0;if(1===this.leftPoints.length&&this.leftPoints[0]===t){if(this.left&&this.right){for(var n=this,r=this.left;r.right;)n=r,r=r.right;if(n===this)r.right=this.right;else{var o=this.left,i=this.right;n.count-=r.count,n.right=r.left,r.left=o,r.right=i}$c(this,r),this.count=(this.left?this.left.count:0)+(this.right?this.right.count:0)+this.leftPoints.length}else this.left?$c(this,this.left):$c(this,this.right);return 1}for(o=xc.ge(this.leftPoints,t,Sc);o<this.leftPoints.length&&this.leftPoints[o][0]===t[0];++o)if(this.leftPoints[o]===t){this.count-=1,this.leftPoints.splice(o,1);for(i=xc.ge(this.rightPoints,t,Cc);i<this.rightPoints.length&&this.rightPoints[i][1]===t[1];++i)if(this.rightPoints[i]===t)return this.rightPoints.splice(i,1),1}return 0},kc.queryPoint=function(t,e){if(t<this.mid){if(this.left)if(n=this.left.queryPoint(t,e))return n;return Rc(this.leftPoints,t,e)}if(t>this.mid){var n;if(this.right)if(n=this.right.queryPoint(t,e))return n;return zc(this.rightPoints,t,e)}return Oc(this.leftPoints,e)},kc.queryInterval=function(t,e,n){var r;if(t<this.mid&&this.left&&(r=this.left.queryInterval(t,e,n)))return r;if(e>this.mid&&this.right&&(r=this.right.queryInterval(t,e,n)))return r;return e<this.mid?Rc(this.leftPoints,e,n):t>this.mid?zc(this.rightPoints,t,n):Oc(this.leftPoints,n)};var Nc=Tc.prototype;Nc.insert=function(t){this.root?this.root.insert(t):this.root=new bc(t[0],null,null,[t],[t])},Nc.remove=function(t){if(this.root){var e=this.root.remove(t);return 2===e&&(this.root=null),0!==e}return!1},Nc.queryPoint=function(t,e){if(this.root)return this.root.queryPoint(t,e)},Nc.queryInterval=function(t,e,n){if(t<=e&&this.root)return this.root.queryInterval(t,e,n)},Object.defineProperty(Nc,"count",{get:function(){return this.root?this.root.count:0}}),Object.defineProperty(Nc,"intervals",{get:function(){return this.root?this.root.intervals([]):[]}});const Pc=({marginLeft:t})=>[1,t],Wc=({width:t,marginRight:e})=>[-1,t-e],jc=({width:t,marginLeft:e,marginRight:n})=>[0,(e+t-n)/2],Dc=({marginTop:t})=>[1,t],qc=({height:t,marginBottom:e})=>[-1,t-e],Fc=({height:t,marginTop:e,marginBottom:n})=>[0,(e+t-n)/2];function Yc(t){return"string"==typeof t?{anchor:t}:t}function Ic(t){const{anchor:e,padding:n,...r}=t;return[{anchor:e,padding:n},r]}function _c(t,e,n,r,o){const{r:i}=o;if(null!=i&&"number"!=typeof i){const{channels:t,sort:e,reverse:n}=o;o={...o,channels:{r:{value:i,scale:"r"},...ut(t)}},void 0===e&&void 0===n&&(o.sort={channel:"r",order:"descending"})}return Bt(o,(function(i,a,l,s,c,u){let{[e]:f,r:d}=l;if(!l[e])throw new Error(`missing channel: ${e}`);({[e]:f}=Jn(l,s,u));const p=d?void 0:void 0!==this.r?this.r:void 0!==o.r?x(o.r):3;d&&(d=jn(h(d.value,s[d.scale]||m)));let[g,y]=n(c);const v=g?Xc:Gc,w=new Float64Array(f.length),b=d?t=>d[t]:()=>p;for(let t of a){const e=wc();t=t.filter(d?t=>Ot(f[t])&&Et(d[t]):t=>Ot(f[t]));const n=new Float64Array(2*t.length+2);for(const o of t){const t=b(o),i=g?t+r:0,a=f[o]-t,l=f[o]+t;let s=2;e.queryInterval(a-r,l+r,(([,,t])=>{const e=w[t]-i,a=f[o]-f[t],l=r+(d?d[o]+d[t]:2*p),c=Math.sqrt(l*l-a*a);n[s++]=e-c,n[s++]=e+c}));let c=n.slice(0,s);g&&(c=c.filter((t=>t>=0)));t:for(const t of c.sort(v)){for(let e=0;e<s;e+=2)if(n[e]+1e-6<t&&t<n[e+1]-1e-6)continue t;w[o]=t+i;break}e.insert([a,l,o])}}g||(g=1);for(const t of a)for(const e of t)w[e]=w[e]*g+y;return{data:i,facets:a,channels:{[e]:{value:f},[t]:{value:w},...d&&{r:{value:d}}}}}))}function Gc(t,e){return Math.abs(t)-Math.abs(e)}function Xc(t,e){return t-e}function Uc(t){if(void 0===t)return Qc;if("function"==typeof t)return Hc(((e,n)=>t(F(n,e))));if(/^p\d{2}$/i.test(t))return Vc(M(t));switch(`${t}`.toLowerCase()){case"deviation":return Kc;case"first":return Qc;case"last":return Jc;case"max":return tu;case"mean":return eu;case"median":return nu;case"min":return ru;case"sum":return ou;case"extent":return Zc}throw new Error(`invalid basis: ${t}`)}function Hc(t){return{map(e,n,r){const o=+t(e,n);for(const t of e)r[t]=null===n[t]?NaN:n[t]/o}}}function Vc(t){return Hc(((e,n)=>t(e,(t=>n[t]))))}const Zc={map(t,n,r){const[o,i]=e.extent(t,(t=>n[t])),a=i-o;for(const e of t)r[e]=null===n[e]?NaN:(n[e]-o)/a}},Qc=Hc(((t,e)=>{for(let n=0;n<t.length;++n){const r=e[t[n]];if(Lt(r))return r}})),Jc=Hc(((t,e)=>{for(let n=t.length-1;n>=0;--n){const r=e[t[n]];if(Lt(r))return r}})),Kc={map(t,n,r){const o=e.mean(t,(t=>n[t])),i=e.deviation(t,(t=>n[t]));for(const e of t)r[e]=null===n[e]?NaN:i?(n[e]-o)/i:0}},tu=Vc(e.max),eu=Vc(e.mean),nu=Vc(e.median),ru=Vc(e.min),ou=Vc(e.sum);function iu(t={}){"number"==typeof t&&(t={k:t});let{k:n,reduce:r,shift:o,anchor:i,strict:a}=t;if(void 0===i&&void 0!==o&&(i=function(t){switch(`${t}`.toLowerCase()){case"centered":return"middle";case"leading":return"start";case"trailing":return"end"}throw new Error(`invalid shift: ${t}`)}(o),gn(`Warning: the shift option is deprecated; please use anchor "${i}" instead.`)),!((n=Math.floor(n))>0))throw new Error(`invalid k: ${n}`);return function(t="mean"){if("string"==typeof t){if(/^p\d{2}$/i.test(t))return lu(M(t));switch(t.toLowerCase()){case"deviation":return lu(e.deviation);case"max":return su(e.max);case"mean":return uu;case"median":return lu(e.median);case"min":return su(e.min);case"mode":return su(e.mode);case"sum":return cu;case"variance":return lu(e.variance);case"difference":return mu;case"ratio":return gu;case"first":return yu;case"last":return vu}}if("function"!=typeof t)throw new Error(`invalid reduce: ${t}`);return su(t)}(r)(n,function(t="middle",e){switch(`${t}`.toLowerCase()){case"middle":return e-1>>1;case"start":return 0;case"end":return e-1}throw new Error(`invalid anchor: ${t}`)}(i,n),a)}function au(t,e,n){return t.subarray?t.subarray(e,n):t.slice(e,n)}function lu(t){return(e,n,r)=>r?{map(r,o,i){const a=Float64Array.from(r,(t=>null===o[t]?NaN:o[t]));let l=0;for(let t=0;t<e-1;++t)isNaN(a[t])&&++l;for(let o=0,s=r.length-e+1;o<s;++o)isNaN(a[o+e-1])&&++l,i[r[o+n]]=0===l?t(a.subarray(o,o+e)):NaN,isNaN(a[o])&&--l}}:{map(r,o,i){const a=Float64Array.from(r,(t=>null===o[t]?NaN:o[t]));for(let o=-n;o<0;++o)i[r[o+n]]=t(a.subarray(0,o+e));for(let o=0,l=r.length-n;o<l;++o)i[r[o+n]]=t(a.subarray(o,o+e))}}}function su(t){return(e,n,r)=>r?{map(r,o,i){let a=0;for(let t=0;t<e-1;++t)a+=Lt(o[r[t]]);for(let l=0,s=r.length-e+1;l<s;++l)a+=Lt(o[r[l+e-1]]),a===e&&(i[r[l+n]]=t(F(o,au(r,l,l+e)))),a-=Lt(o[r[l]])}}:{map(r,o,i){for(let a=-n;a<0;++a)i[r[a+n]]=t(F(o,au(r,0,a+e)));for(let a=0,l=r.length-n;a<l;++a)i[r[a+n]]=t(F(o,au(r,a,a+e)))}}}function cu(t,e,n){return n?{map(n,r,o){let i=0,a=0;for(let e=0;e<t-1;++e){const t=r[n[e]];null===t||isNaN(t)?++i:a+=+t}for(let l=0,s=n.length-t+1;l<s;++l){const s=r[n[l]],c=r[n[l+t-1]];null===c||isNaN(c)?++i:a+=+c,o[n[l+e]]=0===i?a:NaN,null===s||isNaN(s)?--i:a-=+s}}}:{map(n,r,o){let i=0;const a=n.length;for(let o=0,l=Math.min(a,t-e-1);o<l;++o)i+=+r[n[o]]||0;for(let l=-e,s=a-e;l<s;++l)i+=+r[n[l+t-1]]||0,o[n[l+e]]=i,i-=+r[n[l]]||0}}}function uu(t,e,n){if(n){const r=cu(t,e,n);return{map(n,o,i){r.map(n,o,i);for(let r=0,o=n.length-t+1;r<o;++r)i[n[r+e]]/=t}}}return{map(n,r,o){let i=0,a=0;const l=n.length;for(let o=0,s=Math.min(l,t-e-1);o<s;++o){let t=r[n[o]];null===t||isNaN(t=+t)||(i+=t,++a)}for(let s=-e,c=l-e;s<c;++s){let l=r[n[s+t-1]],c=r[n[s]];null===l||isNaN(l=+l)||(i+=l,++a),o[n[s+e]]=i/a,null===c||isNaN(c=+c)||(i-=c,--a)}}}}function fu(t,e,n,r){for(let o=n+r;n<o;++n){const r=t[e[n]];if(Lt(r))return r}}function hu(t,e,n,r){for(let o=n+r-1;o>=n;--o){const n=t[e[o]];if(Lt(n))return n}}function du(t,e,n,r){for(let o=n+r;n<o;++n){let r=t[e[n]];if(null!==r&&!isNaN(r=+r))return r}}function pu(t,e,n,r){for(let o=n+r-1;o>=n;--o){let n=t[e[o]];if(null!==n&&!isNaN(n=+n))return n}}function mu(t,e,n){return n?{map(n,r,o){for(let i=0,a=n.length-t;i<a;++i){const a=r[n[i]],l=r[n[i+t-1]];o[n[i+e]]=null===a||null===l?NaN:l-a}}}:{map(n,r,o){for(let i=-e,a=n.length-t+e+1;i<a;++i)o[n[i+e]]=pu(r,n,i,t)-du(r,n,i,t)}}}function gu(t,e,n){return n?{map(n,r,o){for(let i=0,a=n.length-t;i<a;++i){const a=r[n[i]],l=r[n[i+t-1]];o[n[i+e]]=null===a||null===l?NaN:l/a}}}:{map(n,r,o){for(let i=-e,a=n.length-t+e+1;i<a;++i)o[n[i+e]]=pu(r,n,i,t)/du(r,n,i,t)}}}function yu(t,e,n){return n?{map(n,r,o){for(let i=0,a=n.length-t;i<a;++i)o[n[i+e]]=r[n[i]]}}:{map(n,r,o){for(let i=-e,a=n.length-t+e+1;i<a;++i)o[n[i+e]]=fu(r,n,i,t)}}}function vu(t,e,n){return n?{map(n,r,o){for(let i=0,a=n.length-t;i<a;++i)o[n[i+e]]=r[n[i+t-1]]}}:{map(n,r,o){for(let i=-e,a=n.length-t+e+1;i<a;++i)o[n[i+e]]=hu(r,n,i,t)}}}function xu(t){if("function"==typeof t)return t;switch(`${t}`.toLowerCase()){case"min":return Mu;case"max":return Lu}throw new Error(`unknown selector: ${t}`)}function wu(t){return Au(null,ku,t)}function bu(t){return Au(null,$u,t)}function*ku(t){yield t[0]}function*$u(t){yield t[t.length-1]}function*Mu(t,n){yield e.least(t,(t=>n[t]))}function*Lu(t,n){yield e.greatest(t,(t=>n[t]))}function Au(t,n,r){if(null!=t){if(null==r[t])throw new Error(`missing channel: ${t}`);t=r[t]}const o=D(r);return Ct(r,((r,i)=>{const a=h(r,o),l=h(r,t),s=[];for(const t of i){const r=[];for(const o of a?e.group(t,(t=>a[t])).values():[t])for(const t of n(o,l))r.push(t);s.push(r)}return{data:r,facets:s}}))}t.Area=Ra,t.Arrow=Ga,t.BarX=ol,t.BarY=il,t.Cell=pl,t.Contour=os,t.Density=ws,t.Dot=Va,t.Frame=bi,t.Geo=Ms,t.Hexgrid=Os,t.Image=Cs,t.Line=Ja,t.Link=Fa,t.Mark=Xr,t.Raster=Ul,t.Rect=cl,t.RuleX=so,t.RuleY=co,t.Text=yo,t.TickX=Tl,t.TickY=Nl,t.Vector=Fo,t.area=function(t,e){return void 0===e?Oa(t,{x:w,y:b}):new Ra(t,e)},t.areaX=za,t.areaY=Oa,t.arrow=function(t,e={}){let{x:n,x1:r,x2:o,y:i,y1:a,y2:l,...s}=e;return[r,o]=Ia(n,r,o),[a,l]=Ia(i,a,l),new Ga(t,{...s,x1:r,x2:o,y1:a,y2:l})},t.auto=function(t,e){e=vl(e);const{x:n,y:r,color:o,size:i}=e,a=xl(t,n),l=xl(t,r),s=xl(t,o),c=xl(t,i);let u,f,{fx:h,fy:d,x:{reduce:p,zero:m,...g},y:{reduce:y,zero:v,...x},color:{color:w,reduce:b},size:{reduce:k},mark:$}=gl(t,{...e,x:{...n,value:a},y:{...r,value:l},color:{...o,value:s},size:{...i,value:c}});if(null!=$)switch(`${$}`.toLowerCase()){case"dot":$=Za,f="stroke";break;case"line":$=a&&l?Ka:a?tl:el,f="stroke",$l(s)&&(u=null);break;case"area":$=v?Oa:m||l&&yl(l)?za:Oa,f="fill",$l(s)&&(u=null);break;case"rule":$=a?uo:fo,f="stroke";break;case"bar":$=v?kl(p,a)?ll:hl:m?kl(y,l)?al:fl:kl(p,a)&&kl(y,l)?ml:kl(p,a)?ll:kl(y,l)?al:ul,f="fill";break;default:throw new Error(`invalid mark: ${$}`)}let M,L={fx:h,fy:d,x:a??void 0,y:l??void 0,[f]:s??w,z:u,r:c??void 0},A={[f]:b??void 0,r:k??void 0};if(null!=p&&null!=y)throw new Error("cannot reduce both x and y");null!=y?(A.y=y,M=K(a)?_t:Yi):null!=p?(A.x=p,M=K(l)?Gt:Ii):null==b&&null==k||(a&&l?M=K(a)&&K(l)?Xt:K(a)?Ii:K(l)?Yi:_i:a?M=K(a)?_t:Yi:l&&(M=K(l)?Gt:Ii)),M&&(M!==_i&&M!==Yi||(L.x={value:a,...g}),M!==_i&&M!==Ii||(L.y={value:l,...x}),L=M(A,L)),void 0===m&&(m=M!==Yi&&($===al||$===za||$===fl)),void 0===v&&(v=M!==Ii&&($===ll||$===Oa||$===hl));const R=null!=h||null!=d?ki({strokeOpacity:.1}):null,z=[m?uo([0]):null,v?fo([0]):null];return $=$(t,L),"stroke"===f?Ur(R,z,$):Ur(R,$,z)},t.autoSpec=gl,t.axisFx=ti,t.axisFy=Jo,t.axisX=Ko,t.axisY=Qo,t.barX=al,t.barY=ll,t.bin=_i,t.binX=Yi,t.binY=Ii,t.boxX=function(t,e={}){const{x:n={transform:t=>t},y:r=null,fill:o="#ccc",fillOpacity:i,stroke:a="currentColor",strokeOpacity:l,strokeWidth:s=2,sort:c,...u}=e,f=null!=r?Gt:It;return Ur(fo(t,f({x1:Dl,x2:ql},{x:n,y:r,stroke:a,strokeOpacity:l,...u})),al(t,f({x1:"p25",x2:"p75"},{x:n,y:r,fill:o,fillOpacity:i,...u})),Pl(t,f({x:"p50"},{x:n,y:r,stroke:a,strokeOpacity:l,strokeWidth:s,sort:c,...u})),Za(t,Al({x:jl},{x:n,y:r,z:r,stroke:a,strokeOpacity:l,...u})))},t.boxY=function(t,e={}){const{y:n={transform:t=>t},x:r=null,fill:o="#ccc",fillOpacity:i,stroke:a="currentColor",strokeOpacity:l,strokeWidth:s=2,sort:c,...u}=e,f=null!=r?_t:It;return Ur(uo(t,f({y1:Dl,y2:ql},{x:r,y:n,stroke:a,strokeOpacity:l,...u})),ll(t,f({y1:"p25",y2:"p75"},{x:r,y:n,fill:o,fillOpacity:i,...u})),Wl(t,f({y:"p50"},{x:r,y:n,stroke:a,strokeOpacity:l,strokeWidth:s,sort:c,...u})),Za(t,Al({y:jl},{x:r,y:n,z:r,stroke:a,strokeOpacity:l,...u})))},t.cell=ml,t.cellX=function(t,e={}){let{x:n=p,fill:r,stroke:o,...i}=e;return void 0===r&&void 0===L(o)[0]&&(r=m),new pl(t,{...i,x:n,fill:r,stroke:o})},t.cellY=function(t,e={}){let{y:n=p,fill:r,stroke:o,...i}=e;return void 0===r&&void 0===L(o)[0]&&(r=m),new pl(t,{...i,y:n,fill:r,stroke:o})},t.centroid=function({geometry:t=m,...n}={}){return Bt({...n,x:null,y:null},((n,r,o,i,a,{projection:l})=>{const s=h(n,t),c=s.length,u=new Float64Array(c),f=new Float64Array(c),d=e.geoPath(l);for(let t=0;t<c;++t)[u[t],f[t]]=d.centroid(s[t]);return{data:n,facets:r,channels:{x:{value:u},y:{value:f}}}}))},t.circle=function(t,e){return Za(t,{...e,symbol:"circle"})},t.cluster=function(t,n){return hc(t,{...n,treeLayout:e.cluster})},t.column=_,t.contour=function(){return new os(...Hl("value",...arguments))},t.delaunayLink=function(t,e){return vs(fs,t,e)},t.delaunayMesh=function(t,e){return vs(ds,t,e)},t.density=function(t,e={}){let{x:n,y:r,...o}=e;return[n,r]=j(n,r),new ws(t,{...o,x:n,y:r})},t.dodgeX=function(t={},e={}){1===arguments.length&&([t,e]=Ic(t));let{anchor:n="left",padding:r=1}=Yc(t);switch(`${n}`.toLowerCase()){case"left":n=Pc;break;case"right":n=Wc;break;case"middle":n=jc;break;default:throw new Error(`unknown dodge anchor: ${n}`)}return _c("x","y",n,x(r),e)},t.dodgeY=function(t={},e={}){1===arguments.length&&([t,e]=Ic(t));let{anchor:n="bottom",padding:r=1}=Yc(t);switch(`${n}`.toLowerCase()){case"top":n=Dc;break;case"bottom":n=qc;break;case"middle":n=Fc;break;default:throw new Error(`unknown dodge anchor: ${n}`)}return _c("y","x",n,x(r),e)},t.dot=Za,t.dotX=function(t,e={}){const{x:n=m,...r}=e;return new Va(t,ao({...r,x:n}))},t.dotY=function(t,e={}){const{y:n=m,...r}=e;return new Va(t,io({...r,y:n}))},t.filter=function(t,e){return Pt(e,Wt(t))},t.formatIsoDate=ir,t.formatMonth=function(t="en-US",e="short"){const n=rr(t,e);return t=>null==t||isNaN(t=+new Date(Date.UTC(2e3,+t)))?void 0:n.format(t)},t.formatWeekday=function(t="en-US",e="short"){const n=or(t,e);return t=>null==t||isNaN(t=+new Date(Date.UTC(2001,0,+t)))?void 0:n.format(t)},t.frame=ki,t.geo=Ls,t.geoCentroid=function({geometry:t=m,...n}={}){let r;return{...n,x:{transform:n=>Float64Array.from(r=h(h(n,t),e.geoCentroid),(([t])=>t))},y:{transform:()=>Float64Array.from(r,(([,t])=>t))}}},t.graticule=function({strokeOpacity:t=.1,...n}={}){return Ls(e.geoGraticule10(),{strokeOpacity:t,...n})},t.gridFx=ai,t.gridFy=oi,t.gridX=ii,t.gridY=ri,t.group=Xt,t.groupX=_t,t.groupY=Gt,t.groupZ=It,t.hexagon=function(t,e){return Za(t,{...e,symbol:"hexagon"})},t.hexbin=function(t={fill:"count"},{binWidth:e,...n}={}){e=void 0===e?20:x(e),t=Vt(t,n);const{z:r,fill:o,stroke:i}=n;return void 0===i&&at(o)&&Ht(t,"fill")&&(n.stroke="none"),void 0===n.symbol&&(n.symbol="hexagon"),void 0!==n.r||Ht(t,"r")||(n.r=e/2),Bt(n,((n,o,i,a,l,s)=>{let{x:c,y:u,z:f,fill:d,stroke:p,symbol:m}=i;if(void 0===c)throw new Error("missing channel: x");if(void 0===u)throw new Error("missing channel: y");({x:c,y:u}=Jn(i,a,s)),f=f?f.value:h(n,r),d=d?.value,p=p?.value,m=m?.value;const g=te(t,{z:f,fill:d,stroke:p,symbol:m}),y=f&&[],v=d&&[],x=p&&[],w=m&&[],b=[],k=[],$=[];let M=-1;for(const e of t)e.initialize(n);for(const n of o){const r=[];for(const e of t)e.scope("facet",n);for(const[o,i]of Jt(n,g))for(const n of Rs(i,c,u,e)){r.push(++M),k.push(n.x),$.push(n.y),f&&y.push(g===f?o:f[n[0]]),d&&v.push(g===d?o:d[n[0]]),p&&x.push(g===p?o:p[n[0]]),m&&w.push(g===m?o:m[n[0]]);for(const e of t)e.reduce(n)}b.push(r)}return{data:n,facets:b,channels:{x:{value:k},y:{value:$},...f&&{z:{value:y}},...d&&{fill:{value:v,scale:!0}},...p&&{stroke:{value:x,scale:!0}},...m&&{symbol:{value:w,scale:!0}},...Object.fromEntries(t.map((({name:t,output:n})=>[t,{scale:!0,radius:"r"===t?e/2:void 0,value:n.transform()}])))}}}))},t.hexgrid=function(t){return new Os(t)},t.hull=function(t,e){return vs(ps,t,e)},t.identity=m,t.image=function(t,e={}){let{x:n,y:r,...o}=e;return void 0===e.frameAnchor&&([n,r]=j(n,r)),new Cs(t,{...o,x:n,y:r})},t.initializer=Bt,t.interpolateNearest=ts,t.interpolateNone=Jl,t.interpolatorBarycentric=Kl,t.interpolatorRandomWalk=es,t.legend=function(t={}){for(const[e,n]of Yr){const r=t[e];if(T(r)){const o=Kn(t);let i;if("symbol"===e){const{fill:e,stroke:n=(void 0===e&&T(t.color)?"color":void 0)}=t;i={fill:e,stroke:n}}return n(An(e,r,i),Ir(o,r,t),(e=>T(t[e])?An(e,t[e]):null))}}throw new Error("unknown legend type; no scale found")},t.line=Ka,t.lineX=tl,t.lineY=el,t.linearRegressionX=function(t,e={}){const{y:n=p,x:r=m,stroke:o,fill:i=(at(o)?"currentColor":o),...a}=e;return new qs(t,Ui({...a,x:r,y:n,fill:i,stroke:o}))},t.linearRegressionY=function(t,e={}){const{x:n=p,y:r=m,stroke:o,fill:i=(at(o)?"currentColor":o),...a}=e;return new Fs(t,Xi({...a,x:n,y:r,fill:i,stroke:o}))},t.link=Ya,t.map=Al,t.mapX=Ml,t.mapY=Ll,t.marks=Ur,t.normalize=Uc,t.normalizeX=function(t,e){return 1===arguments.length&&({basis:t,...e}=t),Ml(Uc(t),e)},t.normalizeY=function(t,e){return 1===arguments.length&&({basis:t,...e}=t),Ll(Uc(t),e)},t.plot=$i,t.raster=function(){const[t,e]=Hl("fill",...arguments);return new Ul(t,null==t||void 0!==e.fill||void 0!==e.fillOpacity?e:{...e,fill:m})},t.rect=ul,t.rectX=fl,t.rectY=hl,t.reverse=function(t){return{...Pt(t,jt),sort:null}},t.ruleX=uo,t.ruleY=fo,t.scale=function(t={}){let e;for(const n in t)if(yt.has(n)&&T(t[n])){if(void 0!==e)throw new Error("ambiguous scale definition; multiple scales found");e=Fn(An(n,t[n]))}if(void 0===e)throw new Error("invalid scale definition; no scale found");return e},t.select=function(t,e={}){if("string"==typeof t)switch(t.toLowerCase()){case"first":return wu(e);case"last":return bu(e)}if("function"==typeof t)return Au(null,t,e);let n,r;for(n in t){if(void 0!==r)throw new Error("ambiguous selector; multiple inputs");r=xu(t[n])}if(void 0===r)throw new Error(`invalid selector: ${t}`);return Au(n,r,e)},t.selectFirst=wu,t.selectLast=bu,t.selectMaxX=function(t){return Au("x",Lu,t)},t.selectMaxY=function(t){return Au("y",Lu,t)},t.selectMinX=function(t){return Au("x",Mu,t)},t.selectMinY=function(t){return Au("y",Mu,t)},t.shuffle=function(t={}){const{seed:n,...r}=t;return{...Pt(r,Yt(null==n?Math.random:e.randomLcg(n))),sort:null}},t.sort=Dt,t.sphere=function({strokeWidth:t=1.5,...e}={}){return Ls({type:"Sphere"},{strokeWidth:t,...e})},t.spike=function(t,e={}){const{shape:n=Do,stroke:r=No.stroke,strokeWidth:o=1,fill:i=r,fillOpacity:a=.3,anchor:l="start",...s}=e;return Yo(t,{...s,shape:n,stroke:r,strokeWidth:o,fill:i,fillOpacity:a,anchor:l})},t.stackX=aa,t.stackX1=function(t={},e={}){1===arguments.length&&([t,e]=ua(t));const{y1:n,y:r=n,x:o}=e,[i,a,l]=fa(r,o,"x",t,e);return{...i,y1:n,y:a,x:l}},t.stackX2=function(t={},e={}){1===arguments.length&&([t,e]=ua(t));const{y1:n,y:r=n,x:o}=e,[i,a,,l]=fa(r,o,"x",t,e);return{...i,y1:n,y:a,x:l}},t.stackY=la,t.stackY1=function(t={},e={}){1===arguments.length&&([t,e]=ua(t));const{x1:n,x:r=n,y:o}=e,[i,a,l]=fa(r,o,"y",t,e);return{...i,x1:n,x:a,y:l}},t.stackY2=function(t={},e={}){1===arguments.length&&([t,e]=ua(t));const{x1:n,x:r=n,y:o}=e,[i,a,,l]=fa(r,o,"y",t,e);return{...i,x1:n,x:a,y:l}},t.text=xo,t.textX=wo,t.textY=bo,t.tickX=Pl,t.tickY=Wl,t.transform=Ct,t.tree=hc,t.treeLink=Gs,t.treeNode=_s,t.valueof=h,t.vector=Yo,t.vectorX=Io,t.vectorY=_o,t.version="0.6.4",t.voronoi=function(t,e){return vs(ms,t,e)},t.voronoiMesh=function(t,e){return vs(gs,t,e)},t.window=iu,t.windowX=function(t={},e){return 1===arguments.length&&(e=t),Ml(iu(t),e)},t.windowY=function(t={},e){return 1===arguments.length&&(e=t),Ll(iu(t),e)}}));
